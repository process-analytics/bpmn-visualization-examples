var cn=Object.defineProperty;var un=(n,t,e)=>t in n?cn(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var y=(n,t,e)=>un(n,typeof t!="symbol"?t+"":t,e);import{r as dn,g as hn}from"./mxgraph.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();var ue=(n=>(n.None="None",n.HorizontalVertical="HorizontalVertical",n.Horizontal="Horizontal",n.Vertical="Vertical",n.Center="Center",n))(ue||{}),fn=(n=>(n.In="in",n.Out="out",n))(fn||{});function gn(n){return n instanceof HTMLElement?n:document.querySelector(`#${n}`)}var C=(n=>(n.LANE="lane",n.POOL="pool",n.CALL_ACTIVITY="callActivity",n.SUB_PROCESS="subProcess",n.TASK="task",n.TASK_USER="userTask",n.TASK_SERVICE="serviceTask",n.TASK_RECEIVE="receiveTask",n.TASK_SEND="sendTask",n.TASK_MANUAL="manualTask",n.TASK_SCRIPT="scriptTask",n.TASK_BUSINESS_RULE="businessRuleTask",n.GLOBAL_TASK="globalTask",n.GLOBAL_TASK_USER="globalUserTask",n.GLOBAL_TASK_MANUAL="globalManualTask",n.GLOBAL_TASK_SCRIPT="globalScriptTask",n.GLOBAL_TASK_BUSINESS_RULE="globalBusinessRuleTask",n.GROUP="group",n.TEXT_ANNOTATION="textAnnotation",n.GATEWAY_PARALLEL="parallelGateway",n.GATEWAY_EXCLUSIVE="exclusiveGateway",n.GATEWAY_INCLUSIVE="inclusiveGateway",n.GATEWAY_EVENT_BASED="eventBasedGateway",n.GATEWAY_COMPLEX="complexGateway",n.EVENT_START="startEvent",n.EVENT_END="endEvent",n.EVENT_INTERMEDIATE_CATCH="intermediateCatchEvent",n.EVENT_INTERMEDIATE_THROW="intermediateThrowEvent",n.EVENT_BOUNDARY="boundaryEvent",n))(C||{}),de=(n=>(n.CALLING_PROCESS="process",n.CALLING_GLOBAL_TASK="global task",n))(de||{}),he=(n=>(n.Exclusive="Exclusive",n.None="None",n.Parallel="Parallel",n))(he||{}),H=(n=>(n.NONE="none",n.TERMINATE="terminate",n.CANCEL="cancel",n.COMPENSATION="compensate",n.CONDITIONAL="conditional",n.ERROR="error",n.ESCALATION="escalation",n.LINK="link",n.MESSAGE="message",n.SIGNAL="signal",n.TIMER="timer",n))(H||{}),W=(n=>(n.ADHOC="adhoc",n.COMPENSATION="compensation",n.EXPAND="expand",n.LOOP="loop",n.MULTI_INSTANCE_PARALLEL="multi-parallel",n.MULTI_INSTANCE_SEQUENTIAL="multi-sequential",n))(W||{}),ee=(n=>(n.AD_HOC="adhoc",n.EMBEDDED="embedded",n.EVENT="event",n.TRANSACTION="transaction",n))(ee||{});function Tn(n,t){return n===""?t?{}:void 0:n}function P(n,t=!1){return n==null?[]:(Array.isArray(n)?n:[n]).map(e=>Tn(e,t)).filter(Boolean)}function pn(n,t,e){const s=[];e!=null&&e.startingWith?s.push(`^(${e.startingWith}).*`):e!=null&&e.notStartingWith&&s.push(`^(?!(${e.notStartingWith})).*`),s.push(`${t}$`);const i=s.join("");return n.filter(o=>e!=null&&e.ignoreCase?new RegExp(i,"i").test(o):new RegExp(i).test(o))}class F{static isEvent(t){return pe(ut,t)}static eventKinds(){return[...ut]}static isBoundaryEvent(t){return C.EVENT_BOUNDARY===t}static isStartEvent(t){return C.EVENT_START===t}static isCatchEvent(t){return C.EVENT_INTERMEDIATE_CATCH===t||C.EVENT_BOUNDARY===t||C.EVENT_START===t}static isIntermediateCatchEvent(t){return C.EVENT_INTERMEDIATE_CATCH===t}static isIntermediateThrowEvent(t){return C.EVENT_INTERMEDIATE_THROW===t}static isCallActivity(t){return C.CALL_ACTIVITY===t}static isSubProcess(t){return C.SUB_PROCESS===t}static canHaveNoneEvent(t){return C.EVENT_INTERMEDIATE_THROW===t||C.EVENT_END===t||C.EVENT_START===t}static isActivity(t){return pe(We,t)}static activityKinds(){return[...We]}static isWithDefaultSequenceFlow(t){return En.has(t)}static isTask(t){return pe(Ue,t)}static taskKinds(){return[...Ue]}static gatewayKinds(){return[...dt]}static isGateway(t){return pe(dt,t)}static flowNodeKinds(){return Object.values(C).filter(t=>!F.isPoolOrLane(t))}static isPoolOrLane(t){return t==C.POOL||t==C.LANE}}function je(n,t){return pn(Object.values(C),n,t)}function pe(n,t){return Object.values(n).map(e=>e).includes(t)}const ut=je("Event"),dt=je("Gateway"),Ue=je("Task",{ignoreCase:!0,notStartingWith:"global"}),We=[...Ue,C.CALL_ACTIVITY,C.SUB_PROCESS],En=new Set([...We,C.GATEWAY_EXCLUSIVE,C.GATEWAY_INCLUSIVE,C.GATEWAY_COMPLEX]),kt=Object.values(H).filter(n=>n!=H.NONE);var re=(n=>(n.NONE="None",n.ONE="One",n.BOTH="Both",n))(re||{}),Z=(n=>(n.SEQUENCE_FLOW="sequenceFlow",n.MESSAGE_FLOW="messageFlow",n.ASSOCIATION_FLOW="association",n))(Z||{}),fe=(n=>(n.NONE="none",n.INITIATING="initiating",n.NON_INITIATING="non_initiating",n))(fe||{}),Q=(n=>(n.NORMAL="normal",n.DEFAULT="default",n.CONDITIONAL_FROM_ACTIVITY="conditional_from_activity",n.CONDITIONAL_FROM_GATEWAY="conditional_from_gateway",n))(Q||{});class Ne{constructor(t,e,s,i,o){this.id=t,this.name=e,this.kind=s,this.sourceReferenceId=i,this.targetReferenceId=o}}class Bt extends Ne{constructor(t,e,s,i,o=Q.NORMAL){super(t,e,Z.SEQUENCE_FLOW,s,i),this.sequenceFlowKind=o}}class Mt extends Ne{constructor(t,e,s,i){super(t,e,Z.MESSAGE_FLOW,s,i)}}class Vt extends Ne{constructor(t,e,s,i,o=re.NONE){super(t,e,Z.ASSOCIATION_FLOW,s,i),this.associationDirectionKind=o}}var Sn=dn();const mn=hn(Sn),D=An(),Cn=D.mxCellRenderer,In=D.mxClient,u=D.mxConstants,te=D.mxEvent,ht=D.mxPerimeter,$=D.mxPoint,He=D.mxRectangle,Je=D.mxRectangleShape,Qe=D.mxSvgCanvas2D,Y=D.mxUtils;function An(){return window.mxForceIncludes=!1,window.mxLoadResources=!1,window.mxLoadStylesheets=!1,window.mxResourceExtension=".txt",mn({})}class Nn{constructor(t){this.graph=t}computeRelativeCoordinates(t,e){const s=this.getTranslateForRoot(t),i=e.x+s.x,o=e.y+s.y;return new $(i,o)}getTranslateForRoot(t){const e=this.graph.getModel(),s=new $(0,0);for(;t!=null;){const i=e.getGeometry(t);i!=null&&(s.x-=i.x,s.y-=i.y),t=e.getParent(t)}return s}computeEdgeCenter(t){const e=t.geometry.points,s=e[0],i=e.at(-1),o=i.x-s.x,a=i.y-s.y;return new $(s.x+o/2,s.y+a/2)}}class me{constructor(t,e,s,i,o){y(this,"extensions",{});this.id=t,this.bpmnElement=e,this.bounds=s,this.label=i,this.isHorizontal=o}}class J{constructor(t,e,s,i,o=!1){y(this,"incomingIds",[]);y(this,"outgoingIds",[]);this.id=t,this.name=e,this.kind=s,this.parentId=i,this.instantiate=o}}class Oe extends J{constructor(t,e,s,i,o,a=[]){super(t,e,s,i,o),this.markers=a}}class oe extends Oe{constructor(t,e,s,i,o,a){super(t,e,C.CALL_ACTIVITY,i,void 0,o),this.callActivityKind=s,this.globalTaskKind=a}}class ge extends Oe{constructor(t,e,s,i,o){s==ee.AD_HOC&&!o.includes(W.ADHOC)&&o.push(W.ADHOC),super(t,e,C.SUB_PROCESS,i,void 0,o),this.subProcessKind=s}}class se extends J{constructor(t,e,s,i,o){super(t,e,s,o),this.eventDefinitionKind=i}}class Ke extends se{constructor(e,s,i,o){super(e,s,C.EVENT_INTERMEDIATE_CATCH,i,o);y(this,"sourceIds",[])}}class ze extends se{constructor(e,s,i,o){super(e,s,C.EVENT_INTERMEDIATE_THROW,i,o);y(this,"targetId")}}class Yt extends se{constructor(t,e,s,i,o){super(t,e,C.EVENT_START,s,i),this.isInterrupting=o}}class Gt extends se{constructor(t,e,s,i,o=!0){super(t,e,C.EVENT_BOUNDARY,s,i),this.isInterrupting=o}}class Dt extends J{constructor(t,e,s,i,o=he.None){super(t,e,C.GATEWAY_EVENT_BASED,s,i),this.gatewayKind=o}}function Ce(n,t,e,s){return Math.min(Math.max(n??s,t),e)}function On(n){return Math.max(n??0,0)}function Ln(n){const t=n??{};return t.debounceDelay=Ce(t.debounceDelay,0,100,50),t.throttleDelay=Ce(t.throttleDelay,0,100,50),t}function Le(n){return n=="default"?void 0:Ce(n,0,100,100)}function vn(n){return n=="default"?void 0:Ce(n,1,50,1)}const x={EDGE:"bpmn.edge",EDGE_START_FILL_COLOR:"bpmn.edge.startFillColor",EDGE_END_FILL_COLOR:"bpmn.edge.endFillColor",EVENT_BASED_GATEWAY_KIND:"bpmn.gatewayKind",EVENT_DEFINITION_KIND:"bpmn.eventDefinitionKind",GLOBAL_TASK_KIND:"bpmn.globalTaskKind",SUB_PROCESS_KIND:"bpmn.subProcessKind",IS_INITIATING:"bpmn.isInitiating",IS_INSTANTIATING:"bpmn.isInstantiating",IS_INTERRUPTING:"bpmn.isInterrupting",EXTRA_CSS_CLASSES:"bpmn.extra.css.classes",MARKERS:"bpmn.markers",MESSAGE_FLOW_ICON:"bpmn.messageFlowIcon"},Ut={ARROW_DASH:"bpmn.dash"},R={STROKE_WIDTH_THIN:2,STROKE_WIDTH_THICK:5,SHAPE_ACTIVITY_BOTTOM_MARGIN:7,SHAPE_ACTIVITY_TOP_MARGIN:7,SHAPE_ACTIVITY_LEFT_MARGIN:7,SHAPE_ACTIVITY_MARKER_ICON_MARGIN:5,SHAPE_ACTIVITY_MARKER_ICON_SIZE:20,POOL_LABEL_SIZE:30,POOL_LABEL_FILL_COLOR:"none",LANE_LABEL_SIZE:30,LANE_LABEL_FILL_COLOR:"none",SUB_PROCESS_TRANSACTION_INNER_RECT_OFFSET:4,SUB_PROCESS_TRANSACTION_INNER_RECT_ARC_SIZE:6,TEXT_ANNOTATION_BORDER_LENGTH:10,TEXT_ANNOTATION_FILL_COLOR:"none",GROUP_FILL_COLOR:"none",DEFAULT_FILL_COLOR:"White",DEFAULT_STROKE_COLOR:"Black",DEFAULT_FONT_FAMILY:"Arial, Helvetica, sans-serif",DEFAULT_FONT_SIZE:11,DEFAULT_FONT_COLOR:"Black",DEFAULT_MARGIN:0,SHAPE_ARC_SIZE:20,DEFAULT_OVERLAY_FILL_COLOR:"White",DEFAULT_OVERLAY_FILL_OPACITY:100,DEFAULT_OVERLAY_STROKE_COLOR:"Black",DEFAULT_OVERLAY_STROKE_WIDTH:1,DEFAULT_OVERLAY_FONT_SIZE:11,DEFAULT_OVERLAY_FONT_COLOR:"Black",SEQUENCE_FLOW_CONDITIONAL_FROM_ACTIVITY_MARKER_FILL_COLOR:"White",MESSAGE_FLOW_MARKER_START_FILL_COLOR:"White",MESSAGE_FLOW_MARKER_END_FILL_COLOR:"White"},Wt=n=>Y.getValue(n,x.IS_INSTANTIATING,"false")=="true",Ie=n=>n=="default"?void 0:n,_n=(n,t)=>(t&&(n=K(n,u.STYLE_STROKECOLOR,t.color,Ie),n=K(n,u.STYLE_STROKE_OPACITY,t.opacity,Le),n=K(n,u.STYLE_STROKEWIDTH,t.width,vn)),n),K=(n,t,e,s=i=>i)=>e==null?n:Y.setStyle(n,t,s(e)),Ee=(n,t,e,s)=>s==null?n:Y.setStyleFlag(n,t,e,s),yn=(n,t)=>(t&&(n=K(n,u.STYLE_FONTCOLOR,t.color,Ie),n=K(n,u.STYLE_FONTSIZE,t.size),n=K(n,u.STYLE_FONTFAMILY,t.family),n=Ee(n,u.STYLE_FONTSTYLE,u.FONT_BOLD,t.isBold),n=Ee(n,u.STYLE_FONTSTYLE,u.FONT_ITALIC,t.isItalic),n=Ee(n,u.STYLE_FONTSTYLE,u.FONT_UNDERLINE,t.isUnderline),n=Ee(n,u.STYLE_FONTSTYLE,u.FONT_STRIKETHROUGH,t.isStrikeThrough),n=K(n,u.STYLE_TEXT_OPACITY,t.opacity,Le)),n),wn=(n,t,e)=>(n==null?void 0:n.split(";").map(s=>s.split("=")).filter(([s])=>s===t).map(([,s])=>s)[0])??e,Rn=n=>{switch(n){case"right-to-left":return u.DIRECTION_WEST;case"bottom-to-top":return u.DIRECTION_NORTH;case"top-to-bottom":return u.DIRECTION_SOUTH;default:return u.DIRECTION_EAST}},bn=(n,t)=>{const e=t.color;if(e){const s=Pn(e),i=s?e.startColor:e;n=K(n,u.STYLE_FILLCOLOR,i,Ie),s?(n=Y.setStyle(n,u.STYLE_GRADIENTCOLOR,e.endColor),n=Y.setStyle(n,u.STYLE_GRADIENT_DIRECTION,Rn(e.direction))):e==="default"&&(n=Y.setStyle(n,u.STYLE_GRADIENTCOLOR,void 0),n=Y.setStyle(n,u.STYLE_GRADIENT_DIRECTION,void 0)),(n.includes(C.POOL)||n.includes(C.LANE))&&(n=K(n,u.STYLE_SWIMLANE_FILLCOLOR,i,Ie))}return n=K(n,u.STYLE_FILL_OPACITY,t.opacity,Le),n},Fn=n=>n&&typeof n=="object"&&"fill"in n,Pn=n=>n&&typeof n=="object";class xn{constructor(t){y(this,"ignoreBpmnColors");this.ignoreBpmnColors=(t==null?void 0:t.ignoreBpmnColors)??!0}computeStyle(t,e){const s=[t.bpmnElement.kind];let i;t instanceof me?i=this.computeShapeStyleValues(t):(s.push(...Mn(t)),i=this.computeEdgeStyleValues(t));const o=this.computeFontStyleValues(t),a=Vn(t,e);return s.push(...ft([...i,...o,...a])),s.join(";")}computeShapeStyleValues(t){const e=new Map,s=t.bpmnElement;if(s instanceof se?kn(s,e):s instanceof Oe?Bn(s,e):F.isPoolOrLane(s.kind)?e.set(u.STYLE_HORIZONTAL,t.isHorizontal?"0":"1"):s instanceof Dt&&(e.set(x.IS_INSTANTIATING,String(s.instantiate)),e.set(x.EVENT_BASED_GATEWAY_KIND,String(s.gatewayKind))),!this.ignoreBpmnColors){const i=t.extensions,o=i.fillColor;o&&(e.set(u.STYLE_FILLCOLOR,o),F.isPoolOrLane(s.kind)&&e.set(u.STYLE_SWIMLANE_FILLCOLOR,o)),i.strokeColor&&e.set(u.STYLE_STROKECOLOR,i.strokeColor)}return e}computeEdgeStyleValues(t){const e=new Map;if(!this.ignoreBpmnColors){const s=t.extensions;s.strokeColor&&e.set(u.STYLE_STROKECOLOR,s.strokeColor)}return e}computeFontStyleValues(t){var i,o;const e=new Map,s=(i=t.label)==null?void 0:i.font;if(s&&(e.set(u.STYLE_FONTFAMILY,s.name),e.set(u.STYLE_FONTSIZE,s.size),e.set(u.STYLE_FONTSTYLE,Yn(s))),!this.ignoreBpmnColors){const a=(o=t.label)==null?void 0:o.extensions;a!=null&&a.color&&e.set(u.STYLE_FONTCOLOR,a.color)}return e}computeMessageFlowIconStyle(t){const e=[];return e.push(["shape",x.MESSAGE_FLOW_ICON],[x.IS_INITIATING,String(t.messageVisibleKind===fe.INITIATING)]),this.ignoreBpmnColors||t.extensions.strokeColor&&e.push([u.STYLE_STROKECOLOR,t.extensions.strokeColor]),ft(e).join(";")}}function kn(n,t){t.set(x.EVENT_DEFINITION_KIND,n.eventDefinitionKind),(n instanceof Gt||n instanceof Yt&&n.isInterrupting!==void 0)&&t.set(x.IS_INTERRUPTING,String(n.isInterrupting))}function Bn(n,t){n instanceof ge?t.set(x.SUB_PROCESS_KIND,n.subProcessKind):n.kind===C.TASK_RECEIVE?t.set(x.IS_INSTANTIATING,String(n.instantiate)):n instanceof oe&&t.set(x.GLOBAL_TASK_KIND,n.globalTaskKind);const e=n.markers;e.length>0&&t.set(x.MARKERS,e.join(","))}function Mn(n){const t=[],e=n.bpmnElement;return e instanceof Bt&&t.push(e.sequenceFlowKind),e instanceof Vt&&t.push(e.associationDirectionKind),t}function Vn(n,t){const e=new Map,s=n.bpmnElement;return t?(e.set(u.STYLE_VERTICAL_ALIGN,u.ALIGN_TOP),n.bpmnElement.kind!=C.TEXT_ANNOTATION&&e.set(u.STYLE_ALIGN,u.ALIGN_CENTER),n instanceof me&&(e.set(u.STYLE_LABEL_WIDTH,t.width+1),e.set(u.STYLE_LABEL_POSITION,"ignore"),e.set(u.STYLE_VERTICAL_LABEL_POSITION,u.ALIGN_MIDDLE))):n instanceof me&&(s instanceof ge||s instanceof oe&&s.callActivityKind===de.CALLING_PROCESS)&&!s.markers.includes(W.EXPAND)&&e.set(u.STYLE_VERTICAL_ALIGN,u.ALIGN_TOP),e}function Yn(n){let t=0;return n.isBold&&(t+=u.FONT_BOLD),n.isItalic&&(t+=u.FONT_ITALIC),n.isStrikeThrough&&(t+=u.FONT_STRIKETHROUGH),n.isUnderline&&(t+=u.FONT_UNDERLINE),t}function ft(n){return n.filter(([,t])=>t&&t!="undefined").map(([t,e])=>`${t}=${e}`)}class Gn{constructor(t,e,s){this.graph=t,this.coordinatesTranslator=e,this.styleComputer=s}render(t,e){this.insertShapesAndEdges(t),this.graph.customFit(e)}insertShapesAndEdges({pools:t,lanes:e,subprocesses:s,otherFlowNodes:i,boundaryEvents:o,edges:a}){this.graph.batchUpdate(()=>{this.graph.getModel().clear(),this.insertShapes(t),this.insertShapes(e),this.insertShapes(s),this.insertShapes(i),this.insertShapes(o),this.insertEdges(a)})}insertShapes(t){for(const e of t)this.insertShape(e)}getParent(t){return this.getCell(t.parentId)??this.graph.getDefaultParent()}insertShape(t){var r;const e=t.bpmnElement,s=this.getParent(e),i=t.bounds;let o=(r=t.label)==null?void 0:r.bounds;o=F.isPoolOrLane(e.kind)?void 0:o;const a=this.styleComputer.computeStyle(t,o);this.insertVertex(s,e.id,e.name,i,o,a)}insertEdges(t){var e;for(const s of t){const i=s.bpmnElement,o=this.graph.getDefaultParent(),a=this.getCell(i.sourceReferenceId),r=this.getCell(i.targetReferenceId),l=(e=s.label)==null?void 0:e.bounds,c=this.styleComputer.computeStyle(s,l),f=this.graph.insertEdge(o,i.id,i.name,a,r,c);if(this.insertWaypoints(s.waypoints,f),l){f.geometry.width=l.width,f.geometry.height=l.height;const T=this.coordinatesTranslator.computeEdgeCenter(f);f.geometry.relative=!1;const p=this.coordinatesTranslator.computeRelativeCoordinates(f.parent,new $(l.x,l.y)),S=p.x+l.width/2-T.x,O=p.y-T.y;f.geometry.offset=new $(S,O)}this.insertMessageFlowIconIfNeeded(s,f)}}insertMessageFlowIconIfNeeded(t,e){if(t.bpmnElement instanceof Mt&&t.messageVisibleKind!==fe.NONE){const s=this.graph.insertVertex(e,et(e.id),void 0,0,0,20,14,this.styleComputer.computeMessageFlowIconStyle(t));s.geometry.relative=!0,s.geometry.offset=new $(-10,-7)}}insertWaypoints(t,e){t&&(e.geometry.points=t.map(s=>this.coordinatesTranslator.computeRelativeCoordinates(e.parent,new $(s.x,s.y))))}getCell(t){return this.graph.getModel().getCell(t)}insertVertex(t,e,s,i,o,a){const r=this.coordinatesTranslator.computeRelativeCoordinates(t,new $(i.x,i.y)),l=this.graph.insertVertex(t,e,s,r.x,r.y,i.width,i.height,a);if(o){const c=o.x-i.x,f=o.y-i.y;l.geometry.offset=new $(c,f)}return l}}function Dn(n,t){return new Gn(n,new Nn(n),new xn(t))}function et(n){return`messageFlowIcon_of_${n}`}function Ht(n,t,{signal:e,edges:s}={}){let i,o=null;const a=s!=null&&s.includes("leading"),r=s==null||s.includes("trailing"),l=()=>{o!==null&&(n.apply(i,o),i=void 0,o=null)},c=()=>{r&&l(),S()};let f=null;const T=()=>{f!=null&&clearTimeout(f),f=setTimeout(()=>{f=null,c()},t)},p=()=>{f!==null&&(clearTimeout(f),f=null)},S=()=>{p(),i=void 0,o=null},O=()=>{p(),l()},L=function(...M){if(e!=null&&e.aborted)return;i=this,o=M;const d=f==null;T(),a&&d&&l()};return L.schedule=T,L.cancel=S,L.flush=O,e==null||e.addEventListener("abort",S,{once:!0}),L}function Un(n,t,{signal:e,edges:s=["leading","trailing"]}={}){let i=null;const o=Ht(n,t,{signal:e,edges:s}),a=function(...r){i==null?i=Date.now():Date.now()-i>=t&&(i=Date.now(),o.cancel(),o(...r)),o(...r)};return a.cancel=o.cancel,a.flush=o.flush,a}class Kt extends D.mxCellOverlay{constructor(e,s){super(null,"",s.position.horizontalAlign,s.position.verticalAlign,null,"default");y(this,"style");this.label=e,this.style=s.style}getBounds(e){const s=e.view.graph.getModel().isEdge(e.cell),i=e.view.scale;let o;const a=0,r=0;return s?o=this.computeEdgeBounds(e):(o=new $,this.align==u.ALIGN_LEFT?o.x=e.x:this.align==u.ALIGN_CENTER?o.x=e.x+e.width/2:o.x=e.x+e.width,this.verticalAlign==u.ALIGN_TOP?o.y=e.y:this.verticalAlign==u.ALIGN_MIDDLE?o.y=e.y+e.height/2:o.y=e.y+e.height),new He(Math.round(o.x-(a*this.defaultOverlap-this.offset.x)*i),Math.round(o.y-(r*this.defaultOverlap-this.offset.y)*i),a*i,r*i)}computeEdgeBounds(e){const s=e.absolutePoints;if(this.align==u.ALIGN_LEFT)return s[0];if(this.align==u.ALIGN_CENTER){if(s.length%2==1)return s[Math.floor(s.length/2)];{const i=s.length/2,o=s[i-1],a=s[i];return new $(o.x+(a.x-o.x)/2,o.y+(a.y-o.y)/2)}}else return s.at(-1)}}class gt extends D.mxText{constructor(t,e,s){super(t,e,void 0,void 0,s.font.color,void 0,s.font.size,void 0,void 0,void 0,void 0,void 0,void 0,void 0,s.fill.color,s.stroke.color),this.fillOpacity=s.fill.opacity,this.strokewidth=s.stroke.width}}function Wn(n){return Object.values(Z).map(t=>t).includes(n)}function Hn(n,t){return Kn(n.style,t)}function Kn(n,t){const e=[],s=n.split(";"),o=s[0].replace(/shape=bpmn./g,""),a=new Map;a.set("bpmn-type-activity",F.isActivity(o)),a.set("bpmn-type-container",F.isPoolOrLane(o)),a.set("bpmn-type-event",F.isEvent(o)),a.set("bpmn-type-flow",Wn(o)),a.set("bpmn-type-gateway",F.isGateway(o)),a.set("bpmn-type-task",F.isTask(o));for(const[r]of[...a].filter(([,l])=>l))e.push(r);e.push(Xe(o));for(const[r,l]of s.map(c=>{const f=c.split("=");return[f[0],f[1]]}))switch(r){case x.EVENT_DEFINITION_KIND:{e.push(`bpmn-event-def-${l}`);break}case x.EVENT_BASED_GATEWAY_KIND:{e.push(`bpmn-gateway-kind-${l.toLowerCase()}`);break}case x.IS_INITIATING:{e.push(l=="true"?"bpmn-icon-initiating":"bpmn-icon-non-initiating");break}case x.SUB_PROCESS_KIND:{e.push(`bpmn-sub-process-${l.toLowerCase()}`);break}case x.GLOBAL_TASK_KIND:{e.push(Xe(l));break}}return t&&e.push("bpmn-label"),e}function Xe(n){return n?"bpmn-"+n.replace(/([A-Z])/g,t=>"-"+t[0].toLowerCase()):""}const Tt=function(n){const t=n.createSvgCanvas;n.createSvgCanvas=function(){var i;const e=t.bind(this)(),s=e.getTextCss;if(e.getTextCss=function(){const o=this.pointerEvents;this.pointerEvents=!1;const a=s.bind(this)();return this.pointerEvents=o,a},(i=this.state)!=null&&i.cell){const o=this.state.cell,a=Hn(o,this.dialect===u.DIALECT_STRICTHTML),r=this.state.style[x.EXTRA_CSS_CLASSES];typeof r=="string"&&a.push(...r.split(",")),this.node.setAttribute("class",a.join(" ")),this.node.dataset.bpmnId=this.state.cell.id}return e}};class zn extends D.mxCellRenderer{constructor(t){super(),this.iconPainter=t}createCellOverlays(t){const s=t.view.graph.getCellOverlays(t.cell);let i=null;if(s!=null){i=new D.mxDictionary;for(const o of s){const a=t.overlays==null?null:t.overlays.remove(o);if(a!=null){i.put(o,a);continue}let r;o instanceof Kt?r=new gt(o.label,new He(0,0,0,0),o.style):(r=new D.mxImageShape(new He(0,0,0,0),o.image.src),r.preserveImageAspect=!1),r.dialect=t.view.graph.dialect,r.overlay=o,this.initializeOverlay(t,r),this.installCellOverlayListeners(t,o,r),o.cursor!=null&&(r.node.style.cursor=o.cursor),r instanceof gt&&(r.node.classList.add("overlay-badge"),r.node.dataset.bpmnId=t.cell.id),i.put(o,r)}}t.overlays!=null&&t.overlays.visit(function(o,a){a.destroy()}),t.overlays=i}createShape(t){const e=super.createShape(t);return"iconPainter"in e&&(e.iconPainter=this.iconPainter),Tt(e),e}createLabel(t,e){super.createLabel(t,e),Tt(t.text)}}function Xn(n,t,e,s){let i,o;n.height<n.width||n.height==n.width&&e.width<=e.height?(i=e.width,o=e.width*n.height/n.width):(i=e.height*n.width/n.height,o=e.height);const a=t.strokeWidth?(t.strokeWidth-1)*2:0,r=i*s-a,l=o*s-a;return{width:r,height:l}}class qn{constructor({canvas:t,shapeConfig:e,iconConfig:s}){y(this,"canvas");y(this,"iconOriginalSize");y(this,"scaleX");y(this,"scaleY");y(this,"iconPaintingOriginX",0);y(this,"iconPaintingOriginY",0);y(this,"shapeConfiguration");this.canvas=t,this.shapeConfiguration=e,this.iconOriginalSize=s.originalSize;const i=s.ratioFromParent;if(i){const o=Xn(this.iconOriginalSize,s.styleConfig,this.shapeConfiguration,i);this.scaleX=o.width/this.iconOriginalSize.width,this.scaleY=o.height/this.iconOriginalSize.height}else this.scaleX=1,this.scaleY=1;this.updateCanvasStyle(s.styleConfig),s.setIconOriginFunct(this)}setIconOriginToShapeTopLeftProportionally(t){const e=this.shapeConfiguration;this.iconPaintingOriginX=e.x+e.width/t,this.iconPaintingOriginY=e.y+e.height/t}setIconOriginToShapeTopLeft(t=R.SHAPE_ACTIVITY_TOP_MARGIN,e=R.SHAPE_ACTIVITY_LEFT_MARGIN){const s=this.shapeConfiguration;this.iconPaintingOriginX=s.x+e,this.iconPaintingOriginY=s.y+t}setIconOriginForIconCentered(){const t=this.shapeConfiguration;this.iconPaintingOriginX=t.x+(t.width-this.iconOriginalSize.width*this.scaleX)/2,this.iconPaintingOriginY=t.y+(t.height-this.iconOriginalSize.height*this.scaleY)/2}setIconOriginForIconBottomCentered(t=R.SHAPE_ACTIVITY_BOTTOM_MARGIN){const e=this.shapeConfiguration;this.iconPaintingOriginX=e.x+(e.width-this.iconOriginalSize.width*this.scaleX)/2,this.iconPaintingOriginY=e.y+(e.height-this.iconOriginalSize.height*this.scaleY-t)}translateIconOrigin(t,e){this.iconPaintingOriginX+=this.scaleX*t,this.iconPaintingOriginY+=this.scaleY*e}computeScaleFromOriginX(t){return this.iconPaintingOriginX+t*this.scaleX}computeScaleFromOriginY(t){return this.iconPaintingOriginY+t*this.scaleY}updateCanvasStyle({isFilled:t,strokeColor:e,fillColor:s,strokeWidth:i}){t?this.canvas.setFillColor(e):this.canvas.setFillColor(s),this.canvas.setStrokeWidth(i)}arcTo(t,e,s,i,o,a,r){this.canvas.arcTo(t*this.scaleX,e*this.scaleY,s,i,o,this.computeScaleFromOriginX(a),this.computeScaleFromOriginY(r))}begin(){this.canvas.begin()}close(){this.canvas.close()}curveTo(t,e,s,i,o,a){this.canvas.curveTo(this.computeScaleFromOriginX(t),this.computeScaleFromOriginY(e),this.computeScaleFromOriginX(s),this.computeScaleFromOriginY(i),this.computeScaleFromOriginX(o),this.computeScaleFromOriginY(a))}fill(){this.canvas.fill()}fillAndStroke(){this.canvas.fillAndStroke()}setFillColor(t){this.canvas.setFillColor(t)}stroke(){this.canvas.stroke()}setStrokeColor(t){this.canvas.setStrokeColor(t)}setRoundLineJoin(){this.canvas.setLineJoin("round")}lineTo(t,e){this.canvas.lineTo(this.computeScaleFromOriginX(t),this.computeScaleFromOriginY(e))}moveTo(t,e){this.canvas.moveTo(this.computeScaleFromOriginX(t),this.computeScaleFromOriginY(e))}rect(t,e,s,i){this.canvas.rect(this.computeScaleFromOriginX(t),this.computeScaleFromOriginY(e),s*this.scaleX,i*this.scaleY)}roundrect(t,e,s,i,o,a){this.canvas.roundrect(this.computeScaleFromOriginX(t),this.computeScaleFromOriginY(e),s*this.scaleX,i*this.scaleY,o,a)}ellipse(t,e,s,i){this.canvas.ellipse(this.computeScaleFromOriginX(t),this.computeScaleFromOriginY(e),s*this.scaleX,i*this.scaleY)}rotateOnIconCenter(t){const e=this.iconPaintingOriginX+this.iconOriginalSize.width/2*this.scaleX,s=this.iconPaintingOriginY+this.iconOriginalSize.height/2*this.scaleY;this.canvas.rotate(t,!1,!1,e,s)}}function ae({canvas:n,x:t,y:e,width:s,height:i,shape:o,ratioFromParent:a,isFilled:r,iconStrokeWidth:l}){const c=Y.getValue(o.style,u.STYLE_STROKEWIDTH,R.STROKE_WIDTH_THIN),f=Y.getValue(o.style,u.STYLE_FILLCOLOR,R.DEFAULT_FILL_COLOR),T=Y.getValue(o.style,u.STYLE_STROKECOLOR,R.DEFAULT_STROKE_COLOR),p=Y.getValue(o.style,u.STYLE_MARGIN,R.DEFAULT_MARGIN);return a??(a=.25),r??(r=!1),l??(l=0),{canvas:n,ratioFromParent:a,setIconOriginFunct:S=>S.setIconOriginForIconCentered(),shapeConfig:{x:t,y:e,width:s,height:i,strokeWidth:c},iconStyleConfig:{isFilled:r,fillColor:f,strokeColor:T,strokeWidth:l,margin:p}}}class $n{newBpmnCanvas({canvas:t,ratioFromParent:e,setIconOriginFunct:s,shapeConfig:i,iconStyleConfig:o},a){return new qn({canvas:t,shapeConfig:i,iconConfig:{originalSize:a,styleConfig:o,ratioFromParent:e,setIconOriginFunct:s}})}paintEnvelopeIcon(t){const e={width:485.41,height:321.76},s=this.newBpmnCanvas(t,e),i=e.width,o=e.height;s.rect(0,0,i,o),s.fillAndStroke();const{iconStyleConfig:a}=t;a.isFilled&&s.setStrokeColor(a.fillColor),s.begin(),s.moveTo(0,0),s.lineTo(i*.5,o*.6),s.lineTo(i,0),s.moveTo(0,o),s.lineTo(i/3,o*.45),s.moveTo(i,o),s.lineTo(i*2/3,o*.45),s.stroke()}paintCircleIcon(t){const e={width:t.shapeConfig.width,height:t.shapeConfig.height},s=this.newBpmnCanvas(t,e),i=e.width,o=e.height;i>0&&o>0&&s.ellipse(0,0,i,o),t.iconStyleConfig.isFilled?s.fillAndStroke():s.stroke()}paintClockIcon(t){const e=this.newBpmnCanvas(t,{height:152,width:152});e.begin(),e.moveTo(184,60),e.curveTo(188.4,60,192,56.4,192,52),e.lineTo(192,48),e.curveTo(192,40,188.4,40,184,40),e.curveTo(179.6,40,176,43.6,176,48),e.lineTo(176,52),e.curveTo(176,56.4,179.6,60,184,60),e.close(),e.moveTo(184,308),e.curveTo(179.6,308,176,311.6,176,316),e.lineTo(176,320),e.curveTo(176,324.4,179.6,328,184,328),e.curveTo(188.4,328,192,324.4,192,320),e.lineTo(192,316),e.curveTo(192,311.6,188.4,308,184,308),e.close(),e.moveTo(52,176),e.lineTo(48,176),e.curveTo(43.6,176,40,179.6,40,184),e.curveTo(40,188.4,43.6,192,48,192),e.lineTo(52,192),e.curveTo(56.4,192,69,188.4,60,184),e.curveTo(60,179.6,56.4,176,52,176),e.close(),e.moveTo(320,176),e.lineTo(316,176),e.curveTo(311.6,176,308,179.6,308,184),e.curveTo(308,188.4,311.6,192,316,192),e.lineTo(320,192),e.curveTo(324.4,192,328,188.4,328,184),e.curveTo(328,179.6,324.4,176,320,176),e.moveTo(93.6,82.4),e.curveTo(90.4,79.2,85.6,79.2,82.4,82.4),e.curveTo(79.2,85.6,79.2,90.4,82.4,93.6),e.lineTo(85.2,96.4),e.curveTo(86.8,98,88.8,98.8,90.8,98.8),e.curveTo(92.8,98.8,94.4,98,96.4,96.4),e.curveTo(99.6,93.2,99.6,88.4,96.4,85.2),e.lineTo(93.6,82.4),e.moveTo(85.2,271.6),e.lineTo(82.4,274.4),e.curveTo(79.2,277.6,79.2,282.4,82.4,285.6),e.curveTo(84,287.2,86,288,88,288),e.curveTo(90,288,92,287.2,93.6,285.6),e.lineTo(96.4,282.8),e.curveTo(99.6,279.6,99.6,274.8,96.4,271.6),e.curveTo(93.2,268.4,88.4,268.4,85.2,271.6),e.moveTo(274.4,82.4),e.lineTo(271.6,85.2),e.curveTo(268.4,88.4,268.4,93.2,271.6,96.4),e.curveTo(273.298,98,275.2,98.8,277.2,98.8),e.curveTo(279.2,98.8,281.2,98,282.8,96.4),e.lineTo(285.6,93.6),e.curveTo(288.8,90.4,288.8,85.6,285.6,82.4),e.curveTo(282.4,79.2,277.6,79.2,274.4,82.4),e.moveTo(192,180.8),e.lineTo(192,108),e.curveTo(192,103.6,188.4,100,184,100),e.curveTo(179.6,100,176,103.6,176,108),e.lineTo(176,184),e.curveTo(176,186,176.8,188,178.4,189.6),e.lineTo(266,277.2),e.curveTo(267.6,278.8,269.6,279.6,271.6,279.6),e.curveTo(273.6,279.6,275.6,278.8,277.2,277.2),e.curveTo(280.4,274,280.4,269.2,277.2,266),e.lineTo(192,180.8),e.moveTo(184,0),e.curveTo(82.4,0,0,82.4,0,184),e.curveTo(0,285.6,82.4,368,184,368),e.curveTo(285.6,368,368,285.6,368,184),e.curveTo(368,82.4,285.6,0,184,0),e.moveTo(184,352),e.curveTo(91.2,352,16,276.8,16,184),e.curveTo(16,91.2,91.2,16,184,16),e.curveTo(276.8,16,352,91.2,352,184),e.curveTo(352,276.8,276.8,352,184,352),e.fillAndStroke()}paintTriangleIcon(t){const e=this.newBpmnCanvas(t,{height:735,width:849});e.begin(),e.moveTo(497,55),e.lineTo(817,609),e.curveTo(849,665,808,735,744,735),e.lineTo(105,735),e.curveTo(40,735,0,665,32,609),e.lineTo(352,55),e.curveTo(384,0,465,0,497,55),e.close(),e.fillAndStroke()}paintUpArrowheadIcon(t){const e=this.newBpmnCanvas(t,{height:50,width:40});e.begin(),e.moveTo(0,49.5),e.lineTo(19.5,1),e.curveTo(19.75,.25,20,0,20.25,.25),e.lineTo(40,49.5),e.curveTo(40,49.5,39.75,50,39.6,49.75),e.lineTo(20,30),e.lineTo(.4,49.75),e.curveTo(.4,49.75,.25,50,0,49.5),e.close(),e.fillAndStroke()}paintDoubleLeftArrowheadsIcon(t){const e=this.newBpmnCanvas(t,{height:53.5,width:105});e.begin(),e.moveTo(91.4,0),e.curveTo(91.4,0,91.2,0,91,.2),e.lineTo(50,25),e.curveTo(47.9,25.8,46.7,26.6,46.4,27.3),e.lineTo(46.4,0),e.curveTo(46.4,0,46.2,0,46,.2),e.lineTo(4.9,25),e.curveTo(2,26.2,0,27.3,4.9,28.5),e.lineTo(45.8,53),e.curveTo(46,53.3,46.2,53.5,46.4,53.5),e.lineTo(46.4,27),e.curveTo(46.6,27.3,47.8,28.1,49.9,29.9),e.lineTo(90.8,53.3),e.curveTo(91,53.3,91.2,53.5,91.4,53.5),e.lineTo(91.4,0),e.close(),e.fillAndStroke()}drawCrossIcon(t){const e=this.newBpmnCanvas(t,{height:1,width:1});return e.begin(),e.moveTo(.38,0),e.lineTo(.62,0),e.lineTo(.62,.38),e.lineTo(1,.38),e.lineTo(1,.62),e.lineTo(.62,.62),e.lineTo(.62,1),e.lineTo(.38,1),e.lineTo(.38,.62),e.lineTo(0,.62),e.lineTo(0,.38),e.lineTo(.38,.38),e.close(),e}paintListIcon(t){const e=this.newBpmnCanvas(t,{height:60,width:60});e.begin(),e.moveTo(0,0),e.lineTo(60,0),e.lineTo(60,60),e.lineTo(0,60),e.lineTo(0,0),e.close(),e.moveTo(5,5),e.lineTo(55,5),e.close(),e.moveTo(5,21.6),e.lineTo(55,21.6),e.close(),e.moveTo(5,38.3),e.lineTo(55,38.3),e.close(),e.moveTo(5,55),e.lineTo(55,55),e.close(),e.fillAndStroke()}paintXCrossIcon(t){const e=this.drawCrossIcon(t);e.rotateOnIconCenter(45),e.fillAndStroke()}paintPlusCrossIcon(t){this.drawCrossIcon(t).fillAndStroke()}paintAsteriskIcon(t){const e=this.newBpmnCanvas(t,{height:1,width:1});ye(e),e.fillAndStroke(),ye(e),e.rotateOnIconCenter(60),e.fillAndStroke(),ye(e),e.rotateOnIconCenter(240),e.fillAndStroke()}paintPersonIcon(t){const e=this.newBpmnCanvas({...t,iconStyleConfig:{...t.iconStyleConfig,isFilled:!0}},{height:239.68,width:143.61});e.begin(),e.moveTo(124.31,150.29),e.lineTo(99.66,141.03),e.arcTo(6.43,6.43,0,0,1,95.51,135.03),e.lineTo(95.51,130.66),e.arcTo(47.75,47.75,0,0,0,119.51,89.25),e.lineTo(119.51,71.25),e.arcTo(47.62,47.62,0,0,0,101.18,33.64),e.arcTo(29.35,29.35,0,0,0,101.52,29.14),e.arcTo(29.68,29.68,0,0,0,42.17,29.14),e.arcTo(29.24,29.24,0,0,0,42.53,33.63),e.arcTo(47.65,47.65,0,0,0,24.14,71.23),e.lineTo(24.14,89.23),e.arcTo(47.7,47.7,0,0,0,48.19,130.63),e.lineTo(48.19,135.03),e.arcTo(6.43,6.43,0,0,1,44.03,141.03),e.lineTo(19.31,150.29),e.arcTo(29.81,29.81,0,0,0,.09,178.03),e.lineTo(.09,233.51),e.arcTo(5.63,5.63,0,1,0,11.34,233.51),e.lineTo(11.34,178.03),e.arcTo(18.19,18.19,0,0,1,11.57,175.17),e.lineTo(20.5,184.11),e.arcTo(12.32,12.32,0,0,1,24.14,192.89),e.lineTo(24.14,233.51),e.arcTo(5.63,5.63,0,1,0,35.39,233.51),e.lineTo(35.39,192.93),e.arcTo(23.5,23.5,0,0,0,28.46,176.2),e.lineTo(17.04,164.78),e.arcTo(18.34,18.34,0,0,1,23.29,160.78),e.lineTo(43.65,153.15),e.lineTo(66.22,175.72),e.lineTo(66.22,233.51),e.arcTo(5.63,5.63,0,1,0,77.47,233.51),e.lineTo(77.47,175.76),e.lineTo(100.04,153.19),e.lineTo(120.4,160.82),e.arcTo(18.39,18.39,0,0,1,126.65,164.82),e.lineTo(115.24,176.24),e.arcTo(23.5,23.5,0,0,0,108.31,192.93),e.lineTo(108.31,233.55),e.arcTo(5.63,5.63,0,1,0,119.56,233.55),e.lineTo(119.56,192.93),e.arcTo(12.35,12.35,0,0,1,123.19,184.15),e.lineTo(132.13,175.22),e.arcTo(18,18,0,0,1,132.36,178.08),e.lineTo(132.36,233.56),e.arcTo(5.63,5.63,0,0,0,143.61,233.56),e.lineTo(143.61,178.03),e.arcTo(29.81,29.81,0,0,0,124.31,150.29),e.close(),e.moveTo(71.85,10.72),e.arcTo(18.46,18.46,0,0,1,90.17,27.18),e.arcTo(47.68,47.68,0,0,0,53.53,27.18),e.arcTo(18.44,18.44,0,0,1,71.85,10.72),e.close(),e.moveTo(35.39,71.23),e.arcTo(36.46,36.46,0,0,1,108.31,71.23),e.lineTo(108.31,77.4),e.curveTo(82.12,75.4,56.97,60.55,56.71,60.4),e.arcTo(5.62,5.62,0,0,0,48.78,62.71),e.curveTo(46.24,67.79,40.45,71.89,35.39,74.62),e.close(),e.moveTo(35.39,89.23),e.lineTo(35.39,87.08),e.curveTo(40.55,84.85,49.73,80.08,55.67,72.66),e.curveTo(64.83,77.46,85.92,87.21,108.31,88.66),e.lineTo(108.31,89.24),e.arcTo(36.46,36.46,0,1,1,35.39,89.24),e.close(),e.moveTo(71.85,165.45),e.lineTo(54.06,147.69),e.arcTo(17.7,17.7,0,0,0,59.43,135.32),e.arcTo(47.57,47.57,0,0,0,84.27,135.32),e.arcTo(17.7,17.7,0,0,0,89.64,147.69),e.close(),e.fill()}paintGearIcon(t){const e=this.newBpmnCanvas(t,{height:100,width:100});Zn(e),e.translateIconOrigin(14,14),jn(e)}paintExpandIcon(t){const e={width:16,height:16},s=this.newBpmnCanvas(t,e),i=e.width,o=e.height;s.roundrect(0,0,i,o,2,2),s.stroke(),s.begin(),s.moveTo(i/2,o/4),s.lineTo(i/2,o*3/4),s.close(),s.moveTo(i/4,o/2),s.lineTo(i*3/4,o/2),s.close(),s.fillAndStroke()}paintLoopIcon(t){const{iconStyleConfig:e}=t;e.fillColor=e.strokeColor;const s=this.newBpmnCanvas(t,{width:22.49,height:21.62});s.begin(),s.moveTo(5.5,19.08),s.arcTo(8,8,0,1,1,10.5,21.08),s.stroke(),s.begin(),s.moveTo(7.5,14.08),s.lineTo(5.75,19.08),s.lineTo(0,17.08),s.close(),s.fillAndStroke()}paintSequentialMultiInstanceIcon(t){const e={width:16,height:16},s=this.newBpmnCanvas(t,e),{canvas:i,iconStyleConfig:o}=t;i.setFillColor(o.strokeColor);const a=e.width,r=e.height/5;s.rect(0,0,a,r),s.fill(),s.rect(0,2*r,a,r),s.fill(),s.rect(0,4*r,a,r),s.fill()}paintParallelMultiInstanceIcon(t){const e={width:16,height:16},s=this.newBpmnCanvas(t,e),{canvas:i,iconStyleConfig:o}=t;i.setFillColor(o.strokeColor);const a=e.width/5,r=e.height;s.begin(),s.rect(0,0,a,r),s.fill(),s.rect(2*a,0,a,r),s.fill(),s.rect(4*a,0,a,r),s.fill()}paintRightArrowIcon(t){const e=this.newBpmnCanvas(t,{width:512,height:415.23});e.setRoundLineJoin(),e.begin(),e.moveTo(512,207.61),e.lineTo(304.38,0),e.lineTo(304.38,135.39),e.lineTo(0,135.39),e.lineTo(0,279.84),e.lineTo(304.38,279.84),e.lineTo(304.38,415.23),e.lineTo(512,207.61),e.close(),e.fillAndStroke()}paintErrorIcon(t){const e=this.newBpmnCanvas(t,{width:72.44,height:71.82});e.begin(),e.moveTo(0,53.32),e.lineTo(19.48,0),e.lineTo(19.48,0),e.lineTo(50.85,40.07),e.lineTo(72.44,18.21),e.lineTo(53.12,71.82),e.lineTo(22.5,31.37),e.close(),e.fillAndStroke()}paintHandIcon(t){const e=this.newBpmnCanvas(t,{width:343.65,height:354.12});e.begin(),e.moveTo(231.66,336.39),e.curveTo(240.84,316.9,220.53,306.92,220.53,306.92),e.curveTo(215.2,303.67,188.58,287.43,140.67,258.19),e.lineTo(146.33,248.39),e.curveTo(223.98,269.38,267.12,281.04,275.75,283.38),e.curveTo(275.75,283.38,297.25,288,301.42,267.77),e.curveTo(306.34,245.29,288.32,238.63,288.32,238.63),e.curveTo(279.91,236.44,237.86,225.48,162.18,205.75),e.lineTo(165.2,194.8),e.curveTo(255.88,204.4,306.27,209.73,316.34,210.8),e.curveTo(316.34,210.8,339.89,212.16,341.76,189.55),e.curveTo(343.65,166.93,320.5,164.13,320.5,164.13),e.curveTo(310.43,163.1,260.04,157.99,169.35,148.77),e.lineTo(169.35,138.97),e.curveTo(253.41,132.12,300.11,128.32,309.45,127.56),e.curveTo(309.45,127.56,332.27,122.38,332.27,102.61),e.curveTo(332.27,82.85,305.48,81.87,305.48,81.87),e.curveTo(293.99,82.2,236.54,83.88,133.13,86.9),e.lineTo(127.61,81.87),e.curveTo(145.3,59.39,155.12,46.9,157.09,44.41),e.curveTo(157.09,44.41,171.12,26.8,156.78,12.72),e.curveTo(143.83,0,124.08,14.49,124.08,14.49),e.curveTo(116.45,19.41,78.35,44.06,9.77,88.43),e.lineTo(0,251.94),e.curveTo(122.84,308.79,191.09,340.37,204.74,346.69),e.curveTo(204.74,346.69,222.91,354.12,231.66,336.39),e.fillAndStroke()}paintScriptIcon(t){t.iconStyleConfig.fillColor=t.iconStyleConfig.strokeColor;const e=this.newBpmnCanvas(t,{width:458.75,height:461.64});e.begin(),e.moveTo(67.85,.57),e.curveTo(50.73,0,33.26,8.86,22.35,18.84),e.curveTo(8.11,32.15,0,50.77,0,70.26),e.curveTo(0,73.15,0,87.59,0,113.6),e.curveTo(55.4,113.6,86.18,113.6,92.33,113.6),e.curveTo(94.92,150.46,85.64,180.4,74.22,211.27),e.curveTo(40.16,298.07,30.77,339.83,55.56,410.87),e.curveTo(63.72,438.26,87.59,457.85,114.91,461.09),e.curveTo(216.96,460.85,294.9,461.64,388.41,461.2),e.curveTo(407.2,461.09,425.14,453.55,438.3,440.13),e.curveTo(451.46,426.71,458.75,403.06,458.46,384.26),e.curveTo(458.43,382.23,458.18,365.93,458.15,363.89),e.curveTo(432.12,364.24,406.09,364.04,380.06,364.04),e.curveTo(377.61,347.52,377.24,337.58,378.28,324.48),e.curveTo(380.5,296.47,389.08,273.36,398.59,247.1),e.curveTo(408.11,220.83,418.41,191.47,420.86,154.24),e.curveTo(422.11,135.34,421.4,110.24,417.77,86.75),e.curveTo(417.76,86.71,417.73,86.54,417.69,86.22),e.curveTo(417.64,85.95,417.61,85.79,417.6,85.76),e.curveTo(414.03,68.13,410.49,48.84,399.79,31.47),e.curveTo(389.09,14.11,366.95,.59,341.75,.59),e.curveTo(286.97,.59,122.63,.57,67.85,.57),e.close(),e.moveTo(85.04,72.68),e.curveTo(80.63,72.68,45.33,72.68,40.92,72.68),e.curveTo(40.46,58.4,47.15,51.87,50.27,48.75),e.curveTo(55.8,44.28,59.84,41,73.82,41),e.curveTo(78.45,52.13,82.23,62.71,85.04,72.68),e.close(),e.moveTo(364.94,52.9),e.curveTo(370,61.11,373.9,76.44,377.38,93.51),e.curveTo(380.35,113.1,381.01,136.42,380.02,151.57),e.curveTo(377.97,182.76,369.51,207.12,360.1,233.1),e.curveTo(350.69,259.09,340.27,286.77,337.53,321.27),e.curveTo(336.38,335.86,336.72,346.69,338.87,364.01),e.curveTo(326.35,364.01,263.75,364.01,151.06,364.01),e.curveTo(151.06,382.2,151.06,392.31,151.06,394.33),e.curveTo(147.77,404.8,138.9,418.2,127.43,419.94),e.curveTo(111.49,422.35,97.86,411.8,94.75,399.19),e.curveTo(65.14,321.99,94.93,275.54,112.57,225.47),e.curveTo(130.14,177.95,137.92,117.41,112.71,42.09),e.curveTo(192.88,41.9,274.33,42.21,342.89,41.98),e.curveTo(357.15,42.03,359.83,44.61,364.94,52.9),e.close(),e.moveTo(409.96,399.48),e.curveTo(409.96,408.42,398.54,425.67,392.02,425.67),e.curveTo(325.19,425.79,252.29,425.67,185.23,425.67),e.curveTo(189.88,424.43,194.66,405.64,194.66,399.48),e.curveTo(237.72,399.48,388.43,399.48,409.96,399.48),e.close(),e.fill(),e.begin(),e.moveTo(182.1,131.2),e.lineTo(182.1,151.68),e.lineTo(321.89,151.68),e.lineTo(321.89,131.2),e.lineTo(182.1,131.2),e.close(),e.moveTo(162.25,251.09),e.lineTo(162.25,271.49),e.lineTo(301.96,271.49),e.lineTo(301.96,251.09),e.lineTo(162.25,251.09),e.close(),e.fill()}paintTableIcon(t){const e=this.newBpmnCanvas(t,{width:640,height:640});e.begin(),e.moveTo(.19,.1),e.lineTo(298.78,.1),e.lineTo(298.78,198.88),e.lineTo(.19,198.88),e.lineTo(.19,.1),e.close(),e.fillAndStroke(),e.begin(),e.moveTo(0,0),e.lineTo(298.78,0),e.lineTo(298.78,48.88),e.lineTo(0,48.88),e.lineTo(0,0),e.close(),e.fillAndStroke(),e.begin(),e.moveTo(0,48.88),e.lineTo(98.78,48.88),e.lineTo(98.78,198.88),e.lineTo(0,198.88),e.lineTo(0,48.88),e.close(),e.fillAndStroke(),e.begin(),e.moveTo(1.09,122.69),e.lineTo(298.78,122.69),e.close(),e.fillAndStroke(),e.setFillColor(t.iconStyleConfig.strokeColor),e.begin(),e.moveTo(0,0),e.lineTo(298.78,0),e.lineTo(298.78,48.88),e.lineTo(0,48.88),e.lineTo(0,0),e.close(),e.fillAndStroke()}paintPentagon(t){const e=this.newBpmnCanvas(t,{width:16,height:16});e.begin(),e.moveTo(16,6.5),e.lineTo(8,0),e.lineTo(0,6.5),e.lineTo(3,16),e.lineTo(13,16),e.lineTo(16,6.5),e.lineTo(8,0),e.stroke()}}function ye(n){n.begin(),n.moveTo(.38,0),n.lineTo(.62,0),n.lineTo(.62,1),n.lineTo(.38,1),n.close()}function Zn(n){n.begin(),n.moveTo(2.06,24.62),n.lineTo(10.17,30.95),n.lineTo(9.29,37.73),n.lineTo(0,41.42),n.lineTo(2.95,54.24),n.lineTo(13.41,52.92),n.lineTo(17.39,58.52),n.lineTo(13.56,67.66),n.lineTo(24.47,74.44),n.lineTo(30.81,66.33),n.lineTo(37.88,67.21),n.lineTo(41.57,76.5),n.lineTo(54.24,73.55),n.lineTo(53.06,62.94),n.lineTo(58.52,58.52),n.lineTo(67.21,63.09),n.lineTo(74.58,51.88),n.lineTo(66.03,45.25),n.lineTo(66.92,38.62),n.lineTo(76.5,34.93),n.lineTo(73.7,22.26),n.lineTo(62.64,23.44),n.lineTo(58.81,18.42),n.lineTo(62.79,8.7),n.lineTo(51.74,2.21),n.lineTo(44.81,10.47),n.lineTo(38.03,9.43),n.lineTo(33.75,0),n.lineTo(21.52,3.24),n.lineTo(22.7,13.56),n.lineTo(18.13,17.54),n.lineTo(8.7,13.56),n.close(),qe(n,24.8,39)}function jn(n){n.begin(),n.moveTo(16.46,41.42),n.lineTo(24.57,47.75),n.lineTo(23.69,54.53),n.lineTo(14.4,58.22),n.lineTo(17.35,71.04),n.lineTo(27.81,69.72),n.lineTo(31.79,75.32),n.lineTo(27.96,84.46),n.lineTo(38.87,91.24),n.lineTo(45.21,83.13),n.lineTo(52.28,84.01),n.lineTo(55.97,93.3),n.lineTo(68.64,90.35),n.lineTo(67.46,79.74),n.lineTo(72.92,75.32),n.lineTo(81.61,79.89),n.lineTo(88.98,68.68),n.lineTo(80.43,62.05),n.lineTo(81.32,55.42),n.lineTo(90.9,51.73),n.lineTo(88.1,39.06),n.lineTo(77.04,40.24),n.lineTo(73.21,35.22),n.lineTo(77.19,25.5),n.lineTo(66.14,19.01),n.lineTo(59.21,27.27),n.lineTo(52.43,26.23),n.lineTo(48.15,16.8),n.lineTo(35.92,20.04),n.lineTo(37.1,30.36),n.lineTo(32.53,34.34),n.lineTo(23.1,30.36),n.close();const t=39.2,e=55.8;qe(n,t,e),n.begin(),qe(n,t,e)}function qe(n,t,e){n.moveTo(t,e),n.arcTo(13.5,13.5,0,1,1,t+2*13.5,e),n.arcTo(13.5,13.5,0,0,1,t,e),n.close(),n.fillAndStroke()}class zt{static get(){return this.instance}static set(t){this.instance=t}}y(zt,"instance",new $n);const $e=1.25,Jn=1/$e;class Qn extends D.mxGraph{constructor(e){super(e);y(this,"currentZoomLevel",1);this.zoomFactor=$e,this.container&&(this.container.style.cursor="default")}createGraphView(){return new es(this)}createCellRenderer(){return new zn(zt.get())}batchUpdate(e){this.model.beginUpdate();try{e()}finally{this.model.endUpdate()}}fit(e,s,i,o,a,r,l){const c=super.fit(e,s,i,o,a,r,l);return this.setCurrentZoomLevel(c),c}setCurrentZoomLevel(e){this.currentZoomLevel=e??this.view.scale}zoomActual(){super.zoomActual(),this.setCurrentZoomLevel()}zoomIn(){super.zoomIn(),this.setCurrentZoomLevel()}zoomOut(){super.zoomOut(),this.setCurrentZoomLevel()}customFit(e){this.zoomActual();const s=e==null?void 0:e.type;if(s==null||s==ue.None)return;const i=On(e==null?void 0:e.margin);if(s==ue.Center){const a=this.getGraphBounds(),r=this.container.clientWidth-i,l=this.container.clientHeight-i,c=a.width/this.view.scale,f=a.height/this.view.scale,T=Math.min(3,Math.min(r/c,l/f));this.setCurrentZoomLevel(T),this.view.scaleAndTranslate(T,(i+r-c*T)/(2*T)-a.x/this.view.scale,(i+l-f*T)/(2*T)-a.y/this.view.scale)}else{let o=!1,a=!1;switch(s){case ue.Horizontal:{a=!0;break}case ue.Vertical:{o=!0;break}}this.fit(this.border,!1,i,!0,o,a)}}registerMouseWheelZoomListeners(e){e=Ln(e),te.addMouseWheelListener(Ht(this.createMouseWheelZoomListener(!0),e.debounceDelay),this.container),te.addMouseWheelListener(Un(this.createMouseWheelZoomListener(!1),e.throttleDelay),this.container)}manageMouseWheelZoomEvent(e,s,i){if(i){const[o,a]=this.getEventRelativeCoordinates(s),[r,l,c]=this.getScaleAndTranslationDeltas(o,a);this.view.scaleAndTranslate(r,this.view.translate.x+l,this.view.translate.y+c),te.consume(s)}else this.currentZoomLevel*=e?$e:Jn}createMouseWheelZoomListener(e){return(s,i)=>{if(te.isConsumed(s)||!(s instanceof MouseEvent))return;s.ctrlKey&&!s.altKey&&!s.shiftKey&&!s.metaKey&&this.manageMouseWheelZoomEvent(i,s,e)}}getEventRelativeCoordinates(e){const s=this.container.getBoundingClientRect(),i=e.clientX-s.left,o=e.clientY-s.top;return[i,o]}getScaleAndTranslationDeltas(e,s){const[i,o]=this.calculateFactorAndScale(),[a,r]=this.calculateTranslationDeltas(i,o,e*2,s*2);return[o,a,r]}calculateTranslationDeltas(e,s,i,o){if(e>1){const a=(e-1)/(s*2);i*=-a,o*=-a}else{const a=(1/e-1)/(this.view.scale*2);i*=a,o*=a}return[i,o]}calculateFactorAndScale(){const e=Math.round(this.currentZoomLevel*100)/100;return[e/this.view.scale,e]}}class es extends D.mxGraphView{getFloatingTerminalPoint(t,e,s,i){if(t.absolutePoints.filter(Boolean).length<2)return super.getFloatingTerminalPoint(t,e,s,i);const r=t.absolutePoints;return i?r[1]:r.at(-2)}}class ts{configureMarkers(){this.registerArrowDashMarker()}registerArrowDashMarker(){const t=(e,s,i,o,a,r,l,c,f)=>{const T=a*(l+f+4),p=r*(l+f+4);return function(){e.begin(),e.moveTo(o.x-T/2-p/2,o.y-p/2+T/2),e.lineTo(o.x+p/2-3*T/2,o.y-3*p/2-T/2),e.stroke()}};D.mxMarker.addMarker(Ut.ARROW_DASH,t)}}const ns=[W.LOOP,W.MULTI_INSTANCE_PARALLEL,W.MULTI_INSTANCE_SEQUENTIAL,W.COMPENSATION,W.EXPAND,W.ADHOC];function ss(n){const t=ns.filter(e=>n.includes(e));for(const e of n.filter(s=>!t.includes(s)))t.push(e);return t}function is(n,t){return n===1?e=>e.setIconOriginForIconBottomCentered():e=>{e.setIconOriginForIconBottomCentered();const s=Math.pow(-1,t)*(R.SHAPE_ACTIVITY_MARKER_ICON_SIZE+R.SHAPE_ACTIVITY_MARKER_ICON_MARGIN)/2;e.translateIconOrigin(s,0)}}class tt extends Je{constructor(){super(void 0,void 0,void 0);y(this,"iconPainter");y(this,"markerPainterFunctions",new Map([[W.EXPAND,e=>this.iconPainter.paintExpandIcon(e)],[W.LOOP,e=>this.iconPainter.paintLoopIcon(e)],[W.MULTI_INSTANCE_PARALLEL,e=>this.iconPainter.paintParallelMultiInstanceIcon(e)],[W.MULTI_INSTANCE_SEQUENTIAL,e=>this.iconPainter.paintSequentialMultiInstanceIcon(e)]]))}paintForeground(e,s,i,o,a){super.paintForeground(e,s,i,o,a),this.paintMarkerIcons(ae({canvas:e,x:s,y:i,width:o,height:a,shape:this,ratioFromParent:0,iconStrokeWidth:1.5}))}paintMarkerIcons(e){var i;const s=Y.getValue(this.style,x.MARKERS,void 0);if(s){const o=ss(s.split(","));for(const[a,r]of o.entries())e={...e,setIconOriginFunct:is(o.length,a+1)},e.canvas.save(),(i=this.markerPainterFunctions.get(r))==null||i(e),e.canvas.restore()}}paintEnvelopeIcon(e,s){this.iconPainter.paintEnvelopeIcon({...e,setIconOriginFunct:i=>i.setIconOriginToShapeTopLeft(),ratioFromParent:.2,iconStyleConfig:{...e.iconStyleConfig,isFilled:s}})}}class ie extends tt{paintForeground(t,e,s,i,o){super.paintForeground(t,e,s,i,o),this.paintTaskIcon(ae({canvas:t,x:e,y:s,width:i,height:o,shape:this}))}}class os extends ie{paintTaskIcon(t){}}class rs extends ie{paintTaskIcon(t){this.iconPainter.paintGearIcon({...t,setIconOriginFunct:e=>e.setIconOriginToShapeTopLeftProportionally(20)})}}class ls extends ie{paintTaskIcon(t){this.iconPainter.paintPersonIcon({...t,setIconOriginFunct:e=>e.setIconOriginToShapeTopLeftProportionally(20)})}}class as extends ie{paintTaskIcon(t){if(!Wt(this.style)){this.paintEnvelopeIcon(t,!1);return}const e=4,s=4,i={...t.shapeConfig,width:20,height:20};this.iconPainter.paintCircleIcon({canvas:t.canvas,shapeConfig:i,iconStyleConfig:{...t.iconStyleConfig,isFilled:!1},ratioFromParent:void 0,setIconOriginFunct:o=>o.setIconOriginToShapeTopLeft(s,e)}),i.x+=e,i.y+=s,this.iconPainter.paintEnvelopeIcon({...t,shapeConfig:i,ratioFromParent:.65,setIconOriginFunct:o=>o.setIconOriginForIconCentered()})}}class cs extends ie{paintTaskIcon(t){this.paintEnvelopeIcon(t,!0)}}class us extends ie{paintTaskIcon(t){this.iconPainter.paintHandIcon({...t,ratioFromParent:.18,setIconOriginFunct:e=>e.setIconOriginToShapeTopLeftProportionally(20)})}}class ds extends ie{paintTaskIcon(t){this.iconPainter.paintScriptIcon({...t,ratioFromParent:.22,setIconOriginFunct:e=>e.setIconOriginToShapeTopLeftProportionally(20)})}}class hs extends tt{paintForeground(t,e,s,i,o){super.paintForeground(t,e,s,i,o);const a=ae({canvas:t,x:e,y:s,width:i,height:o,shape:this});switch(Y.getValue(this.style,x.GLOBAL_TASK_KIND,void 0)){case C.GLOBAL_TASK_MANUAL:{this.iconPainter.paintHandIcon({...a,ratioFromParent:.18,setIconOriginFunct:r=>r.setIconOriginToShapeTopLeftProportionally(20)});break}case C.GLOBAL_TASK_SCRIPT:{this.iconPainter.paintScriptIcon({...a,ratioFromParent:.22,setIconOriginFunct:r=>r.setIconOriginToShapeTopLeftProportionally(20)});break}case C.GLOBAL_TASK_USER:{this.iconPainter.paintPersonIcon({...a,setIconOriginFunct:r=>r.setIconOriginToShapeTopLeftProportionally(20)});break}case C.GLOBAL_TASK_BUSINESS_RULE:{this.iconPainter.paintTableIcon({...a,ratioFromParent:.6,setIconOriginFunct:r=>r.setIconOriginToShapeTopLeftProportionally(15)});break}}}}class fs extends tt{paintBackground(t,e,s,i,o){const a=Y.getValue(this.style,x.SUB_PROCESS_KIND,void 0);if(t.save(),a===ee.EVENT&&(t.setDashed(!0,!1),t.setDashPattern("1 2")),super.paintBackground(t,e,s,i,o),a===ee.TRANSACTION){const r=R.SUB_PROCESS_TRANSACTION_INNER_RECT_OFFSET,l=R.SUB_PROCESS_TRANSACTION_INNER_RECT_ARC_SIZE;t.roundrect(e+r,s+r,i-2*r,o-2*r,l,l),t.stroke()}t.restore()}}class gs extends ie{paintTaskIcon(t){this.iconPainter.paintTableIcon({...t,ratioFromParent:.6,setIconOriginFunct:e=>e.setIconOriginToShapeTopLeftProportionally(15)})}}class Ts extends D.mxConnector{paintEdgeShape(t,e){const s=this.createMarker(t,e,!0),i=this.createMarker(t,e,!1);this.paintEdgeLine(t,e),t.setShadow(!1),t.setDashed(!1,!1),s!=null&&(t.setFillColor(Y.getValue(this.style,x.EDGE_START_FILL_COLOR,this.stroke)),s()),i!=null&&(t.setFillColor(Y.getValue(this.style,x.EDGE_END_FILL_COLOR,this.stroke)),i())}paintEdgeLine(t,e){const s=ps(t);pt(t,"stroke"),this.paintLine(t,e,this.isRounded),pt(t,s)}}function ps(n){return n instanceof Qe?n.pointerEventsValue:null}function pt(n,t){n instanceof Qe&&(n.pointerEventsValue=t)}class nt extends D.mxEllipse{constructor(){super(void 0,void 0,void 0);y(this,"iconPainter");y(this,"iconPainters",new Map([[H.MESSAGE,e=>this.iconPainter.paintEnvelopeIcon({...e,ratioFromParent:.5})],[H.TERMINATE,e=>this.iconPainter.paintCircleIcon({...e,ratioFromParent:.6})],[H.TIMER,e=>this.iconPainter.paintClockIcon({...e,setIconOriginFunct:s=>s.setIconOriginToShapeTopLeftProportionally(5)})],[H.SIGNAL,e=>this.iconPainter.paintTriangleIcon({...e,ratioFromParent:.55,iconStyleConfig:{...e.iconStyleConfig,strokeWidth:R.STROKE_WIDTH_THIN.valueOf()},setIconOriginFunct:s=>s.setIconOriginToShapeTopLeftProportionally(4)})],[H.LINK,e=>this.iconPainter.paintRightArrowIcon({...e,ratioFromParent:.55,iconStyleConfig:{...e.iconStyleConfig,strokeWidth:1.5}})],[H.ERROR,e=>this.iconPainter.paintErrorIcon({...e,ratioFromParent:.55,iconStyleConfig:{...e.iconStyleConfig,strokeWidth:1.5}})],[H.COMPENSATION,e=>this.iconPainter.paintDoubleLeftArrowheadsIcon({...e,ratioFromParent:.7,iconStyleConfig:{...e.iconStyleConfig,strokeWidth:1.5}})],[H.CANCEL,e=>this.iconPainter.paintXCrossIcon({...e,ratioFromParent:.78})],[H.ESCALATION,e=>this.iconPainter.paintUpArrowheadIcon({...e,ratioFromParent:.55,iconStyleConfig:{...e.iconStyleConfig,strokeWidth:R.STROKE_WIDTH_THIN.valueOf()}})],[H.CONDITIONAL,e=>this.iconPainter.paintListIcon({...e,ratioFromParent:.6,iconStyleConfig:{...e.iconStyleConfig,strokeWidth:1.5}})]]));y(this,"withFilledIcon",!1)}paintVertexShape(e,s,i,o,a){const r=ae({canvas:e,x:s,y:i,width:o,height:a,shape:this,isFilled:this.withFilledIcon});Es(r,Y.getValue(this.style,x.IS_INTERRUPTING,void 0)),this.paintOuterShape(r),Ss(r),this.paintInnerShape(r)}paintOuterShape({canvas:e,shapeConfig:{x:s,y:i,width:o,height:a}}){super.paintVertexShape(e,s,i,o,a)}paintInnerShape(e){const s=this.iconPainters.get(Y.getValue(this.style,x.EVENT_DEFINITION_KIND,H.NONE));s==null||s(e)}}function Es(n,t){n.canvas.save(),t==="false"&&(n.canvas.setDashed(!0,!1),n.canvas.setDashPattern("3 2"))}function Ss(n){n.canvas.restore()}class ms extends nt{constructor(){super(),this.withFilledIcon=!0}}class Ze extends nt{paintOuterShape({canvas:t,shapeConfig:{x:e,y:s,width:i,height:o,strokeWidth:a}}){t.ellipse(e,s,i,o),t.fillAndStroke();const r=a*1.5;t.ellipse(i*.02+r+e,o*.02+r+s,i*.96-2*r,o*.96-2*r),t.stroke()}}class Cs extends Ze{constructor(){super(),this.withFilledIcon=!0}}class Is extends Je{constructor(){super(...arguments);y(this,"iconPainter")}paintVertexShape(e,s,i,o,a){const r=ae({canvas:e,x:s,y:i,width:o,height:a,shape:this,ratioFromParent:1,isFilled:Y.getValue(this.style,x.IS_INITIATING,"true")=="false"});this.iconPainter.paintEnvelopeIcon(r)}}class Te extends D.mxRhombus{constructor(){super(...arguments);y(this,"iconPainter")}paintVertexShape(e,s,i,o,a){const r=ae({canvas:e,x:s,y:i,width:o,height:a,shape:this});this.paintOuterShape(r),this.paintInnerShape(r)}paintOuterShape({canvas:e,shapeConfig:{x:s,y:i,width:o,height:a}}){super.paintVertexShape(e,s,i,o,a)}}class As extends Te{paintInnerShape(t){this.iconPainter.paintXCrossIcon({...t,iconStyleConfig:{...t.iconStyleConfig,isFilled:!0},ratioFromParent:.5})}}class Ns extends Te{paintInnerShape(t){this.iconPainter.paintPlusCrossIcon({...t,iconStyleConfig:{...t.iconStyleConfig,isFilled:!0},ratioFromParent:.5})}}class Os extends Te{paintInnerShape(t){this.iconPainter.paintCircleIcon({...t,ratioFromParent:.62,iconStyleConfig:{...t.iconStyleConfig,isFilled:!1,strokeWidth:R.STROKE_WIDTH_THICK.valueOf()}})}}class Ls extends Te{paintInnerShape(t){this.iconPainter.paintAsteriskIcon({...t,iconStyleConfig:{...t.iconStyleConfig,isFilled:!0},ratioFromParent:.5})}}class vs extends Te{paintInnerShape(t){t={...t,iconStyleConfig:{...t.iconStyleConfig,strokeWidth:1}},this.iconPainter.paintCircleIcon({...t,ratioFromParent:.55}),Wt(this.style)||this.iconPainter.paintCircleIcon({...t,ratioFromParent:.45});const e={...t,ratioFromParent:.3};Y.getValue(this.style,x.EVENT_BASED_GATEWAY_KIND,he.Exclusive)==he.Parallel?this.iconPainter.paintPlusCrossIcon(e):this.iconPainter.paintPentagon(e)}}class _s extends Je{paintForeground(t,e,s,i,o){t.begin(),t.moveTo(e+R.TEXT_ANNOTATION_BORDER_LENGTH,s),t.lineTo(e,s),t.lineTo(e,s+o),t.lineTo(e+R.TEXT_ANNOTATION_BORDER_LENGTH,s+o),t.stroke()}paintBackground(t,e,s,i,o){t.save(),t.setStrokeColor("none"),super.paintBackground(t,e,s,i,o),t.restore()}}const ys=()=>{const n=[[C.EVENT_END,ms],[C.EVENT_START,nt],[C.EVENT_INTERMEDIATE_THROW,Cs],[C.EVENT_INTERMEDIATE_CATCH,Ze],[C.EVENT_BOUNDARY,Ze],[C.GATEWAY_COMPLEX,Ls],[C.GATEWAY_EVENT_BASED,vs],[C.GATEWAY_EXCLUSIVE,As],[C.GATEWAY_INCLUSIVE,Os],[C.GATEWAY_PARALLEL,Ns],[C.SUB_PROCESS,fs],[C.CALL_ACTIVITY,hs],[C.TASK,os],[C.TASK_SERVICE,rs],[C.TASK_USER,ls],[C.TASK_RECEIVE,as],[C.TASK_SEND,cs],[C.TASK_MANUAL,us],[C.TASK_SCRIPT,ds],[C.TASK_BUSINESS_RULE,gs],[C.TEXT_ANNOTATION,_s],[x.EDGE,Ts],[x.MESSAGE_FLOW_ICON,Is]];for(const[t,e]of n)Cn.registerShape(t,e)};class ws{configureShapes(){ys()}}const Xt=12;class st extends Map{get(t){return super.get(t)??(()=>{})}}const Rs=new st([[Z.SEQUENCE_FLOW,n=>{n[u.STYLE_ENDARROW]=u.ARROW_BLOCK_THIN}],[Z.MESSAGE_FLOW,n=>{n[u.STYLE_DASHED]=!0,n[u.STYLE_DASH_PATTERN]="8 5",n[u.STYLE_STARTARROW]=u.ARROW_OVAL,n[u.STYLE_STARTSIZE]=8,n[u.STYLE_STARTFILL]=!0,n[x.EDGE_START_FILL_COLOR]=R.MESSAGE_FLOW_MARKER_START_FILL_COLOR,n[u.STYLE_ENDARROW]=u.ARROW_BLOCK_THIN,n[u.STYLE_ENDFILL]=!0,n[x.EDGE_END_FILL_COLOR]=R.MESSAGE_FLOW_MARKER_END_FILL_COLOR}],[Z.ASSOCIATION_FLOW,n=>{n[u.STYLE_DASHED]=!0,n[u.STYLE_DASH_PATTERN]="1 2",n[u.STYLE_STARTSIZE]=Xt}]]),bs=new st([[Q.DEFAULT,n=>{n[u.STYLE_STARTARROW]=Ut.ARROW_DASH}],[Q.CONDITIONAL_FROM_ACTIVITY,n=>{n[u.STYLE_STARTARROW]=u.ARROW_DIAMOND_THIN,n[u.STYLE_STARTSIZE]=18,n[u.STYLE_STARTFILL]=!0,n[x.EDGE_START_FILL_COLOR]=R.SEQUENCE_FLOW_CONDITIONAL_FROM_ACTIVITY_MARKER_FILL_COLOR}]]),Fs=new st([[re.NONE,n=>{}],[re.ONE,n=>{n[u.STYLE_ENDARROW]=u.ARROW_OPEN_THIN}],[re.BOTH,n=>{n[u.STYLE_STARTARROW]=u.ARROW_OPEN_THIN,n[u.STYLE_ENDARROW]=u.ARROW_OPEN_THIN}]]);class qt{constructor(t){this.graph=t}configureStyles(){this.configureDefaultVertexStyle(),this.configurePoolStyle(),this.configureLaneStyle(),this.configureTextAnnotationStyle(),this.configureGroupStyle(),this.configureActivityStyles(),this.configureEventStyles(),this.configureGatewayStyles(),this.configureDefaultEdgeStyle(),this.configureFlowStyles()}getStylesheet(){return this.graph.getStylesheet()}putCellStyle(t,e){this.getStylesheet().putCellStyle(t,e)}configureDefaultVertexStyle(){const t=this.getStylesheet().getDefaultVertexStyle();Et(t),t[u.STYLE_ABSOLUTE_ARCSIZE]=!0,t[u.STYLE_ARCSIZE]=R.SHAPE_ARC_SIZE}configurePoolStyle(){const t={};t[u.STYLE_SHAPE]=u.SHAPE_SWIMLANE,t[u.STYLE_VERTICAL_ALIGN]=u.ALIGN_MIDDLE,t[u.STYLE_ALIGN]=u.ALIGN_CENTER,t[u.STYLE_STARTSIZE]=R.POOL_LABEL_SIZE,t[u.STYLE_FILLCOLOR]=R.POOL_LABEL_FILL_COLOR,this.graph.getStylesheet().putCellStyle(C.POOL,t)}configureLaneStyle(){const t={};t[u.STYLE_SHAPE]=u.SHAPE_SWIMLANE,t[u.STYLE_VERTICAL_ALIGN]=u.ALIGN_MIDDLE,t[u.STYLE_ALIGN]=u.ALIGN_CENTER,t[u.STYLE_SWIMLANE_LINE]=0,t[u.STYLE_STARTSIZE]=R.LANE_LABEL_SIZE,t[u.STYLE_FILLCOLOR]=R.LANE_LABEL_FILL_COLOR,this.graph.getStylesheet().putCellStyle(C.LANE,t)}configureEventStyles(){for(const t of F.eventKinds()){const e={};e[u.STYLE_SHAPE]=t,e[u.STYLE_PERIMETER]=ht.EllipsePerimeter,e[u.STYLE_STROKEWIDTH]=t==C.EVENT_END?R.STROKE_WIDTH_THICK:R.STROKE_WIDTH_THIN,e[u.STYLE_VERTICAL_LABEL_POSITION]=u.ALIGN_BOTTOM,this.putCellStyle(t,e)}}configureTextAnnotationStyle(){const t={};t[u.STYLE_SHAPE]=C.TEXT_ANNOTATION,t[u.STYLE_VERTICAL_ALIGN]=u.ALIGN_MIDDLE,t[u.STYLE_ALIGN]=u.ALIGN_LEFT,t[u.STYLE_SPACING_LEFT]=5,t[u.STYLE_FILLCOLOR]=R.TEXT_ANNOTATION_FILL_COLOR,t[u.STYLE_STROKEWIDTH]=R.STROKE_WIDTH_THIN,this.putCellStyle(C.TEXT_ANNOTATION,t)}configureGroupStyle(){const t={};t[u.STYLE_ROUNDED]=!0,t[u.STYLE_DASHED]=!0,t[u.STYLE_DASH_PATTERN]="7 4 1 4",t[u.STYLE_STROKEWIDTH]=R.STROKE_WIDTH_THIN,t[u.STYLE_FILLCOLOR]=R.GROUP_FILL_COLOR,t[u.STYLE_ALIGN]=u.ALIGN_CENTER,t[u.STYLE_VERTICAL_ALIGN]=u.ALIGN_TOP,this.putCellStyle(C.GROUP,t)}configureActivityStyles(){for(const t of F.activityKinds()){const e={};e[u.STYLE_SHAPE]=t,e[u.STYLE_ROUNDED]=!0,e[u.STYLE_VERTICAL_ALIGN]=u.ALIGN_MIDDLE,e[u.STYLE_STROKEWIDTH]=t==C.CALL_ACTIVITY?R.STROKE_WIDTH_THICK:R.STROKE_WIDTH_THIN,this.putCellStyle(t,e)}}configureGatewayStyles(){for(const t of F.gatewayKinds()){const e={};e[u.STYLE_SHAPE]=t,e[u.STYLE_PERIMETER]=ht.RhombusPerimeter,e[u.STYLE_STROKEWIDTH]=R.STROKE_WIDTH_THIN,e[u.STYLE_VERTICAL_ALIGN]=u.ALIGN_TOP,e[u.STYLE_LABEL_POSITION]=u.ALIGN_LEFT,e[u.STYLE_VERTICAL_LABEL_POSITION]=u.ALIGN_TOP,this.putCellStyle(t,e)}}configureDefaultEdgeStyle(){const t=this.getStylesheet().getDefaultEdgeStyle();Et(t),t[u.STYLE_SHAPE]=x.EDGE,t[u.STYLE_ENDSIZE]=Xt,t[u.STYLE_STROKEWIDTH]=1.5,t[u.STYLE_ROUNDED]=!0,t[u.STYLE_ARCSIZE]=5,t[u.STYLE_VERTICAL_ALIGN]=u.ALIGN_BOTTOM,delete t[u.STYLE_ENDARROW]}configureEdgeStyles(t,e){for(const s of t){const i={};e.get(s)(i),this.graph.getStylesheet().putCellStyle(s.toString(),i)}}configureFlowStyles(){this.configureEdgeStyles(Object.values(Z),Rs),this.configureEdgeStyles(Object.values(Q),bs),this.configureEdgeStyles(Object.values(re),Fs)}}function Et(n){n[u.STYLE_FONTFAMILY]=R.DEFAULT_FONT_FAMILY,n[u.STYLE_FONTSIZE]=R.DEFAULT_FONT_SIZE,n[u.STYLE_FONTCOLOR]=R.DEFAULT_FONT_COLOR,n[u.STYLE_FILLCOLOR]=R.DEFAULT_FILL_COLOR,n[u.STYLE_STROKECOLOR]=R.DEFAULT_STROKE_COLOR,n[u.STYLE_LABEL_BACKGROUNDCOLOR]=u.NONE,n[u.STYLE_WHITE_SPACE]="wrap"}class Ps{constructor(t){y(this,"graph");this.graph=new Qn(t)}configure(t){return this.configureGraph(),this.configureNavigationSupport(t),new qt(this.graph).configureStyles(),new ws().configureShapes(),new ts().configureMarkers(),this.graph}configureGraph(){this.graph.setCellsLocked(!0),this.graph.setCellsSelectable(!1),this.graph.setEdgeLabelsMovable(!1),this.graph.setHtmlLabels(!0),this.graph.setConstrainChildren(!1),this.graph.setExtendParents(!1),this.graph.foldingEnabled=!1}configureNavigationSupport(t){var s;const e=this.graph.panningHandler;(s=t==null?void 0:t.navigation)!=null&&s.enabled?(e.addListener(te.PAN_START,St(this.graph,"grab")),e.addListener(te.PAN_END,St(this.graph,"default")),e.usePopupTrigger=!1,e.isForcePanningEvent=i=>te.isLeftMouseButton(i.getEvent())||te.isMultiTouchEvent(i.getEvent()),this.graph.setPanning(!0),this.graph.registerMouseWheelZoomListeners(t.navigation.zoom)):(this.graph.setPanning(!1),e.setPinchEnabled(!1),e.isForcePanningEvent=i=>!1)}}function St(n,t){return()=>{n.container.style.cursor=t}}class xs{constructor(t){this.graph=t}fit(t){this.graph.customFit(t)}zoom(t){t=="in"?this.graph.zoomIn():this.graph.zoomOut()}}class ks{constructor(t){this.convertedElements=t}deserialize(t){const e=P(t.category).flatMap(s=>P(s.categoryValue));for(const s of e)this.convertedElements.registerCategoryValue(s.id,s.value)}}class ce{}class Bs{constructor(t){this.options=t}warning(t){var s;if((s=this.options)!=null&&s.disableConsoleLog)return;const e=t.getMessage();console.warn(`[bv-parser] ${e.template}`,...e.arguments)}}class Ms extends ce{constructor(t,e){super(),this.groupBpmnElementId=t,this.categoryValueReference=e}getMessage(){return{arguments:[this.categoryValueReference,this.groupBpmnElementId],template:"Group json deserialization: unable to find category value ref %s for bpmn element %s"}}}class Vs extends ce{constructor(t){super(),this.bpmnElementId=t}getMessage(){return{arguments:[this.bpmnElementId],template:"Shape json deserialization: unable to find bpmn element with id %s"}}}class Ys extends ce{constructor(t){super(),this.bpmnElementId=t}getMessage(){return{arguments:[this.bpmnElementId],template:"Edge json deserialization: unable to find bpmn element with id %s"}}}class Gs extends ce{constructor(t,e){super(),this.shapeOrEdgeId=t,this.labelStyleId=e}getMessage(){return{arguments:[this.labelStyleId,this.shapeOrEdgeId],template:"Unable to assign font from style %s to shape/edge %s"}}}class Ds extends ce{constructor(t,e){super(),this.laneId=t,this.flowNodeReference=e}getMessage(){return{arguments:[this.flowNodeReference,this.laneId],template:"Unable to assign lane %s as parent: flow node %s is not found"}}}class Us extends ce{constructor(t,e,s){super(),this.bpmnElementId=t,this.attachedToReference=e,this.attachedToKind=s}getMessage(){return{arguments:[this.bpmnElementId,this.attachedToReference,this.attachedToKind],template:"The boundary event %s must be attached to an activity, and not to %s of kind %s"}}}class Ws{constructor(){y(this,"poolsById",new Map);y(this,"poolsByProcessRef",new Map);y(this,"messageFlows",new Map);y(this,"flowNodes",new Map);y(this,"lanes",new Map);y(this,"sequenceFlows",new Map);y(this,"associationFlows",new Map);y(this,"eventDefinitionsOfDefinitions",new Map);y(this,"globalTasks",new Map);y(this,"categoryValues",new Map)}getFlows(){return[...this.messageFlows.values(),...this.sequenceFlows.values(),...this.associationFlows.values()]}findPoolById(t){return this.poolsById.get(t)}findPoolByProcessRef(t){return this.poolsByProcessRef.get(t)}registerPool(t,e){this.poolsById.set(t.id,t),e&&this.poolsByProcessRef.set(e,t)}findMessageFlow(t){return this.messageFlows.get(t)}registerMessageFlow(t){this.messageFlows.set(t.id,t)}findFlowNode(t){return this.flowNodes.get(t)}registerFlowNode(t){this.flowNodes.set(t.id,t)}findLane(t){return this.lanes.get(t)}registerLane(t){this.lanes.set(t.id,t)}findSequenceFlow(t){return this.sequenceFlows.get(t)}registerSequenceFlow(t){this.sequenceFlows.set(t.id,t)}findAssociationFlow(t){return this.associationFlows.get(t)}registerAssociationFlow(t){this.associationFlows.set(t.id,t)}findEventDefinitionOfDefinition(t){return this.eventDefinitionsOfDefinitions.get(t)}registerEventDefinitionsOfDefinition(t,e){this.eventDefinitionsOfDefinitions.set(t,e)}findGlobalTask(t){return this.globalTasks.get(t)}registerGlobalTask(t,e){this.globalTasks.set(t,e)}findCategoryValue(t){return this.categoryValues.get(t)}registerCategoryValue(t,e){this.categoryValues.set(t,{value:e})}}const $t=(n,t,e,s)=>{const i=n.findCategoryValue(e.categoryValueRef);if(i)return new J(e.id,i.value,C.GROUP,s);t.warning(new Ms(e.id,e.categoryValueRef))},Zt=(n,t)=>{for(const e of P(t)){const s=e.associationDirection;n.registerAssociationFlow(new Vt(e.id,void 0,e.sourceRef,e.targetRef,s))}};class Hs{constructor(t,e){this.convertedElements=t,this.parsingMessageCollector=e}deserialize(t){for(const e of P(t))this.parseCollaboration(e)}parseCollaboration(t){this.buildParticipant(t.participant),this.buildMessageFlows(t.messageFlow),Zt(this.convertedElements,t.association),this.buildGroups(t.group),this.buildTextAnnotation(t.textAnnotation)}buildParticipant(t){for(const e of P(t))this.convertedElements.registerPool(new J(e.id,e.name,C.POOL),e.processRef)}buildMessageFlows(t){for(const e of P(t))this.convertedElements.registerMessageFlow(new Mt(e.id,e.name,e.sourceRef,e.targetRef))}buildGroups(t){for(const e of P(t)){const s=$t(this.convertedElements,this.parsingMessageCollector,e);s&&this.convertedElements.registerFlowNode(s)}}buildTextAnnotation(t){for(const e of P(t))this.convertedElements.registerFlowNode(new J(e.id,e.text,C.TEXT_ANNOTATION))}}class Ks{constructor(t,e,s,i){this.x=t,this.y=e,this.width=s,this.height=i}}class zs{constructor(t,e,s,i,o=fe.NONE){y(this,"extensions",{});this.id=t,this.bpmnElement=e,this.waypoints=s,this.label=i,this.messageVisibleKind=o}}class Xs{constructor(t,e){this.x=t,this.y=e}}class qs{constructor(t,e){y(this,"extensions",{});this.font=t,this.bounds=e}}class $s{constructor(t,e,s,i,o,a){this.name=t,this.size=e,this.isBold=s,this.isItalic=i,this.isUnderline=o,this.isStrikeThrough=a}}class Zs{constructor(t,e){y(this,"convertedFonts",new Map);this.convertedElements=t,this.parsingMessageCollector=e}deserialize(t){const e=[],s=[],i=[],o=[],a=P(t)[0];if(a){this.deserializeFonts(a.BPMNLabelStyle);const r=a.BPMNPlane,l=this.deserializeEdges(r.BPMNEdge),c=this.deserializeShapes(r.BPMNShape);e.push(...c.flowNodes),s.push(...c.lanes),i.push(...c.pools),o.push(...l)}return{flowNodes:e,lanes:s,pools:i,edges:o}}deserializeFonts(t){for(const e of P(t))for(const s of P(e.Font))this.convertedFonts.set(e.id,new $s(s.name,s.size,s.isBold,s.isItalic,s.isUnderline,s.isStrikeThrough))}deserializeShapes(t){const e={flowNodes:[],lanes:[],pools:[]};for(const s of P(t))this.deserializeShapeAndStoreIfFound(s,e.flowNodes,i=>this.convertedElements.findFlowNode(i))||this.deserializeShapeAndStoreIfFound(s,e.lanes,i=>this.convertedElements.findLane(i))||this.deserializeShapeAndStoreIfFound(s,e.pools,i=>this.convertedElements.findPoolById(i))||this.parsingMessageCollector.warning(new Vs(s.bpmnElement));return e}deserializeShapeAndStoreIfFound(t,e,s){const i=this.deserializeShape(t,s);return i?(e.push(i),!0):!1}deserializeShape(t,e){const s=e(t.bpmnElement);if(s){const i=mt(t);(s instanceof ge||s instanceof oe&&s.callActivityKind===de.CALLING_PROCESS)&&!t.isExpanded&&s.markers.push(W.EXPAND);let o;F.isPoolOrLane(s.kind)&&(o=t.isHorizontal??!0);const a=t.BPMNLabel,r=this.deserializeLabel(a,t.id),l=new me(t.id,s,i,r,o);return js(l,t),l}}deserializeEdges(t){return P(t).map(e=>{const s=this.convertedElements.findSequenceFlow(e.bpmnElement)||this.convertedElements.findMessageFlow(e.bpmnElement)||this.convertedElements.findAssociationFlow(e.bpmnElement);if(!s){this.parsingMessageCollector.warning(new Ys(e.bpmnElement));return}const i=this.deserializeWaypoints(e.waypoint),o=this.deserializeLabel(e.BPMNLabel,e.id),a=e.messageVisibleKind?e.messageVisibleKind:fe.NONE,r=new zs(e.id,s,i,o,a);return Js(r,e),r}).filter(Boolean)}deserializeWaypoints(t){return P(t).map(e=>new Xs(e.x,e.y))}deserializeLabel(t,e){if(t&&typeof t=="object"){const s=this.findFont(t.labelStyle,e),i=mt(t),o=new qs(s,i);if("color"in t)return o.extensions.color=t.color,o;if(s||i)return o}}findFont(t,e){let s;return t&&(s=this.convertedFonts.get(t),s||this.parsingMessageCollector.warning(new Gs(e,t))),s}}function js(n,t){"background-color"in t?n.extensions.fillColor=t["background-color"]:"fill"in t&&(n.extensions.fillColor=t.fill),"border-color"in t?n.extensions.strokeColor=t["border-color"]:"stroke"in t&&(n.extensions.strokeColor=t.stroke)}function mt(n){const t=n.Bounds;if(t)return new Ks(t.x,t.y,t.width,t.height)}function Js(n,t){"border-color"in t?n.extensions.strokeColor=t["border-color"]:"stroke"in t&&(n.extensions.strokeColor=t.stroke)}const Qs=n=>"source"in n||"target"in n;class ei{constructor(t){this.convertedElements=t}deserialize(t){for(const e of kt){const s=t[e+"EventDefinition"];for(const i of P(s,!0))this.convertedElements.registerEventDefinitionsOfDefinition(i.id,{id:i.id,kind:e,...Qs(i)?{source:i.source,target:i.target}:{}})}}}class ti{constructor(t){this.convertedElements=t}deserialize(t){this.parseGlobalTasks(t.globalTask,C.GLOBAL_TASK),this.parseGlobalTasks(t.globalBusinessRuleTask,C.GLOBAL_TASK_BUSINESS_RULE),this.parseGlobalTasks(t.globalManualTask,C.GLOBAL_TASK_MANUAL),this.parseGlobalTasks(t.globalScriptTask,C.GLOBAL_TASK_SCRIPT),this.parseGlobalTasks(t.globalUserTask,C.GLOBAL_TASK_USER)}parseGlobalTasks(t,e){for(const s of P(t))this.convertedElements.registerGlobalTask(s.id,e)}}const ni=(n,t)=>{switch(n){case"adHocSubProcess":return ee.AD_HOC;case"transaction":return ee.TRANSACTION;default:return t.triggeredByEvent?ee.EVENT:ee.EMBEDDED}},si=["adHocSubProcess","transaction",...F.flowNodeKinds().filter(n=>n!==C.EVENT_BOUNDARY),C.EVENT_BOUNDARY];function ii(n){return["adHocSubProcess","transaction"].includes(n)?C.SUB_PROCESS:n}class oi{constructor(t,e){y(this,"defaultSequenceFlowIds",[]);y(this,"elementsWithoutParentByProcessId",new Map);y(this,"callActivitiesCallingProcess",new Map);y(this,"eventsByLinkEventDefinition",new Map);this.convertedElements=t,this.parsingMessageCollector=e}deserialize(t){for(const e of P(t))this.parseProcess(e);for(const e of P(t))this.assignParentOfProcessElementsCalledByCallActivity(e.id);this.assignIncomingAndOutgoingIdsFromFlows(),this.assignSourceAndTargetIdsToLinkEvents()}assignParentOfProcessElementsCalledByCallActivity(t){const e=this.callActivitiesCallingProcess.get(t);if(e){const s=this.convertedElements.findPoolByProcessRef(t);s&&(s.parentId=e.id);for(const i of this.elementsWithoutParentByProcessId.get(t))i.parentId=e.id}}assignIncomingAndOutgoingIdsFromFlows(){const t=(e,s,i)=>{const o=this.convertedElements.findFlowNode(e)??this.convertedElements.findLane(e)??this.convertedElements.findPoolById(e);o&&!o[s].includes(i)&&o[s].push(i)};for(const e of this.convertedElements.getFlows())t(e.sourceReferenceId,"outgoingIds",e.id),t(e.targetReferenceId,"incomingIds",e.id)}assignSourceAndTargetIdsToLinkEvents(){var e;const t=[...this.eventsByLinkEventDefinition.entries()].filter(([s])=>s.id);for(const[s,i]of this.eventsByLinkEventDefinition)if(i instanceof ze){const o=t.find(([a])=>s.target===a.id);i.targetId=(e=o==null?void 0:o[1])==null?void 0:e.id}else i instanceof Ke&&(i.sourceIds=t.filter(([o])=>Array.isArray(s.source)?s.source.includes(o.id):s.source===o.id).map(([,o])=>o.id))}parseProcess(t){const e=t.id,s=this.convertedElements.findPoolByProcessRef(e);s&&!s.name&&this.convertedElements.registerPool(new J(s.id,t.name,C.POOL),e),this.buildProcessInnerElements(t,s==null?void 0:s.id)}buildProcessInnerElements(t,e){this.elementsWithoutParentByProcessId.set(t.id,[]);for(const s of si)this.buildFlowNodeBpmnElements(t[s],ii(s),e,t.id,s);this.buildLaneSetBpmnElements(t.laneSet,e,t.id),this.buildSequenceFlows(t.sequenceFlow),Zt(this.convertedElements,t.association)}buildFlowNodeBpmnElements(t,e,s,i,o){for(const a of P(t)){const r=this.buildFlowNodeBpmnElement(e,a,s,o);"default"in a&&F.isWithDefaultSequenceFlow(e)&&this.defaultSequenceFlowIds.push(a.default),r&&(this.convertedElements.registerFlowNode(r),s||this.elementsWithoutParentByProcessId.get(i).push(r))}}buildFlowNodeBpmnElement(t,e,s,i){if(F.isEvent(t))return this.buildShapeBpmnEvent(e,t,s);if(F.isActivity(t))return this.buildShapeBpmnActivity(e,t,s,i);if(t==C.GATEWAY_EVENT_BASED){const o=e;return new Dt(o.id,o.name,s,o.instantiate,he[o.eventGatewayType])}else{if(t==C.GROUP)return $t(this.convertedElements,this.parsingMessageCollector,e,s);{const o=t===C.TEXT_ANNOTATION?e.text:e.name;return new J(e.id,o,t,s,e.instantiate)}}}buildShapeBpmnActivity(t,e,s,i){const o=ri(t);return F.isSubProcess(e)?this.buildShapeBpmnSubProcess(t,s,ni(i,t),o):F.isCallActivity(e)?this.buildShapeBpmnCallActivity(t,s,o):new Oe(t.id,t.name,e,s,t.instantiate,o)}buildShapeBpmnCallActivity(t,e,s){const i=this.convertedElements.findGlobalTask(t.calledElement);if(!i){const o=new oe(t.id,t.name,de.CALLING_PROCESS,e,s);return this.callActivitiesCallingProcess.set(t.calledElement,o),o}return new oe(t.id,t.name,de.CALLING_GLOBAL_TASK,e,s,i)}buildShapeBpmnEvent(t,e,s){const i=this.getEventDefinitions(t),o=[...i.entries()].map(([,a])=>a.length).reduce((a,r)=>a+r,0);if(o==0&&F.canHaveNoneEvent(e))return new se(t.id,t.name,e,H.NONE,s);if(o==1){const[a,r]=[...i.entries()][0],l=F.isCatchEvent(e)?this.buildShapeBpmnCatchEvent(t,e,a,s):this.buildShapeBpmnThrowEvent(t,e,a,s);return a===H.LINK&&(r[0].id||r[0].target||r[0].source)&&this.eventsByLinkEventDefinition.set(r[0],l),l}}buildShapeBpmnCatchEvent(t,e,s,i){return F.isBoundaryEvent(e)?this.buildShapeBpmnBoundaryEvent(t,s):F.isStartEvent(e)?new Yt(t.id,t.name,s,i,t.isInterrupting):new Ke(t.id,t.name,s,i)}buildShapeBpmnThrowEvent(t,e,s,i){return F.isIntermediateThrowEvent(e)?new ze(t.id,t.name,s,i):new se(t.id,t.name,e,s,i)}buildShapeBpmnBoundaryEvent(t,e){const s=this.convertedElements.findFlowNode(t.attachedToRef);if(F.isActivity(s==null?void 0:s.kind))return new Gt(t.id,t.name,e,t.attachedToRef,t.cancelActivity);this.parsingMessageCollector.warning(new Us(t.id,t.attachedToRef,s==null?void 0:s.kind))}getEventDefinitions(t){const e=new Map;for(const s of kt){const i=t[`${s}EventDefinition`];e.set(s,P(i,!0))}for(const s of P(t.eventDefinitionRef)){const i=this.convertedElements.findEventDefinitionOfDefinition(s);i&&e.get(i.kind).push(i)}for(const[s]of[...e.entries()].filter(([,i])=>i.length===0))e.delete(s);return e}buildShapeBpmnSubProcess(t,e,s,i){const o=new ge(t.id,t.name,s,e,i);return this.buildProcessInnerElements(t,t.id),o}buildLaneSetBpmnElements(t,e,s){for(const i of P(t))this.buildLaneBpmnElements(i.lane,e,s)}buildLaneBpmnElements(t,e,s){var i;for(const o of P(t)){const a=new J(o.id,o.name,C.LANE,e);this.convertedElements.registerLane(a),e||this.elementsWithoutParentByProcessId.get(s).push(a),this.assignParentOfLaneFlowNodes(o),(i=o.childLaneSet)!=null&&i.lane&&this.buildLaneBpmnElements(o.childLaneSet.lane,o.id,s)}}assignParentOfLaneFlowNodes(t){for(const e of P(t.flowNodeRef)){const s=this.convertedElements.findFlowNode(e),i=t.id;s?F.isBoundaryEvent(s.kind)||(s.parentId=i):this.parsingMessageCollector.warning(new Ds(i,e))}}buildSequenceFlows(t){for(const e of P(t)){const s=this.getSequenceFlowKind(e);this.convertedElements.registerSequenceFlow(new Bt(e.id,e.name,e.sourceRef,e.targetRef,s))}}getSequenceFlowKind(t){if(this.defaultSequenceFlowIds.includes(t.id))return Q.DEFAULT;{const e=this.convertedElements.findFlowNode(t.sourceRef);if(e&&F.isWithDefaultSequenceFlow(e.kind)&&t.conditionExpression)return F.isActivity(e.kind)?Q.CONDITIONAL_FROM_ACTIVITY:Q.CONDITIONAL_FROM_GATEWAY}return Q.NORMAL}}const ri=n=>{const t=[],e=n.standardLoopCharacteristics,s=P(n.multiInstanceLoopCharacteristics,!0)[0];return e!==void 0?t.push(W.LOOP):s&&t.push(s.isSequential?W.MULTI_INSTANCE_SEQUENTIAL:W.MULTI_INSTANCE_PARALLEL),t};class li{constructor(t,e,s,i,o,a){this.categoryConverter=t,this.collaborationConverter=e,this.eventDefinitionConverter=s,this.globalTaskConverter=i,this.processConverter=o,this.diagramConverter=a}parse(t){const e=t.definitions;return this.categoryConverter.deserialize(e),this.collaborationConverter.deserialize(e.collaboration),this.eventDefinitionConverter.deserialize(e),this.globalTaskConverter.deserialize(e),this.processConverter.deserialize(e.process),this.diagramConverter.deserialize(e.BPMNDiagram)}}function ai(n){const t=new Ws;return new li(new ks(t),new Hs(t,n),new ei(t),new ti(t),new oi(t,n),new Zs(t,n))}var we={},Re={},Ct;function it(){return Ct||(Ct=1,function(n){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",e=t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",s="["+t+"]["+e+"]*",i=new RegExp("^"+s+"$"),o=function(r,l){const c=[];let f=l.exec(r);for(;f;){const T=[];T.startIndex=l.lastIndex-f[0].length;const p=f.length;for(let S=0;S<p;S++)T.push(f[S]);c.push(T),f=l.exec(r)}return c},a=function(r){const l=i.exec(r);return!(l===null||typeof l>"u")};n.isExist=function(r){return typeof r<"u"},n.isEmptyObject=function(r){return Object.keys(r).length===0},n.merge=function(r,l,c){if(l){const f=Object.keys(l),T=f.length;for(let p=0;p<T;p++)c==="strict"?r[f[p]]=[l[f[p]]]:r[f[p]]=l[f[p]]}},n.getValue=function(r){return n.isExist(r)?r:""},n.isName=a,n.getAllMatches=o,n.nameRegexp=s}(Re)),Re}var It;function jt(){if(It)return we;It=1;const n=it(),t={allowBooleanAttributes:!1,unpairedTags:[]};we.validate=function(d,E){E=Object.assign({},t,E);const v=[];let B=!1,h=!1;d[0]==="\uFEFF"&&(d=d.substr(1));for(let g=0;g<d.length;g++)if(d[g]==="<"&&d[g+1]==="?"){if(g+=2,g=s(d,g),g.err)return g}else if(d[g]==="<"){let m=g;if(g++,d[g]==="!"){g=i(d,g);continue}else{let w=!1;d[g]==="/"&&(w=!0,g++);let I="";for(;g<d.length&&d[g]!==">"&&d[g]!==" "&&d[g]!=="	"&&d[g]!==`
`&&d[g]!=="\r";g++)I+=d[g];if(I=I.trim(),I[I.length-1]==="/"&&(I=I.substring(0,I.length-1),g--),!O(I)){let _;return I.trim().length===0?_="Invalid space after '<'.":_="Tag '"+I+"' is an invalid name.",p("InvalidTag",_,L(d,g))}const N=r(d,g);if(N===!1)return p("InvalidAttr","Attributes for '"+I+"' have open quote.",L(d,g));let b=N.value;if(g=N.index,b[b.length-1]==="/"){const _=g-b.length;b=b.substring(0,b.length-1);const A=c(b,E);if(A===!0)B=!0;else return p(A.err.code,A.err.msg,L(d,_+A.err.line))}else if(w)if(N.tagClosed){if(b.trim().length>0)return p("InvalidTag","Closing tag '"+I+"' can't have attributes or invalid starting.",L(d,m));if(v.length===0)return p("InvalidTag","Closing tag '"+I+"' has not been opened.",L(d,m));{const _=v.pop();if(I!==_.tagName){let A=L(d,_.tagStartPos);return p("InvalidTag","Expected closing tag '"+_.tagName+"' (opened in line "+A.line+", col "+A.col+") instead of closing tag '"+I+"'.",L(d,m))}v.length==0&&(h=!0)}}else return p("InvalidTag","Closing tag '"+I+"' doesn't have proper closing.",L(d,g));else{const _=c(b,E);if(_!==!0)return p(_.err.code,_.err.msg,L(d,g-b.length+_.err.line));if(h===!0)return p("InvalidXml","Multiple possible root nodes found.",L(d,g));E.unpairedTags.indexOf(I)!==-1||v.push({tagName:I,tagStartPos:m}),B=!0}for(g++;g<d.length;g++)if(d[g]==="<")if(d[g+1]==="!"){g++,g=i(d,g);continue}else if(d[g+1]==="?"){if(g=s(d,++g),g.err)return g}else break;else if(d[g]==="&"){const _=T(d,g);if(_==-1)return p("InvalidChar","char '&' is not expected.",L(d,g));g=_}else if(h===!0&&!e(d[g]))return p("InvalidXml","Extra text at the end",L(d,g));d[g]==="<"&&g--}}else{if(e(d[g]))continue;return p("InvalidChar","char '"+d[g]+"' is not expected.",L(d,g))}if(B){if(v.length==1)return p("InvalidTag","Unclosed tag '"+v[0].tagName+"'.",L(d,v[0].tagStartPos));if(v.length>0)return p("InvalidXml","Invalid '"+JSON.stringify(v.map(g=>g.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return p("InvalidXml","Start tag expected.",1);return!0};function e(d){return d===" "||d==="	"||d===`
`||d==="\r"}function s(d,E){const v=E;for(;E<d.length;E++)if(d[E]=="?"||d[E]==" "){const B=d.substr(v,E-v);if(E>5&&B==="xml")return p("InvalidXml","XML declaration allowed only at the start of the document.",L(d,E));if(d[E]=="?"&&d[E+1]==">"){E++;break}else continue}return E}function i(d,E){if(d.length>E+5&&d[E+1]==="-"&&d[E+2]==="-"){for(E+=3;E<d.length;E++)if(d[E]==="-"&&d[E+1]==="-"&&d[E+2]===">"){E+=2;break}}else if(d.length>E+8&&d[E+1]==="D"&&d[E+2]==="O"&&d[E+3]==="C"&&d[E+4]==="T"&&d[E+5]==="Y"&&d[E+6]==="P"&&d[E+7]==="E"){let v=1;for(E+=8;E<d.length;E++)if(d[E]==="<")v++;else if(d[E]===">"&&(v--,v===0))break}else if(d.length>E+9&&d[E+1]==="["&&d[E+2]==="C"&&d[E+3]==="D"&&d[E+4]==="A"&&d[E+5]==="T"&&d[E+6]==="A"&&d[E+7]==="["){for(E+=8;E<d.length;E++)if(d[E]==="]"&&d[E+1]==="]"&&d[E+2]===">"){E+=2;break}}return E}const o='"',a="'";function r(d,E){let v="",B="",h=!1;for(;E<d.length;E++){if(d[E]===o||d[E]===a)B===""?B=d[E]:B!==d[E]||(B="");else if(d[E]===">"&&B===""){h=!0;break}v+=d[E]}return B!==""?!1:{value:v,index:E,tagClosed:h}}const l=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function c(d,E){const v=n.getAllMatches(d,l),B={};for(let h=0;h<v.length;h++){if(v[h][1].length===0)return p("InvalidAttr","Attribute '"+v[h][2]+"' has no space in starting.",M(v[h]));if(v[h][3]!==void 0&&v[h][4]===void 0)return p("InvalidAttr","Attribute '"+v[h][2]+"' is without value.",M(v[h]));if(v[h][3]===void 0&&!E.allowBooleanAttributes)return p("InvalidAttr","boolean attribute '"+v[h][2]+"' is not allowed.",M(v[h]));const g=v[h][2];if(!S(g))return p("InvalidAttr","Attribute '"+g+"' is an invalid name.",M(v[h]));if(!B.hasOwnProperty(g))B[g]=1;else return p("InvalidAttr","Attribute '"+g+"' is repeated.",M(v[h]))}return!0}function f(d,E){let v=/\d/;for(d[E]==="x"&&(E++,v=/[\da-fA-F]/);E<d.length;E++){if(d[E]===";")return E;if(!d[E].match(v))break}return-1}function T(d,E){if(E++,d[E]===";")return-1;if(d[E]==="#")return E++,f(d,E);let v=0;for(;E<d.length;E++,v++)if(!(d[E].match(/\w/)&&v<20)){if(d[E]===";")break;return-1}return E}function p(d,E,v){return{err:{code:d,msg:E,line:v.line||v,col:v.col}}}function S(d){return n.isName(d)}function O(d){return n.isName(d)}function L(d,E){const v=d.substring(0,E).split(/\r?\n/);return{line:v.length,col:v[v.length-1].length+1}}function M(d){return d.startIndex+d[1].length}return we}var Se={},At;function ci(){if(At)return Se;At=1;const n={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,s){return s},attributeValueProcessor:function(e,s){return s},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(e,s,i){return e}},t=function(e){return Object.assign({},n,e)};return Se.buildOptions=t,Se.defaultOptions=n,Se}var be,Nt;function ui(){if(Nt)return be;Nt=1;class n{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,s){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:s})}addChild(e){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}return be=n,be}var Fe,Ot;function di(){if(Ot)return Fe;Ot=1;const n=it();function t(l,c){const f={};if(l[c+3]==="O"&&l[c+4]==="C"&&l[c+5]==="T"&&l[c+6]==="Y"&&l[c+7]==="P"&&l[c+8]==="E"){c=c+9;let T=1,p=!1,S=!1,O="";for(;c<l.length;c++)if(l[c]==="<"&&!S){if(p&&s(l,c)){c+=7;let L,M;[L,M,c]=e(l,c+1),M.indexOf("&")===-1&&(f[r(L)]={regx:RegExp(`&${L};`,"g"),val:M})}else p&&i(l,c)||p&&o(l,c)?c+=8:p&&a(l,c)?c+=9:S=!0;T++,O=""}else if(l[c]===">"){if(S?l[c-1]==="-"&&l[c-2]==="-"&&(S=!1,T--):T--,T===0)break}else l[c]==="["?p=!0:O+=l[c];if(T!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:f,i:c}}function e(l,c){let f="";for(;c<l.length&&l[c]!=="'"&&l[c]!=='"';c++)f+=l[c];if(f=f.trim(),f.indexOf(" ")!==-1)throw new Error("External entites are not supported");const T=l[c++];let p="";for(;c<l.length&&l[c]!==T;c++)p+=l[c];return[f,p,c]}function s(l,c){return l[c+1]==="!"&&l[c+2]==="E"&&l[c+3]==="N"&&l[c+4]==="T"&&l[c+5]==="I"&&l[c+6]==="T"&&l[c+7]==="Y"}function i(l,c){return l[c+1]==="!"&&l[c+2]==="E"&&l[c+3]==="L"&&l[c+4]==="E"&&l[c+5]==="M"&&l[c+6]==="E"&&l[c+7]==="N"&&l[c+8]==="T"}function o(l,c){return l[c+1]==="!"&&l[c+2]==="A"&&l[c+3]==="T"&&l[c+4]==="T"&&l[c+5]==="L"&&l[c+6]==="I"&&l[c+7]==="S"&&l[c+8]==="T"}function a(l,c){return l[c+1]==="!"&&l[c+2]==="N"&&l[c+3]==="O"&&l[c+4]==="T"&&l[c+5]==="A"&&l[c+6]==="T"&&l[c+7]==="I"&&l[c+8]==="O"&&l[c+9]==="N"}function r(l){if(n.isName(l))return l;throw new Error(`Invalid entity name ${l}`)}return Fe=t,Fe}var Pe,Lt;function hi(){if(Lt)return Pe;Lt=1;const n=/^[-+]?0x[a-fA-F0-9]+$/,t=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const e={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function s(o,a={}){if(a=Object.assign({},e,a),!o||typeof o!="string")return o;let r=o.trim();if(a.skipLike!==void 0&&a.skipLike.test(r))return o;if(a.hex&&n.test(r))return Number.parseInt(r,16);{const l=t.exec(r);if(l){const c=l[1],f=l[2];let T=i(l[3]);const p=l[4]||l[6];if(!a.leadingZeros&&f.length>0&&c&&r[2]!==".")return o;if(!a.leadingZeros&&f.length>0&&!c&&r[1]!==".")return o;{const S=Number(r),O=""+S;return O.search(/[eE]/)!==-1||p?a.eNotation?S:o:r.indexOf(".")!==-1?O==="0"&&T===""||O===T||c&&O==="-"+T?S:o:f?T===O||c+T===O?S:o:r===O||r===c+O?S:o}}else return o}}function i(o){return o&&o.indexOf(".")!==-1&&(o=o.replace(/0+$/,""),o==="."?o="0":o[0]==="."?o="0"+o:o[o.length-1]==="."&&(o=o.substr(0,o.length-1))),o}return Pe=s,Pe}var xe,vt;function Jt(){if(vt)return xe;vt=1;function n(t){return typeof t=="function"?t:Array.isArray(t)?e=>{for(const s of t)if(typeof s=="string"&&e===s||s instanceof RegExp&&s.test(e))return!0}:()=>!1}return xe=n,xe}var ke,_t;function fi(){if(_t)return ke;_t=1;const n=it(),t=ui(),e=di(),s=hi(),i=Jt();class o{constructor(g){this.options=g,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:""},pound:{regex:/&(pound|#163);/g,val:""},yen:{regex:/&(yen|#165);/g,val:""},euro:{regex:/&(euro|#8364);/g,val:""},copyright:{regex:/&(copy|#169);/g,val:""},reg:{regex:/&(reg|#174);/g,val:""},inr:{regex:/&(inr|#8377);/g,val:""},num_dec:{regex:/&#([0-9]{1,7});/g,val:(m,w)=>String.fromCharCode(Number.parseInt(w,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(m,w)=>String.fromCharCode(Number.parseInt(w,16))}},this.addExternalEntities=a,this.parseXml=T,this.parseTextData=r,this.resolveNameSpace=l,this.buildAttributesMap=f,this.isItStopNode=L,this.replaceEntitiesValue=S,this.readStopNodeData=v,this.saveTextToParentTag=O,this.addChild=p,this.ignoreAttributesFn=i(this.options.ignoreAttributes)}}function a(h){const g=Object.keys(h);for(let m=0;m<g.length;m++){const w=g[m];this.lastEntities[w]={regex:new RegExp("&"+w+";","g"),val:h[w]}}}function r(h,g,m,w,I,N,b){if(h!==void 0&&(this.options.trimValues&&!w&&(h=h.trim()),h.length>0)){b||(h=this.replaceEntitiesValue(h));const _=this.options.tagValueProcessor(g,h,m,I,N);return _==null?h:typeof _!=typeof h||_!==h?_:this.options.trimValues?B(h,this.options.parseTagValue,this.options.numberParseOptions):h.trim()===h?B(h,this.options.parseTagValue,this.options.numberParseOptions):h}}function l(h){if(this.options.removeNSPrefix){const g=h.split(":"),m=h.charAt(0)==="/"?"/":"";if(g[0]==="xmlns")return"";g.length===2&&(h=m+g[1])}return h}const c=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function f(h,g,m){if(this.options.ignoreAttributes!==!0&&typeof h=="string"){const w=n.getAllMatches(h,c),I=w.length,N={};for(let b=0;b<I;b++){const _=this.resolveNameSpace(w[b][1]);if(this.ignoreAttributesFn(_,g))continue;let A=w[b][4],U=this.options.attributeNamePrefix+_;if(_.length)if(this.options.transformAttributeName&&(U=this.options.transformAttributeName(U)),U==="__proto__"&&(U="#__proto__"),A!==void 0){this.options.trimValues&&(A=A.trim()),A=this.replaceEntitiesValue(A);const k=this.options.attributeValueProcessor(_,A,g);k==null?N[U]=A:typeof k!=typeof A||k!==A?N[U]=k:N[U]=B(A,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(N[U]=!0)}if(!Object.keys(N).length)return;if(this.options.attributesGroupName){const b={};return b[this.options.attributesGroupName]=N,b}return N}}const T=function(h){h=h.replace(/\r\n?/g,`
`);const g=new t("!xml");let m=g,w="",I="";for(let N=0;N<h.length;N++)if(h[N]==="<")if(h[N+1]==="/"){const _=d(h,">",N,"Closing Tag is not closed.");let A=h.substring(N+2,_).trim();if(this.options.removeNSPrefix){const X=A.indexOf(":");X!==-1&&(A=A.substr(X+1))}this.options.transformTagName&&(A=this.options.transformTagName(A)),m&&(w=this.saveTextToParentTag(w,m,I));const U=I.substring(I.lastIndexOf(".")+1);if(A&&this.options.unpairedTags.indexOf(A)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${A}>`);let k=0;U&&this.options.unpairedTags.indexOf(U)!==-1?(k=I.lastIndexOf(".",I.lastIndexOf(".")-1),this.tagsNodeStack.pop()):k=I.lastIndexOf("."),I=I.substring(0,k),m=this.tagsNodeStack.pop(),w="",N=_}else if(h[N+1]==="?"){let _=E(h,N,!1,"?>");if(!_)throw new Error("Pi Tag is not closed.");if(w=this.saveTextToParentTag(w,m,I),!(this.options.ignoreDeclaration&&_.tagName==="?xml"||this.options.ignorePiTags)){const A=new t(_.tagName);A.add(this.options.textNodeName,""),_.tagName!==_.tagExp&&_.attrExpPresent&&(A[":@"]=this.buildAttributesMap(_.tagExp,I,_.tagName)),this.addChild(m,A,I)}N=_.closeIndex+1}else if(h.substr(N+1,3)==="!--"){const _=d(h,"-->",N+4,"Comment is not closed.");if(this.options.commentPropName){const A=h.substring(N+4,_-2);w=this.saveTextToParentTag(w,m,I),m.add(this.options.commentPropName,[{[this.options.textNodeName]:A}])}N=_}else if(h.substr(N+1,2)==="!D"){const _=e(h,N);this.docTypeEntities=_.entities,N=_.i}else if(h.substr(N+1,2)==="!["){const _=d(h,"]]>",N,"CDATA is not closed.")-2,A=h.substring(N+9,_);w=this.saveTextToParentTag(w,m,I);let U=this.parseTextData(A,m.tagname,I,!0,!1,!0,!0);U==null&&(U=""),this.options.cdataPropName?m.add(this.options.cdataPropName,[{[this.options.textNodeName]:A}]):m.add(this.options.textNodeName,U),N=_+2}else{let _=E(h,N,this.options.removeNSPrefix),A=_.tagName;const U=_.rawTagName;let k=_.tagExp,X=_.attrExpPresent,at=_.closeIndex;this.options.transformTagName&&(A=this.options.transformTagName(A)),m&&w&&m.tagname!=="!xml"&&(w=this.saveTextToParentTag(w,m,I,!1));const ct=m;if(ct&&this.options.unpairedTags.indexOf(ct.tagname)!==-1&&(m=this.tagsNodeStack.pop(),I=I.substring(0,I.lastIndexOf("."))),A!==g.tagname&&(I+=I?"."+A:A),this.isItStopNode(this.options.stopNodes,I,A)){let z="";if(k.length>0&&k.lastIndexOf("/")===k.length-1)A[A.length-1]==="/"?(A=A.substr(0,A.length-1),I=I.substr(0,I.length-1),k=A):k=k.substr(0,k.length-1),N=_.closeIndex;else if(this.options.unpairedTags.indexOf(A)!==-1)N=_.closeIndex;else{const _e=this.readStopNodeData(h,U,at+1);if(!_e)throw new Error(`Unexpected end of ${U}`);N=_e.i,z=_e.tagContent}const ve=new t(A);A!==k&&X&&(ve[":@"]=this.buildAttributesMap(k,I,A)),z&&(z=this.parseTextData(z,A,I,!0,X,!0,!0)),I=I.substr(0,I.lastIndexOf(".")),ve.add(this.options.textNodeName,z),this.addChild(m,ve,I)}else{if(k.length>0&&k.lastIndexOf("/")===k.length-1){A[A.length-1]==="/"?(A=A.substr(0,A.length-1),I=I.substr(0,I.length-1),k=A):k=k.substr(0,k.length-1),this.options.transformTagName&&(A=this.options.transformTagName(A));const z=new t(A);A!==k&&X&&(z[":@"]=this.buildAttributesMap(k,I,A)),this.addChild(m,z,I),I=I.substr(0,I.lastIndexOf("."))}else{const z=new t(A);this.tagsNodeStack.push(m),A!==k&&X&&(z[":@"]=this.buildAttributesMap(k,I,A)),this.addChild(m,z,I),m=z}w="",N=at}}else w+=h[N];return g.child};function p(h,g,m){const w=this.options.updateTag(g.tagname,m,g[":@"]);w===!1||(typeof w=="string"&&(g.tagname=w),h.addChild(g))}const S=function(h){if(this.options.processEntities){for(let g in this.docTypeEntities){const m=this.docTypeEntities[g];h=h.replace(m.regx,m.val)}for(let g in this.lastEntities){const m=this.lastEntities[g];h=h.replace(m.regex,m.val)}if(this.options.htmlEntities)for(let g in this.htmlEntities){const m=this.htmlEntities[g];h=h.replace(m.regex,m.val)}h=h.replace(this.ampEntity.regex,this.ampEntity.val)}return h};function O(h,g,m,w){return h&&(w===void 0&&(w=Object.keys(g.child).length===0),h=this.parseTextData(h,g.tagname,m,!1,g[":@"]?Object.keys(g[":@"]).length!==0:!1,w),h!==void 0&&h!==""&&g.add(this.options.textNodeName,h),h=""),h}function L(h,g,m){const w="*."+m;for(const I in h){const N=h[I];if(w===N||g===N)return!0}return!1}function M(h,g,m=">"){let w,I="";for(let N=g;N<h.length;N++){let b=h[N];if(w)b===w&&(w="");else if(b==='"'||b==="'")w=b;else if(b===m[0])if(m[1]){if(h[N+1]===m[1])return{data:I,index:N}}else return{data:I,index:N};else b==="	"&&(b=" ");I+=b}}function d(h,g,m,w){const I=h.indexOf(g,m);if(I===-1)throw new Error(w);return I+g.length-1}function E(h,g,m,w=">"){const I=M(h,g+1,w);if(!I)return;let N=I.data;const b=I.index,_=N.search(/\s/);let A=N,U=!0;_!==-1&&(A=N.substring(0,_),N=N.substring(_+1).trimStart());const k=A;if(m){const X=A.indexOf(":");X!==-1&&(A=A.substr(X+1),U=A!==I.data.substr(X+1))}return{tagName:A,tagExp:N,closeIndex:b,attrExpPresent:U,rawTagName:k}}function v(h,g,m){const w=m;let I=1;for(;m<h.length;m++)if(h[m]==="<")if(h[m+1]==="/"){const N=d(h,">",m,`${g} is not closed`);if(h.substring(m+2,N).trim()===g&&(I--,I===0))return{tagContent:h.substring(w,m),i:N};m=N}else if(h[m+1]==="?")m=d(h,"?>",m+1,"StopNode is not closed.");else if(h.substr(m+1,3)==="!--")m=d(h,"-->",m+3,"StopNode is not closed.");else if(h.substr(m+1,2)==="![")m=d(h,"]]>",m,"StopNode is not closed.")-2;else{const N=E(h,m,">");N&&((N&&N.tagName)===g&&N.tagExp[N.tagExp.length-1]!=="/"&&I++,m=N.closeIndex)}}function B(h,g,m){if(g&&typeof h=="string"){const w=h.trim();return w==="true"?!0:w==="false"?!1:s(h,m)}else return n.isExist(h)?h:""}return ke=o,ke}var Be={},yt;function gi(){if(yt)return Be;yt=1;function n(o,a){return t(o,a)}function t(o,a,r){let l;const c={};for(let f=0;f<o.length;f++){const T=o[f],p=e(T);let S="";if(r===void 0?S=p:S=r+"."+p,p===a.textNodeName)l===void 0?l=T[p]:l+=""+T[p];else{if(p===void 0)continue;if(T[p]){let O=t(T[p],a,S);const L=i(O,a);T[":@"]?s(O,T[":@"],S,a):Object.keys(O).length===1&&O[a.textNodeName]!==void 0&&!a.alwaysCreateTextNode?O=O[a.textNodeName]:Object.keys(O).length===0&&(a.alwaysCreateTextNode?O[a.textNodeName]="":O=""),c[p]!==void 0&&c.hasOwnProperty(p)?(Array.isArray(c[p])||(c[p]=[c[p]]),c[p].push(O)):a.isArray(p,S,L)?c[p]=[O]:c[p]=O}}}return typeof l=="string"?l.length>0&&(c[a.textNodeName]=l):l!==void 0&&(c[a.textNodeName]=l),c}function e(o){const a=Object.keys(o);for(let r=0;r<a.length;r++){const l=a[r];if(l!==":@")return l}}function s(o,a,r,l){if(a){const c=Object.keys(a),f=c.length;for(let T=0;T<f;T++){const p=c[T];l.isArray(p,r+"."+p,!0,!0)?o[p]=[a[p]]:o[p]=a[p]}}}function i(o,a){const{textNodeName:r}=a,l=Object.keys(o).length;return!!(l===0||l===1&&(o[r]||typeof o[r]=="boolean"||o[r]===0))}return Be.prettify=n,Be}var Me,wt;function Ti(){if(wt)return Me;wt=1;const{buildOptions:n}=ci(),t=fi(),{prettify:e}=gi(),s=jt();class i{constructor(a){this.externalEntities={},this.options=n(a)}parse(a,r){if(typeof a!="string")if(a.toString)a=a.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(r){r===!0&&(r={});const f=s.validate(a,r);if(f!==!0)throw Error(`${f.err.msg}:${f.err.line}:${f.err.col}`)}const l=new t(this.options);l.addExternalEntities(this.externalEntities);const c=l.parseXml(a);return this.options.preserveOrder||c===void 0?c:e(c,this.options)}addEntity(a,r){if(r.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(a.indexOf("&")!==-1||a.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(r==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[a]=r}}return Me=i,Me}var Ve,Rt;function pi(){if(Rt)return Ve;Rt=1;const n=`
`;function t(r,l){let c="";return l.format&&l.indentBy.length>0&&(c=n),e(r,l,"",c)}function e(r,l,c,f){let T="",p=!1;for(let S=0;S<r.length;S++){const O=r[S],L=s(O);if(L===void 0)continue;let M="";if(c.length===0?M=L:M=`${c}.${L}`,L===l.textNodeName){let h=O[L];o(M,l)||(h=l.tagValueProcessor(L,h),h=a(h,l)),p&&(T+=f),T+=h,p=!1;continue}else if(L===l.cdataPropName){p&&(T+=f),T+=`<![CDATA[${O[L][0][l.textNodeName]}]]>`,p=!1;continue}else if(L===l.commentPropName){T+=f+`<!--${O[L][0][l.textNodeName]}-->`,p=!0;continue}else if(L[0]==="?"){const h=i(O[":@"],l),g=L==="?xml"?"":f;let m=O[L][0][l.textNodeName];m=m.length!==0?" "+m:"",T+=g+`<${L}${m}${h}?>`,p=!0;continue}let d=f;d!==""&&(d+=l.indentBy);const E=i(O[":@"],l),v=f+`<${L}${E}`,B=e(O[L],l,M,d);l.unpairedTags.indexOf(L)!==-1?l.suppressUnpairedNode?T+=v+">":T+=v+"/>":(!B||B.length===0)&&l.suppressEmptyNode?T+=v+"/>":B&&B.endsWith(">")?T+=v+`>${B}${f}</${L}>`:(T+=v+">",B&&f!==""&&(B.includes("/>")||B.includes("</"))?T+=f+l.indentBy+B+f:T+=B,T+=`</${L}>`),p=!0}return T}function s(r){const l=Object.keys(r);for(let c=0;c<l.length;c++){const f=l[c];if(r.hasOwnProperty(f)&&f!==":@")return f}}function i(r,l){let c="";if(r&&!l.ignoreAttributes)for(let f in r){if(!r.hasOwnProperty(f))continue;let T=l.attributeValueProcessor(f,r[f]);T=a(T,l),T===!0&&l.suppressBooleanAttributes?c+=` ${f.substr(l.attributeNamePrefix.length)}`:c+=` ${f.substr(l.attributeNamePrefix.length)}="${T}"`}return c}function o(r,l){r=r.substr(0,r.length-l.textNodeName.length-1);let c=r.substr(r.lastIndexOf(".")+1);for(let f in l.stopNodes)if(l.stopNodes[f]===r||l.stopNodes[f]==="*."+c)return!0;return!1}function a(r,l){if(r&&r.length>0&&l.processEntities)for(let c=0;c<l.entities.length;c++){const f=l.entities[c];r=r.replace(f.regex,f.val)}return r}return Ve=t,Ve}var Ye,bt;function Ei(){if(bt)return Ye;bt=1;const n=pi(),t=Jt(),e={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(r,l){return l},attributeValueProcessor:function(r,l){return l},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function s(r){this.options=Object.assign({},e,r),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=t(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=a),this.processTextOrObjNode=i,this.options.format?(this.indentate=o,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}s.prototype.build=function(r){return this.options.preserveOrder?n(r,this.options):(Array.isArray(r)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(r={[this.options.arrayNodeName]:r}),this.j2x(r,0,[]).val)},s.prototype.j2x=function(r,l,c){let f="",T="";const p=c.join(".");for(let S in r)if(Object.prototype.hasOwnProperty.call(r,S))if(typeof r[S]>"u")this.isAttribute(S)&&(T+="");else if(r[S]===null)this.isAttribute(S)?T+="":S[0]==="?"?T+=this.indentate(l)+"<"+S+"?"+this.tagEndChar:T+=this.indentate(l)+"<"+S+"/"+this.tagEndChar;else if(r[S]instanceof Date)T+=this.buildTextValNode(r[S],S,"",l);else if(typeof r[S]!="object"){const O=this.isAttribute(S);if(O&&!this.ignoreAttributesFn(O,p))f+=this.buildAttrPairStr(O,""+r[S]);else if(!O)if(S===this.options.textNodeName){let L=this.options.tagValueProcessor(S,""+r[S]);T+=this.replaceEntitiesValue(L)}else T+=this.buildTextValNode(r[S],S,"",l)}else if(Array.isArray(r[S])){const O=r[S].length;let L="",M="";for(let d=0;d<O;d++){const E=r[S][d];if(!(typeof E>"u"))if(E===null)S[0]==="?"?T+=this.indentate(l)+"<"+S+"?"+this.tagEndChar:T+=this.indentate(l)+"<"+S+"/"+this.tagEndChar;else if(typeof E=="object")if(this.options.oneListGroup){const v=this.j2x(E,l+1,c.concat(S));L+=v.val,this.options.attributesGroupName&&E.hasOwnProperty(this.options.attributesGroupName)&&(M+=v.attrStr)}else L+=this.processTextOrObjNode(E,S,l,c);else if(this.options.oneListGroup){let v=this.options.tagValueProcessor(S,E);v=this.replaceEntitiesValue(v),L+=v}else L+=this.buildTextValNode(E,S,"",l)}this.options.oneListGroup&&(L=this.buildObjectNode(L,S,M,l)),T+=L}else if(this.options.attributesGroupName&&S===this.options.attributesGroupName){const O=Object.keys(r[S]),L=O.length;for(let M=0;M<L;M++)f+=this.buildAttrPairStr(O[M],""+r[S][O[M]])}else T+=this.processTextOrObjNode(r[S],S,l,c);return{attrStr:f,val:T}},s.prototype.buildAttrPairStr=function(r,l){return l=this.options.attributeValueProcessor(r,""+l),l=this.replaceEntitiesValue(l),this.options.suppressBooleanAttributes&&l==="true"?" "+r:" "+r+'="'+l+'"'};function i(r,l,c,f){const T=this.j2x(r,c+1,f.concat(l));return r[this.options.textNodeName]!==void 0&&Object.keys(r).length===1?this.buildTextValNode(r[this.options.textNodeName],l,T.attrStr,c):this.buildObjectNode(T.val,l,T.attrStr,c)}s.prototype.buildObjectNode=function(r,l,c,f){if(r==="")return l[0]==="?"?this.indentate(f)+"<"+l+c+"?"+this.tagEndChar:this.indentate(f)+"<"+l+c+this.closeTag(l)+this.tagEndChar;{let T="</"+l+this.tagEndChar,p="";return l[0]==="?"&&(p="?",T=""),(c||c==="")&&r.indexOf("<")===-1?this.indentate(f)+"<"+l+c+p+">"+r+T:this.options.commentPropName!==!1&&l===this.options.commentPropName&&p.length===0?this.indentate(f)+`<!--${r}-->`+this.newLine:this.indentate(f)+"<"+l+c+p+this.tagEndChar+r+this.indentate(f)+T}},s.prototype.closeTag=function(r){let l="";return this.options.unpairedTags.indexOf(r)!==-1?this.options.suppressUnpairedNode||(l="/"):this.options.suppressEmptyNode?l="/":l=`></${r}`,l},s.prototype.buildTextValNode=function(r,l,c,f){if(this.options.cdataPropName!==!1&&l===this.options.cdataPropName)return this.indentate(f)+`<![CDATA[${r}]]>`+this.newLine;if(this.options.commentPropName!==!1&&l===this.options.commentPropName)return this.indentate(f)+`<!--${r}-->`+this.newLine;if(l[0]==="?")return this.indentate(f)+"<"+l+c+"?"+this.tagEndChar;{let T=this.options.tagValueProcessor(l,r);return T=this.replaceEntitiesValue(T),T===""?this.indentate(f)+"<"+l+c+this.closeTag(l)+this.tagEndChar:this.indentate(f)+"<"+l+c+">"+T+"</"+l+this.tagEndChar}},s.prototype.replaceEntitiesValue=function(r){if(r&&r.length>0&&this.options.processEntities)for(let l=0;l<this.options.entities.length;l++){const c=this.options.entities[l];r=r.replace(c.regex,c.val)}return r};function o(r){return this.options.indentBy.repeat(r)}function a(r){return r.startsWith(this.options.attributeNamePrefix)&&r!==this.options.textNodeName?r.substr(this.attrPrefixLen):!1}return Ye=s,Ye}var Ge,Ft;function Si(){if(Ft)return Ge;Ft=1;const n=jt(),t=Ti(),e=Ei();return Ge={XMLParser:t,XMLValidator:n,XMLBuilder:e},Ge}var mi=Si();const Ci=[{regex:/&(amp|#38|#x26);/g,val:"&"},{regex:/&(apos|#39|#x27);/g,val:"'"},{regex:/&#(xa|xA|10);/g,val:`
`},{regex:/&(gt|#62|#x3e|#x3E);/g,val:">"},{regex:/&(lt|#60|#x3c|#x3C);/g,val:"<"},{regex:/&(quot|#34|#x22);/g,val:'"'}],Ii=new Set(["BPMNShape.Bounds","BPMNShape.BPMNLabel.Bounds","BPMNEdge.BPMNLabel.Bounds","BPMNEdge.waypoint"].map(n=>`definitions.BPMNDiagram.BPMNPlane.${n}`)),Ai=new Set(["x","y","width","height"]),Ni=(n,t)=>Ii.has(t)&&Ai.has(n);class Oi{constructor(t){y(this,"x2jOptions",{attributeNamePrefix:"",removeNSPrefix:!0,ignoreAttributes:!1,parseAttributeValue:!0,processEntities:!1,attributeValueProcessor:(t,e,s)=>Ni(t,s)?Number(e):this.processAttribute(e)});y(this,"xmlParser",new mi.XMLParser(this.x2jOptions));this.options=t}parse(t){let e;try{e=this.xmlParser.parse(t)}catch{throw new Error("XML parsing failed. Invalid BPMN source.")}if(!e.definitions)throw new Error("XML parsing failed. Unable to retrieve 'definitions' from the BPMN source.");return e}processAttribute(t){var e;for(const s of Ci)t=t.replace(s.regex,s.val);return(e=this.options)!=null&&e.additionalXmlAttributeProcessor&&(t=this.options.additionalXmlAttributeProcessor(t)),t}}class Li{constructor(t,e){this.jsonParser=t,this.xmlParser=e}parse(t){const e=this.xmlParser.parse(t);return this.jsonParser.parse(e)}}function vi(n){return new Li(ai(new Bs(n)),new Oi(n))}function _i(n){return new yi(n)}class yi{constructor(t){this.graph=t}updateAndRefreshCssClassesOfCell(t,e){this.updateAndRefreshCssClassesOfElement(t,e),this.updateAndRefreshCssClassesOfElement(et(t),e)}updateAndRefreshCssClassesOfElement(t,e){const s=this.graph.getModel(),i=s.getCell(t);if(!i)return;let o=i.getStyle();o=K(o,x.EXTRA_CSS_CLASSES,e.join(",")),s.setStyle(i,o)}}function wi(n){return new Ri(_i(n),new bi)}class Ri{constructor(t,e){this.cssClassesUpdater=t,this.cssClassesCache=e}clearCache(){this.cssClassesCache.clear()}addCssClasses(t,e){this.updateCssClasses(t,e,this.cssClassesCache.addClassNames)}removeCssClasses(t,e){this.updateCssClasses(t,e,this.cssClassesCache.removeClassNames)}removeAllCssClasses(t){if(t||t=="")for(const e of P(t)){const s=this.cssClassesCache.removeAllClassNames(e);this.updateCellIfChanged(s,e)}else{const e=this.cssClassesCache.getBpmnIds();this.cssClassesCache.clear();for(const s of e)this.updateCellIfChanged(!0,s)}}toggleCssClasses(t,e){this.updateCssClasses(t,e,this.cssClassesCache.toggleClassNames)}updateCssClasses(t,e,s){const i=P(e);for(const o of P(t))this.updateCellIfChanged(s(o,i),o)}updateCellIfChanged(t,e){if(t){const s=this.cssClassesCache.getClassNames(e);this.cssClassesUpdater.updateAndRefreshCssClassesOfCell(e,s)}}}class bi{constructor(){y(this,"classNamesByBpmnId",new Map);y(this,"clear",()=>{this.classNamesByBpmnId.clear()});y(this,"addClassNames",(t,e)=>this.updateClassNames(t,e,(s,i)=>s.add(i)));y(this,"removeClassNames",(t,e)=>this.updateClassNames(t,e,(s,i)=>s.delete(i)));y(this,"toggleClassNames",(t,e)=>(this.updateClassNames(t,e,(s,i)=>s.has(i)?s.delete(i):s.add(i)),e&&e.length>0))}getClassNames(t){return this.classNamesByBpmnId.has(t)?[...this.classNamesByBpmnId.get(t)]:[]}getBpmnIds(){return[...this.classNamesByBpmnId.keys()]}removeAllClassNames(t){const e=this.getOrInitializeClassNames(t),s=e.size;return e.clear(),e.size<s}updateClassNames(t,e,s){const i=this.getOrInitializeClassNames(t),o=i.size;for(const a of P(e))s(i,a);return i.size!=o}getOrInitializeClassNames(t){let e=this.classNamesByBpmnId.get(t);return e==null&&(e=new Set,this.classNamesByBpmnId.set(t,e)),e}}const Fi=new Map([["start",{horizontalAlign:"left",verticalAlign:"top"}],["middle",{horizontalAlign:"center",verticalAlign:"top"}],["end",{horizontalAlign:"right",verticalAlign:"top"}],["top-left",{horizontalAlign:"left",verticalAlign:"top"}],["top-right",{horizontalAlign:"right",verticalAlign:"top"}],["top-center",{horizontalAlign:"center",verticalAlign:"top"}],["bottom-left",{horizontalAlign:"left",verticalAlign:"bottom"}],["bottom-right",{horizontalAlign:"right",verticalAlign:"bottom"}],["bottom-center",{horizontalAlign:"center",verticalAlign:"bottom"}],["middle-left",{horizontalAlign:"left",verticalAlign:"middle"}],["middle-right",{horizontalAlign:"right",verticalAlign:"middle"}]]),Pi=n=>Fi.get(n.position),xi=(n,t)=>{t&&(n.fill.color=t.color??n.fill.color,n.fill.opacity=t.opacity??n.fill.opacity)},ki=(n,t)=>{t&&(n.stroke.color=t.color??n.stroke.color,n.stroke.width=t.width??n.stroke.width)},Bi=(n,t)=>{t&&(n.font.color=t.color??n.font.color,n.font.size=t.size??n.font.size)},Mi=n=>{const t={fill:{color:R.DEFAULT_OVERLAY_FILL_COLOR.valueOf(),opacity:R.DEFAULT_OVERLAY_FILL_OPACITY.valueOf()},stroke:{color:R.DEFAULT_OVERLAY_STROKE_COLOR.valueOf(),width:R.DEFAULT_OVERLAY_STROKE_WIDTH.valueOf()},font:{color:R.DEFAULT_OVERLAY_FONT_COLOR.valueOf(),size:R.DEFAULT_OVERLAY_FONT_SIZE.valueOf()}},e=n.style,s={...t};return e&&(xi(s,e.fill),ki(s,e.stroke),Bi(s,e.font)),s};class Vi{convert(t){const e=Pi(t),s=Mi(t);return{position:e,style:s}}}function Yi(n){return new Gi(n,new Vi)}class Gi{constructor(t,e){this.graph=t,this.overlayConverter=e}addOverlays(t,e){const s=this.graph.getModel().getCell(t);if(s)for(const i of P(e)){const o=new Kt(i.label,this.overlayConverter.convert(i));this.graph.addCellOverlay(s,o)}}removeAllOverlays(t){const e=this.graph.getModel().getCell(t);e&&this.graph.removeCellOverlays(e)}}function Di(n){return new Ui(Yi(n))}class Ui{constructor(t){this.overlaysUpdater=t}addOverlays(t,e){this.overlaysUpdater.addOverlays(t,e)}removeAllOverlays(t){this.overlaysUpdater.removeAllOverlays(t)}}class Wi{element(t){return`svg > g > g > g[data-bpmn-id="${t}"]`}elementsOfKind(t){return`svg > g > g > g.${t}:not(.bpmn-label)`}}function Hi(n){return new Ki(n,new zi(n.getModel()))}const Pt=n=>{const t=P(n);return t.push(...t.map(e=>et(e))),t};class Ki{constructor(t,e){this.graph=t,this.styleManager=e}clear(){this.styleManager.clear()}updateStyle(t,e){if(!e)return;const s=this.graph.getModel(),i=Pt(t).map(o=>s.getCell(o)).filter(Boolean);i.length!==0&&this.graph.batchUpdate(()=>{for(const o of i){this.styleManager.ensureStyleIsStored(o);let a=o.getStyle();a=K(a,u.STYLE_OPACITY,e.opacity,Le),a=_n(a,e.stroke),a=yn(a,e.font),Fn(e)&&(a=bn(a,e.fill)),s.setStyle(o,a)}})}resetStyle(t){this.graph.batchUpdate(()=>{if(t||t=="")for(const e of Pt(t))this.styleManager.resetStyleIfIsStored(e);else this.styleManager.resetAllStyles()})}}const xt=x.EXTRA_CSS_CLASSES;class zi{constructor(t){y(this,"stylesCache",new Map);this.model=t}clear(){this.stylesCache.clear()}resetAllStyles(){for(const t of this.stylesCache.keys())this.resetStyle(t,this.stylesCache.get(t))}resetStyleIfIsStored(t){const e=this.stylesCache.get(t);e&&this.resetStyle(t,e)}resetStyle(t,e){const s=this.model.getCell(t),i=wn(s.getStyle(),xt,""),o=K(e,xt,i);this.model.setStyle(s,o),this.stylesCache.delete(t)}ensureStyleIsStored(t){const e=t.getId();this.stylesCache.has(e)||this.stylesCache.set(e,t.getStyle())}}function Xi(n){return new qi(Hi(n))}class qi{constructor(t){this.styleUpdater=t}clearCache(){this.styleUpdater.clear()}updateStyle(t,e){this.styleUpdater.updateStyle(t,e)}resetStyle(t){this.styleUpdater.resetStyle(t)}}function $i(n,t){return new Zi(n,new ji(t.container,new Wi),wi(t),Di(t),Xi(t))}class Zi{constructor(t,e,s,i,o){this.bpmnModelRegistry=t,this.htmlElementRegistry=e,this.cssClassesRegistry=s,this.overlaysRegistry=i,this.styleRegistry=o,this.bpmnModelRegistry.registerOnLoadCallback(()=>{this.cssClassesRegistry.clearCache(),this.styleRegistry.clearCache()})}getModelElementsByIds(t){return De(t).map(e=>this.bpmnModelRegistry.getBpmnSemantic(e)).filter(Boolean)}getElementsByIds(t){return this.getModelElementsByIds(t).map(e=>({bpmnSemantic:e,htmlElement:this.htmlElementRegistry.getBpmnHtmlElement(e.id)}))}getModelElementsByKinds(t){return De(t).flatMap(e=>this.htmlElementRegistry.getBpmnHtmlElements(e)).map(e=>this.getRelatedBpmnSemantic(e))}getElementsByKinds(t){return De(t).flatMap(e=>this.htmlElementRegistry.getBpmnHtmlElements(e)).map(e=>({htmlElement:e,bpmnSemantic:this.getRelatedBpmnSemantic(e)}))}getRelatedBpmnSemantic(t){return this.bpmnModelRegistry.getBpmnSemantic(t.dataset.bpmnId)}addCssClasses(t,e){this.cssClassesRegistry.addCssClasses(t,e)}removeCssClasses(t,e){this.cssClassesRegistry.removeCssClasses(t,e)}removeAllCssClasses(t){this.cssClassesRegistry.removeAllCssClasses(t)}toggleCssClasses(t,e){this.cssClassesRegistry.toggleCssClasses(t,e)}addOverlays(t,e){this.overlaysRegistry.addOverlays(t,e)}removeAllOverlays(t){this.overlaysRegistry.removeAllOverlays(t)}updateStyle(t,e){this.styleRegistry.updateStyle(t,e)}resetStyle(t){this.styleRegistry.resetStyle(t)}}class ji{constructor(t,e){this.container=t,this.querySelectors=e}getBpmnHtmlElement(t){return this.container.querySelector(this.querySelectors.element(t))}getBpmnHtmlElements(t){const e=this.querySelectors.elementsOfKind(Xe(t));return[...this.container.querySelectorAll(e)]}}const De=n=>[...new Set(P(n))];class Ji{filter(t,e){const s=[],i=[];for(const S of P(e==null?void 0:e.pools).filter(O=>O&&Object.keys(O).length>0))S.id?s.push(S.id):S.name&&i.push(S.name);if(s.length===0&&i.length===0)return t;const{filteredPools:o,filteredPoolIds:a}=Qi(t,s,i),r=[...s,...a],{filteredLanes:l,filteredLaneIds:c,filteredFlowNodes:f,filteredFlowNodeIds:T}=Qt(t.lanes,t.flowNodes,r),p=to(t.edges,[...r,...c,...T]);if(o.length===0&&l.length===0&&f.length===0&&p.length===0){let S=s.length>0?` for ids [${s}]`:"";const O=S?" and":"";throw S+=i.length>0?`${O} for names [${i}]`:"",new Error("No matching pools"+S)}return{lanes:l,flowNodes:f,pools:o,edges:p}}}function Qi(n,t,e){const s=n.pools.filter(o=>t.includes(o.bpmnElement.id)||e.includes(o.bpmnElement.name)),i=s.map(o=>o.bpmnElement.id);return{filteredPools:s,filteredPoolIds:i}}function Qt(n,t,e){const{filteredLanes:s,filteredLaneIds:i}=en(n,e),{filteredLanes:o,filteredLaneIds:a,filteredFlowNodes:r,filteredFlowNodeIds:l}=eo(t,[...e,...i],n);return s.push(...o),i.push(...a),{filteredLanes:s,filteredLaneIds:i,filteredFlowNodes:r,filteredFlowNodeIds:l}}function en(n,t){const e=n.filter(i=>t.includes(i.bpmnElement.parentId)),s=e.map(i=>i.bpmnElement.id);if(e.length>0){const{filteredLanes:i,filteredLaneIds:o}=en(n,s);e.push(...i),s.push(...o)}return{filteredLanes:e,filteredLaneIds:s}}function eo(n,t,e){const s=n.filter(c=>t.includes(c.bpmnElement.parentId));if(s.length===0)return{filteredLanes:[],filteredLaneIds:[],filteredFlowNodes:[],filteredFlowNodeIds:[]};const i=s.map(c=>c.bpmnElement.id),{filteredLanes:o,filteredLaneIds:a,filteredFlowNodes:r,filteredFlowNodeIds:l}=Qt(e,n,i);return s.push(...r),i.push(...l),{filteredLanes:o,filteredLaneIds:a,filteredFlowNodes:s,filteredFlowNodeIds:i}}function to(n,t){return n.filter(e=>t.includes(e.bpmnElement.sourceReferenceId)&&t.includes(e.bpmnElement.targetReferenceId))}class no{constructor(){y(this,"searchableModel");y(this,"onLoadCallback")}load(t,e){var i;const s=new Ji().filter(t,e);return this.searchableModel=new io(s),(i=this.onLoadCallback)==null||i.call(this),so(s)}registerOnLoadCallback(t){this.onLoadCallback=t}getBpmnSemantic(t){var o;const e=(o=this.searchableModel)==null?void 0:o.elementById(t);if(!e)return;const s=e.bpmnElement,i=s instanceof J;return{id:t,isShape:i,kind:s.kind,name:s.name,...s instanceof Ne?{sourceRefId:s.sourceReferenceId,targetRefId:s.targetReferenceId}:{callActivityGlobalTaskKind:s instanceof oe?s.globalTaskKind:void 0,callActivityKind:s instanceof oe?s.callActivityKind:void 0,eventDefinitionKind:s instanceof se?s.eventDefinitionKind:void 0,linkEventSourceIds:s instanceof Ke&&s.eventDefinitionKind==H.LINK?s.sourceIds:void 0,linkEventTargetId:s instanceof ze?s.targetId:void 0,incomingIds:s.incomingIds,outgoingIds:s.outgoingIds,parentId:s.parentId,subProcessKind:s instanceof ge?s.subProcessKind:void 0}}}}function so(n){const t=new Set(n.flowNodes.filter(o=>{const a=o.bpmnElement;return F.isSubProcess(a.kind)&&a.markers.includes(W.EXPAND)}).map(o=>o.bpmnElement.id)),e=[],s=[],i=[];for(const o of n.flowNodes){const a=o.bpmnElement.kind;F.isSubProcess(a)?e.push(o):F.isBoundaryEvent(a)?s.push(o):t.has(o.bpmnElement.parentId)||i.push(o)}return{boundaryEvents:s,edges:n.edges,lanes:n.lanes,otherFlowNodes:i,pools:n.pools,subprocesses:e}}class io{constructor(t){y(this,"elements",new Map);for(const e of[...t.pools,...t.lanes,...t.flowNodes,...t.edges])this.elements.set(e.bpmnElement.id,e)}elementById(t){return this.elements.get(t)}}class oo{constructor(t){y(this,"graph");y(this,"navigation");y(this,"bpmnElementsRegistry");y(this,"bpmnModelRegistry");y(this,"parserOptions");y(this,"rendererOptions");this.rendererOptions=t==null?void 0:t.renderer;const e=new Ps(gn(t==null?void 0:t.container));this.graph=e.configure(t),this.navigation=new xs(this.graph),this.bpmnModelRegistry=new no,this.bpmnElementsRegistry=$i(this.bpmnModelRegistry,this.graph),this.parserOptions=t==null?void 0:t.parser}load(t,e){const s=vi(this.parserOptions).parse(t),i=this.bpmnModelRegistry.load(s,e==null?void 0:e.modelFilter);Dn(this.graph,this.rendererOptions).render(i,e==null?void 0:e.fit)}}function _o(n){document.readyState==="complete"||document.readyState==="interactive"?setTimeout(n,1):document.addEventListener("DOMContentLoaded",n)}function V(n,...t){ot("[DEMO]",n,...t)}function ot(n,t,...e){console.info(`${n} ${t}`,...e)}function q(n,...t){ot("[DEMO STARTUP]",n,...t)}function tn(n,t){nn(n),window.alert(n)}function nn(n){console.error("[DEMO]",n)}function le(n,...t){ot("[DEMO DOWNLOAD]",n,...t)}async function ro(n){V(`Fetching BPMN content from url ${n}`);const t=await fetch(n);if(!t.ok)throw new Error(`HTTP status ${t.status}`);return await t.text()}function sn(n,t,e){const s=document.createElement("a");t.startsWith("data:image/svg+xml")&&(e=encodeURIComponent(e),t+=","),s.setAttribute("href",t+e),s.setAttribute("download",n),s.style.display="none",document.body.append(s),s.click(),s.remove()}function lo(n){le("Start SVG download"),sn("diagram.svg","data:image/svg+xml",n),le("Download completed")}function ao(n){le("Start PNG download");const t=new Blob([n],{type:"image/svg+xml;charset=utf-8"}),e=URL.createObjectURL(t),s=document.createElement("img");s.setAttribute("style","position: absolute; top: -9999px"),s.crossOrigin="anonymous",document.body.append(s);const i=document.createElement("canvas"),o=i.getContext("2d");s.addEventListener("load",function(){const a=new Image;i.width=s.naturalWidth,i.height=s.naturalHeight,a.crossOrigin="Anonymous",a.addEventListener("load",function(){o.drawImage(a,0,0),URL.revokeObjectURL(e);const r=i.toDataURL("image/png");s.remove(),sn("diagram.png","",r),le("Download completed")}),a.src=s.src}),s.src=e}class co{constructor(t,e,s,i){y(this,"document");y(this,"head");this.window=t,this.outerContainerId=e,this.containerToFade=s,this.dropCallback=i,this.document=t.document,this.head=document.head,this.initializeDragAndDrop()}initializeDragAndDrop(){this.containerToFade.classList.add("faded-container"),this.addDomElements(this.containerToFade),this.addStyle();const t=document.querySelector(`#${this.outerContainerId}`);this.preventDefaultsOnEvents(["dragover","drop"],this.window),this.preventDefaultsOnEvents(["dragover","dragleave","drop"],t),this.addEventsOnDropContainer(t,this.containerToFade),this.addEventsOnDocument(this.outerContainerId,this.containerToFade)}preventDefaults(t){t.preventDefault(),t.stopPropagation()}preventDefaultsOnEvents(t,e){for(const s of t)e.addEventListener(s,this.preventDefaults.bind(this),!1)}addDomElements(t){const e=this.document.createElement("p");e.textContent="open BPMN diagram";const s=this.document.createElement("div");s.classList.add("drop-here-text"),s.append(e);const i=this.document.createElement("div");i.id=this.outerContainerId,i.append(s),t.parentNode.prepend(i)}addStyle(){const t=`
.faded-container {
    opacity: 1;
}
.faded-container.faded {
    opacity: 0.1;
}
#${this.outerContainerId} {
    display: none;
    overflow: hidden;
    position: absolute;
    top: 10px;
    right: 10px;
    bottom: 10px;
    left: 10px;
    font-weight: bold;
    text-align: center;
    color: #555;
    padding: 10px;
}
#${this.outerContainerId}.dragging {
    display: block;
}
#${this.outerContainerId} .drop-here-text {
    border: 2px solid transparent;
    width: 100%;
    height: 100%;
    overflow: hidden;
}
#${this.outerContainerId} .drop-here-text p {
    font-style: normal;
    font-family: monospace;
    font-size: 40px;
    color: rgba(1,1,1,.2);
}
#${this.outerContainerId}.dragging .drop-here-text {
    cursor: default;
    display: flex;
    justify-content: center;
    align-items: center;
    border: 2px dashed rgba(0,0,0,.2);
    border-radius: 7px;
}`,e=document.createElement("style");e.append(document.createTextNode(t)),this.head.append(e)}addEventsOnDropContainer(t,e){t.addEventListener("dragover",this.getAddClassCallback(e,!1),!1),t.addEventListener("mousedown",this.getRemoveClassCallback(e,!1),!1),t.addEventListener("drop",this.getDropCallbackForElement(e,!1,this.dropCallback),!1)}addEventsOnDocument(t,e){this.document.addEventListener("dragover",this.getAddClassCallback(e,!0,t),!1),this.document.addEventListener("dragleave",this.getRemoveClassCallback(e,!0,t),!1),this.document.addEventListener("drop",this.getDropCallbackForElement(e,!0,this.dropCallback,t),!1)}getAddClassCallback(t,e,s){return function(){e?this.querySelector("#"+s).classList.add("dragging"):this.classList.add("dragging"),t.classList.add("faded")}}getRemoveClassCallback(t,e,s){return function(){e?this.querySelector("#"+s).classList.remove("dragging"):this.classList.remove("dragging"),t.classList.remove("faded")}}getDropCallbackForElement(t,e,s,i){return function(o){try{const r=o.dataTransfer.files;s(r[0])}catch(a){const r=a instanceof Error?a.message:String(a);tn(r)}finally{e?this.querySelector("#"+i).classList.remove("dragging"):this.classList.remove("dragging"),t.classList.remove("faded")}}}}class on{constructor(t){this.graph=t}exportSvg(){return this.doSvgExport(!0)}exportSvgForPng(){const t=In.IS_FF;return this.doSvgExport(t)}doSvgExport(t){const e=this.computeSvg({scale:1,border:25,enableForeignObjectForLabel:t});return`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
${Y.getXml(e)}
`}computeSvg(t){const e=t.scale??1,s=t.border??0,i=t.crisp??!0,o=t.enableForeignObjectForLabel??!0,a=this.graph.getGraphBounds(),r=this.graph.view.scale,l=Y.createXmlDocument(),c=l.createElementNS(u.NS_SVG,"svg"),f=e/r,T=Math.max(1,Math.ceil(a.width*f)+2*s),p=Math.max(1,Math.ceil(a.height*f)+2*s);c.setAttribute("version","1.1"),c.setAttribute("width",T+"px"),c.setAttribute("height",p+"px"),c.setAttribute("viewBox",(i?"-0.5 -0.5":"0 0")+" "+T+" "+p),l.append(c);const S=l.createElementNS(u.NS_SVG,"g");c.append(S);const O=this.createSvgCanvas(S);O.foEnabled=o,O.foOffset=i?-.5:0,O.textOffset=i?-.5:0,O.imageOffset=i?-.5:0,O.translate(Math.floor((s/e-a.x)/r),Math.floor((s/e-a.y)/r)),O.scale(f);const L=new D.mxImageExport;return L.includeOverlays=!0,L.drawState(this.graph.getView().getState(this.graph.model.root),O),l}createSvgCanvas(t){const e=new uo(t);return e.pointerEvents=!0,e}}class uo extends Qe{constructor(e){super(e);y(this,"htmlConverter",document.createElement("div"))}getAlternateText(e,s,i,o,a,r,l,c,f,T,p,S,O){return this.computeTruncatedText(r,o)}plainText(e,s,i,o,a,r,l,c,f,T,p,S){a=this.computeTruncatedText(a,i),super.plainText(e,s,i,o,a,r,l,c,f,T,p,S)}computeTruncatedText(e,s){if(e==null||this.state.fontSize<=0)return"";try{this.htmlConverter.innerHTML=e,e=Y.extractTextWithWhitespace(this.htmlConverter.childNodes);const i=Math.ceil(2*s/this.state.fontSize),o=[];let a=0,r=0;for(;(i==0||a<i)&&r<e.length;){const l=e.codePointAt(r);if(l==10||l==13){if(a>0)break}else o.push(e.charAt(r)),l<255&&a++;r++}o.length<e.length&&e.length-o.length>1&&(e=Y.trim(o.join(""))+"...")}catch(i){console.warn("Error while computing txt label",i)}return e}}const ho=new Map([["dark",{defaultFillColor:"#334352",defaultFontColor:"white",defaultStrokeColor:"#c0ddeb",endEventFillColor:"pink",endEventStrokeColor:"FireBrick",startEventFillColor:"DarkSeaGreen",startEventStrokeColor:"DarkGreen",taskAndCallActivityFillColor:"#5c8599",laneFillColor:"#2b3742",poolFillColor:"#232b33"}],["brown",{defaultFillColor:"#ede7e1",defaultFontColor:"#414666",defaultStrokeColor:"#414666",flowColor:"#666666",catchAndThrowEventStrokeColor:"#377f87",endEventFillColor:"pink",endEventStrokeColor:"FireBrick",startEventFillColor:"DarkSeaGreen",startEventStrokeColor:"DarkGreen",taskAndCallActivityFillColor:"#dadce8",laneFillColor:"#d4c3b2",poolFillColor:"#d1b9a1"}],["light-blue",{defaultFillColor:"#ffffff",defaultFontColor:"#002395",defaultStrokeColor:"#002395",endEventFillColor:"#f9dadc",endEventStrokeColor:"#e20613",startEventFillColor:"#ffffff",startEventStrokeColor:"#05d99e",taskAndCallActivityFillColor:"rgba(132,158,253,0.1)",textAnnotationFillColor:"rgba(237,237,245,0.5)",laneFillColor:"#edeef5",poolFillColor:"#dbefff"}]]);class fo extends oo{configureTheme(t){if(t=="default")return new qt(this.graph).configureStyles(),!0;const e=ho.get(t);if(!e)return!1;const s=this.graph.getStylesheet();for(const f of F.eventKinds()){let T,p;switch(f){case"endEvent":{T=e.endEventFillColor,p=e.endEventStrokeColor;break}case"startEvent":{T=e.startEventFillColor,p=e.startEventStrokeColor;break}case"intermediateCatchEvent":case"intermediateThrowEvent":case"boundaryEvent":{T=e.defaultFillColor,p=e.catchAndThrowEventStrokeColor??e.defaultStrokeColor;break}default:{T=e.defaultFillColor,p=e.defaultStrokeColor;break}}const S=s.styles[f];S.fillColor=T,S.strokeColor=p}for(const f of F.taskKinds()){const T=s.styles[f];T.fillColor=e.taskAndCallActivityFillColor}const i=s.styles[C.CALL_ACTIVITY];i.fillColor=e.taskAndCallActivityFillColor;const o=s.styles[C.TEXT_ANNOTATION];o.fillColor=e.textAnnotationFillColor??R.TEXT_ANNOTATION_FILL_COLOR;const a=s.styles[C.POOL];a.fillColor=e.poolFillColor,a.swimlaneFillColor=e.defaultFillColor;const r=s.styles[C.LANE];r.fillColor=e.laneFillColor;const l=s.getDefaultVertexStyle();l.fontColor=e.defaultFontColor,l.fillColor=e.defaultFillColor,l.strokeColor=e.defaultStrokeColor;const c=s.getDefaultEdgeStyle();return c.fontColor=e.defaultFontColor,c.fillColor=e.defaultFillColor,c.strokeColor=e.flowColor??e.defaultStrokeColor,!0}configureSequenceFlowColor(t){q(`Use dedicated ${t} color for sequence flows`);const s=this.graph.getStylesheet().styles[Z.SEQUENCE_FLOW];s[u.STYLE_STROKECOLOR]=t,s[u.STYLE_FILLCOLOR]=t,q("Sequence flows style updated")}}let G,ne={},rt,lt,Ae,j;function yo(n){V("Updating load options"),ne.fit=n,V("Load options updated",ne)}function wo(){return{...ne}}function Ro(){return Ae}function bo(n){V("Switching theme from %s to %s",Ae,n),G.configureTheme(n)?(G.graph.refresh(),V("Theme switch done"),Ae=n):V("Unknown theme, do nothing")}function rn(n,t=!0){V("Loading bpmn...");try{G.load(n,ne),V("BPMN loaded with configuration",ne),To(lt),document.dispatchEvent(new CustomEvent("diagramLoaded"))}catch(e){if(t)rt(`Cannot load the BPMN diagram: ${e instanceof Error?e.message:String(e)}`);else throw e}}function Fo(n){V("Fitting..."),G.navigation.fit(n),V("Fit done with configuration",n)}function Po(n){V(`Zooming '${n}'...`),G.navigation.zoom(n),V("Zoom done")}function xo(n){return G.bpmnElementsRegistry.getModelElementsByKinds(n)}function go(n){return G.bpmnElementsRegistry.getModelElementsByIds(n)}function ln(n){const t=G.graph.model,e=t.getCell(n);return t.getParent(e)}function ko(n){return n.map(t=>ln(t).getId()).filter((t,e,s)=>s.indexOf(t)===e)}function Bo(n){var s;const t=ln(n),e=go(t.getId());return e&&((s=e[0])==null?void 0:s.kind)===C.SUB_PROCESS}function Mo(n,t){return G.bpmnElementsRegistry.addCssClasses(n,t)}function Vo(n,t){return G.bpmnElementsRegistry.removeCssClasses(n,t)}function Yo(n,t){return G.bpmnElementsRegistry.addOverlays(n,[t])}function Go(n){return G.bpmnElementsRegistry.removeAllOverlays(n)}function To(n){if(!lt)return;V("Updating model, bpmnElement to collapse:",n);const t=G.graph.getModel(),e=t.getCell(n);if(e){t.beginUpdate();try{t.setCollapsed(e,!0)}finally{t.endUpdate()}V("Model updated")}else V("Element not found in the model, do nothing")}function an(n){n.text().then(t=>{rn(t)}).catch(t=>{throw t})}function Do(n){const t=n.target.files;if(t&&t.length>0){const e=t[0];an(e)}}function po(n){ro(n).catch(t=>{throw new Error(`Unable to fetch ${n}. ${t}`)}).then(t=>(V("BPMN content fetched"),t)).then(t=>{rn(t,!1),V(`BPMN content loaded from url ${n}`)}).then(()=>{No()}).catch(t=>{rt(t.message)})}function Uo(n){tn(n)}function Eo(n){nn(n)}function So(n,t){var o;const e=((o=n.loadOptions)==null?void 0:o.fit)??{},s=t.get("fitTypeOnLoad");s&&(e.type=s);const i=t.get("fitMargin");return i&&(e.margin=Number(i)),e}function mo(n){if(n.get("style.container.alternative.background.color")=="true"){const o="yellow";q("Use alternative color for the bpmn container background, color",o);const a=G.graph.container;a.style.backgroundColor=o,q("Bpmn container style updated")}const e=n.get("style.theme");q(`Configuring the '${e}' BPMN theme`),G.configureTheme(e)?(Ae=e,q(`'${e}' BPMN theme configured`)):q(`Unknown '${e}' BPMN theme, skipping configuration`),n.get("style.seqFlow.light.colors")=="true"&&G.configureSequenceFlowColor("#E9E9E9"),q('Configuring the "Update Style" API from query parameters'),[...n.keys()].some(o=>o.startsWith("style.api."))?(j={stroke:{},font:{},fill:{}},n.get("style.api.stroke.color")&&(j.stroke.color=n.get("style.api.stroke.color")),n.get("style.api.font.color")&&(j.font.color=n.get("style.api.font.color")),n.get("style.api.font.opacity")&&(j.font.opacity=Number(n.get("style.api.font.opacity"))),n.get("style.api.fill.color")?j.fill.color=n.get("style.api.fill.color"):n.get("style.api.fill.color.startColor")&&n.get("style.api.fill.color.endColor")&&n.get("style.api.fill.color.direction")&&(j.fill.color={startColor:n.get("style.api.fill.color.startColor"),endColor:n.get("style.api.fill.color.endColor"),direction:n.get("style.api.fill.color.direction")}),n.get("style.api.fill.opacity")&&(j.fill.opacity=Number(n.get("style.api.fill.opacity"))),q('Prepared "Update Style" API object',j)):q('No query parameters, do not set the "Update Style" API object')}function Co(n){lt=n.get("bpmn.element.id.collapsed")}function Io(n){const t=n.get("bpmn.filter.pool.ids");if(!t)return;const e=t.split(",");return V("Configuring load options to only include pool id: ",e),{pools:e.map(s=>({id:s}))}}function Wo(n){const t=q;t("Initializing BpmnVisualization with container:",n.globalOptions.container);const e=new URLSearchParams(window.location.search),s=e.get("renderer.ignore.bpmn.colors");if(s){const o=s==="true";t('Ignore support for "BPMN in Color"?',o),!n.globalOptions.renderer&&(n.globalOptions.renderer={}),n.globalOptions.renderer.ignoreBpmnColors=o}G=new fo(n.globalOptions),t("Initialization completed"),new co(window,"drop-container",G.graph.container,an),t("Drag&Drop support initialized"),rt=n.statusKoNotifier??Eo,t("Configuring Load Options"),ne=n.loadOptions??{},ne.fit=So(n,e),ne.modelFilter=Io(e),mo(e),Co(e),t("Checking if an 'url to fetch BPMN content' is provided as query parameter");const i=e.get("url");if(i){const o=decodeURIComponent(i);po(o);return}t("No 'url to fetch BPMN content' provided")}function Ho(){le("Trigger SVG Download"),lo(new on(G.graph).exportSvg())}function Ko(){le("Trigger PNG Download"),ao(new on(G.graph).exportSvgForPng())}function Ao(n,t){V("Applying style using the style API: %O",t),G.bpmnElementsRegistry.updateStyle(n,t),V("New style applied on: %O",n)}function zo(n){V("Resetting styles using the style API!"),G.bpmnElementsRegistry.resetStyle(n),V("Styles reset")}function No(){if(j){const n=Oo();V("Number of elements whose style is to be updated",n.length),Ao(n,j)}}function Oo(){V("Retrieving ids of all BPMN elements");const n=[...Object.values(C),...Object.values(Z)],t=G.bpmnElementsRegistry.getModelElementsByKinds(n).map(e=>e.id);return V("All BPMN elements ids retrieved:",t.length),t}export{ue as F,C as S,fn as Z,bo as a,Ro as b,Go as c,_o as d,Mo as e,Fo as f,wo as g,Do as h,Ho as i,Ko as j,Bo as k,V as l,In as m,xo as n,Ao as o,F as p,ko as q,Vo as r,Wo as s,zo as t,yo as u,Wn as v,Uo as w,Yo as x,Po as z};
