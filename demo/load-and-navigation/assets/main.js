var yt=Object.defineProperty;var wt=(n,t,e)=>t in n?yt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var g=(n,t,e)=>wt(n,typeof t!="symbol"?t+"":t,e);import{g as Rt,r as bt}from"./mxgraph.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=e(o);fetch(o.href,i)}})();var Q=(n=>(n.None="None",n.HorizontalVertical="HorizontalVertical",n.Horizontal="Horizontal",n.Vertical="Vertical",n.Center="Center",n))(Q||{}),Ft=(n=>(n.In="in",n.Out="out",n))(Ft||{});function Pt(n){return n instanceof HTMLElement?n:document.querySelector(`#${n}`)}var d=(n=>(n.LANE="lane",n.POOL="pool",n.CALL_ACTIVITY="callActivity",n.SUB_PROCESS="subProcess",n.TASK="task",n.TASK_USER="userTask",n.TASK_SERVICE="serviceTask",n.TASK_RECEIVE="receiveTask",n.TASK_SEND="sendTask",n.TASK_MANUAL="manualTask",n.TASK_SCRIPT="scriptTask",n.TASK_BUSINESS_RULE="businessRuleTask",n.GLOBAL_TASK="globalTask",n.GLOBAL_TASK_USER="globalUserTask",n.GLOBAL_TASK_MANUAL="globalManualTask",n.GLOBAL_TASK_SCRIPT="globalScriptTask",n.GLOBAL_TASK_BUSINESS_RULE="globalBusinessRuleTask",n.GROUP="group",n.TEXT_ANNOTATION="textAnnotation",n.GATEWAY_PARALLEL="parallelGateway",n.GATEWAY_EXCLUSIVE="exclusiveGateway",n.GATEWAY_INCLUSIVE="inclusiveGateway",n.GATEWAY_EVENT_BASED="eventBasedGateway",n.GATEWAY_COMPLEX="complexGateway",n.EVENT_START="startEvent",n.EVENT_END="endEvent",n.EVENT_INTERMEDIATE_CATCH="intermediateCatchEvent",n.EVENT_INTERMEDIATE_THROW="intermediateThrowEvent",n.EVENT_BOUNDARY="boundaryEvent",n))(d||{}),J=(n=>(n.CALLING_PROCESS="process",n.CALLING_GLOBAL_TASK="global task",n))(J||{}),ee=(n=>(n.Exclusive="Exclusive",n.None="None",n.Parallel="Parallel",n))(ee||{}),y=(n=>(n.NONE="none",n.TERMINATE="terminate",n.CANCEL="cancel",n.COMPENSATION="compensate",n.CONDITIONAL="conditional",n.ERROR="error",n.ESCALATION="escalation",n.LINK="link",n.MESSAGE="message",n.SIGNAL="signal",n.TIMER="timer",n))(y||{}),_=(n=>(n.ADHOC="adhoc",n.COMPENSATION="compensation",n.EXPAND="expand",n.LOOP="loop",n.MULTI_INSTANCE_PARALLEL="multi-parallel",n.MULTI_INSTANCE_SEQUENTIAL="multi-sequential",n))(_||{}),Y=(n=>(n.AD_HOC="adhoc",n.EMBEDDED="embedded",n.EVENT="event",n.TRANSACTION="transaction",n))(Y||{});function kt(n,t){return n===""?t?{}:void 0:n}function S(n,t=!1){return n==null?[]:(Array.isArray(n)?n:[n]).map(e=>kt(e,t)).filter(Boolean)}function Bt(n,t,e){const s=[];e!=null&&e.startingWith?s.push(`^(${e.startingWith}).*`):e!=null&&e.notStartingWith&&s.push(`^(?!(${e.notStartingWith})).*`),s.push(`${t}$`);const o=s.join("");return n.filter(i=>e!=null&&e.ignoreCase?new RegExp(o,"i").test(i):new RegExp(o).test(i))}class E{static isEvent(t){return oe(xe,t)}static eventKinds(){return[...xe]}static isBoundaryEvent(t){return d.EVENT_BOUNDARY===t}static isStartEvent(t){return d.EVENT_START===t}static isCatchEvent(t){return d.EVENT_INTERMEDIATE_CATCH===t||d.EVENT_BOUNDARY===t||d.EVENT_START===t}static isIntermediateCatchEvent(t){return d.EVENT_INTERMEDIATE_CATCH===t}static isIntermediateThrowEvent(t){return d.EVENT_INTERMEDIATE_THROW===t}static isCallActivity(t){return d.CALL_ACTIVITY===t}static isSubProcess(t){return d.SUB_PROCESS===t}static canHaveNoneEvent(t){return d.EVENT_INTERMEDIATE_THROW===t||d.EVENT_END===t||d.EVENT_START===t}static isActivity(t){return oe(pe,t)}static activityKinds(){return[...pe]}static isWithDefaultSequenceFlow(t){return Mt.has(t)}static isTask(t){return oe(Te,t)}static taskKinds(){return[...Te]}static gatewayKinds(){return[...Ye]}static isGateway(t){return oe(Ye,t)}static flowNodeKinds(){return Object.values(d).filter(t=>!E.isPoolOrLane(t))}static isPoolOrLane(t){return t==d.POOL||t==d.LANE}}function Ne(n,t){return Bt(Object.values(d),n,t)}function oe(n,t){return Object.values(n).map(e=>e).includes(t)}const xe=Ne("Event"),Ye=Ne("Gateway"),Te=Ne("Task",{ignoreCase:!0,notStartingWith:"global"}),pe=[...Te,d.CALL_ACTIVITY,d.SUB_PROCESS],Mt=new Set([...pe,d.GATEWAY_EXCLUSIVE,d.GATEWAY_INCLUSIVE,d.GATEWAY_COMPLEX]),Je=Object.values(y).filter(n=>n!=y.NONE);var K=(n=>(n.NONE="None",n.ONE="One",n.BOTH="Both",n))(K||{}),k=(n=>(n.SEQUENCE_FLOW="sequenceFlow",n.MESSAGE_FLOW="messageFlow",n.ASSOCIATION_FLOW="association",n))(k||{}),te=(n=>(n.NONE="none",n.INITIATING="initiating",n.NON_INITIATING="non_initiating",n))(te||{}),x=(n=>(n.NORMAL="normal",n.DEFAULT="default",n.CONDITIONAL_FROM_ACTIVITY="conditional_from_activity",n.CONDITIONAL_FROM_GATEWAY="conditional_from_gateway",n))(x||{});class ue{constructor(t,e,s,o,i){this.id=t,this.name=e,this.kind=s,this.sourceReferenceId=o,this.targetReferenceId=i}}class et extends ue{constructor(t,e,s,o,i=x.NORMAL){super(t,e,k.SEQUENCE_FLOW,s,o),this.sequenceFlowKind=i}}class tt extends ue{constructor(t,e,s,o){super(t,e,k.MESSAGE_FLOW,s,o)}}class nt extends ue{constructor(t,e,s,o,i=K.NONE){super(t,e,k.ASSOCIATION_FLOW,s,o),this.associationDirectionKind=i}}var xt=bt();const Yt=Rt(xt),L=Dt(),Gt=L.mxCellRenderer,Vt=L.mxClient,c=L.mxConstants,G=L.mxEvent,Ge=L.mxPerimeter,P=L.mxPoint,Ee=L.mxRectangle,_e=L.mxRectangleShape,ye=L.mxSvgCanvas2D,v=L.mxUtils;function Dt(){return window.mxForceIncludes=!1,window.mxLoadResources=!1,window.mxLoadStylesheets=!1,window.mxResourceExtension=".txt",Yt({})}class Ut{constructor(t){this.graph=t}computeRelativeCoordinates(t,e){const s=this.getTranslateForRoot(t),o=e.x+s.x,i=e.y+s.y;return new P(o,i)}getTranslateForRoot(t){const e=this.graph.getModel(),s=new P(0,0);for(;t!=null;){const o=e.getGeometry(t);o!=null&&(s.x-=o.x,s.y-=o.y),t=e.getParent(t)}return s}computeEdgeCenter(t){const e=t.geometry.points,s=e[0],o=e.at(-1),i=o.x-s.x,r=o.y-s.y;return new P(s.x+i/2,s.y+r/2)}}class re{constructor(t,e,s,o,i){g(this,"extensions",{});this.id=t,this.bpmnElement=e,this.bounds=s,this.label=o,this.isHorizontal=i}}class M{constructor(t,e,s,o,i=!1){g(this,"incomingIds",[]);g(this,"outgoingIds",[]);this.id=t,this.name=e,this.kind=s,this.parentId=o,this.instantiate=i}}class de extends M{constructor(t,e,s,o,i,r=[]){super(t,e,s,o,i),this.markers=r}}class H extends de{constructor(t,e,s,o,i,r){super(t,e,d.CALL_ACTIVITY,o,void 0,i),this.callActivityKind=s,this.globalTaskKind=r}}class ne extends de{constructor(t,e,s,o,i){s==Y.AD_HOC&&!i.includes(_.ADHOC)&&i.push(_.ADHOC),super(t,e,d.SUB_PROCESS,o,void 0,i),this.subProcessKind=s}}class D extends M{constructor(t,e,s,o,i){super(t,e,s,i),this.eventDefinitionKind=o}}class Se extends D{constructor(e,s,o,i){super(e,s,d.EVENT_INTERMEDIATE_CATCH,o,i);g(this,"sourceIds",[])}}class Ie extends D{constructor(e,s,o,i){super(e,s,d.EVENT_INTERMEDIATE_THROW,o,i);g(this,"targetId")}}class st extends D{constructor(t,e,s,o,i){super(t,e,d.EVENT_START,s,o),this.isInterrupting=i}}class ot extends D{constructor(t,e,s,o,i=!0){super(t,e,d.EVENT_BOUNDARY,s,o),this.isInterrupting=i}}class it extends M{constructor(t,e,s,o,i=ee.None){super(t,e,d.GATEWAY_EVENT_BASED,s,o),this.gatewayKind=i}}function le(n,t,e,s){return Math.min(Math.max(n??s,t),e)}function Wt(n){return Math.max(n??0,0)}function Ht(n){const t=n??{};return t.debounceDelay=le(t.debounceDelay,0,100,50),t.throttleDelay=le(t.throttleDelay,0,100,50),t}function he(n){return n=="default"?void 0:le(n,0,100,100)}function Kt(n){return n=="default"?void 0:le(n,1,50,1)}const I={EDGE:"bpmn.edge",EDGE_START_FILL_COLOR:"bpmn.edge.startFillColor",EDGE_END_FILL_COLOR:"bpmn.edge.endFillColor",EVENT_BASED_GATEWAY_KIND:"bpmn.gatewayKind",EVENT_DEFINITION_KIND:"bpmn.eventDefinitionKind",GLOBAL_TASK_KIND:"bpmn.globalTaskKind",SUB_PROCESS_KIND:"bpmn.subProcessKind",IS_INITIATING:"bpmn.isInitiating",IS_INSTANTIATING:"bpmn.isInstantiating",IS_INTERRUPTING:"bpmn.isInterrupting",EXTRA_CSS_CLASSES:"bpmn.extra.css.classes",MARKERS:"bpmn.markers",MESSAGE_FLOW_ICON:"bpmn.messageFlowIcon"},rt={ARROW_DASH:"bpmn.dash"},T={STROKE_WIDTH_THIN:2,STROKE_WIDTH_THICK:5,SHAPE_ACTIVITY_BOTTOM_MARGIN:7,SHAPE_ACTIVITY_TOP_MARGIN:7,SHAPE_ACTIVITY_LEFT_MARGIN:7,SHAPE_ACTIVITY_MARKER_ICON_MARGIN:5,SHAPE_ACTIVITY_MARKER_ICON_SIZE:20,POOL_LABEL_SIZE:30,POOL_LABEL_FILL_COLOR:"none",LANE_LABEL_SIZE:30,LANE_LABEL_FILL_COLOR:"none",SUB_PROCESS_TRANSACTION_INNER_RECT_OFFSET:4,SUB_PROCESS_TRANSACTION_INNER_RECT_ARC_SIZE:6,TEXT_ANNOTATION_BORDER_LENGTH:10,TEXT_ANNOTATION_FILL_COLOR:"none",GROUP_FILL_COLOR:"none",DEFAULT_FILL_COLOR:"White",DEFAULT_STROKE_COLOR:"Black",DEFAULT_FONT_FAMILY:"Arial, Helvetica, sans-serif",DEFAULT_FONT_SIZE:11,DEFAULT_FONT_COLOR:"Black",DEFAULT_MARGIN:0,SHAPE_ARC_SIZE:20,DEFAULT_OVERLAY_FILL_COLOR:"White",DEFAULT_OVERLAY_FILL_OPACITY:100,DEFAULT_OVERLAY_STROKE_COLOR:"Black",DEFAULT_OVERLAY_STROKE_WIDTH:1,DEFAULT_OVERLAY_FONT_SIZE:11,DEFAULT_OVERLAY_FONT_COLOR:"Black",SEQUENCE_FLOW_CONDITIONAL_FROM_ACTIVITY_MARKER_FILL_COLOR:"White",MESSAGE_FLOW_MARKER_START_FILL_COLOR:"White",MESSAGE_FLOW_MARKER_END_FILL_COLOR:"White"},lt=n=>v.getValue(n,I.IS_INSTANTIATING,"false")=="true",ae=n=>n=="default"?void 0:n,zt=(n,t)=>(t&&(n=R(n,c.STYLE_STROKECOLOR,t.color,ae),n=R(n,c.STYLE_STROKE_OPACITY,t.opacity,he),n=R(n,c.STYLE_STROKEWIDTH,t.width,Kt)),n),R=(n,t,e,s=o=>o)=>e==null?n:v.setStyle(n,t,s(e)),ie=(n,t,e,s)=>s==null?n:v.setStyleFlag(n,t,e,s),Xt=(n,t)=>(t&&(n=R(n,c.STYLE_FONTCOLOR,t.color,ae),n=R(n,c.STYLE_FONTSIZE,t.size),n=R(n,c.STYLE_FONTFAMILY,t.family),n=ie(n,c.STYLE_FONTSTYLE,c.FONT_BOLD,t.isBold),n=ie(n,c.STYLE_FONTSTYLE,c.FONT_ITALIC,t.isItalic),n=ie(n,c.STYLE_FONTSTYLE,c.FONT_UNDERLINE,t.isUnderline),n=ie(n,c.STYLE_FONTSTYLE,c.FONT_STRIKETHROUGH,t.isStrikeThrough),n=R(n,c.STYLE_TEXT_OPACITY,t.opacity,he)),n),Zt=(n,t,e)=>(n==null?void 0:n.split(";").map(s=>s.split("=")).filter(([s])=>s===t).map(([,s])=>s)[0])??e,jt=n=>{switch(n){case"right-to-left":return c.DIRECTION_WEST;case"bottom-to-top":return c.DIRECTION_NORTH;case"top-to-bottom":return c.DIRECTION_SOUTH;default:return c.DIRECTION_EAST}},$t=(n,t)=>{const e=t.color;if(e){const s=Qt(e),o=s?e.startColor:e;n=R(n,c.STYLE_FILLCOLOR,o,ae),s?(n=v.setStyle(n,c.STYLE_GRADIENTCOLOR,e.endColor),n=v.setStyle(n,c.STYLE_GRADIENT_DIRECTION,jt(e.direction))):e==="default"&&(n=v.setStyle(n,c.STYLE_GRADIENTCOLOR,void 0),n=v.setStyle(n,c.STYLE_GRADIENT_DIRECTION,void 0)),(n.includes(d.POOL)||n.includes(d.LANE))&&(n=R(n,c.STYLE_SWIMLANE_FILLCOLOR,o,ae))}return n=R(n,c.STYLE_FILL_OPACITY,t.opacity,he),n},qt=n=>n&&typeof n=="object"&&"fill"in n,Qt=n=>n&&typeof n=="object";class Jt{constructor(t){g(this,"ignoreBpmnColors");this.ignoreBpmnColors=(t==null?void 0:t.ignoreBpmnColors)??!0}computeStyle(t,e){const s=[t.bpmnElement.kind];let o;t instanceof re?o=this.computeShapeStyleValues(t):(s.push(...nn(t)),o=this.computeEdgeStyleValues(t));const i=this.computeFontStyleValues(t),r=sn(t,e);return s.push(...Ve([...o,...i,...r])),s.join(";")}computeShapeStyleValues(t){const e=new Map,s=t.bpmnElement;if(s instanceof D?en(s,e):s instanceof de?tn(s,e):E.isPoolOrLane(s.kind)?e.set(c.STYLE_HORIZONTAL,t.isHorizontal?"0":"1"):s instanceof it&&(e.set(I.IS_INSTANTIATING,String(s.instantiate)),e.set(I.EVENT_BASED_GATEWAY_KIND,String(s.gatewayKind))),!this.ignoreBpmnColors){const o=t.extensions,i=o.fillColor;i&&(e.set(c.STYLE_FILLCOLOR,i),E.isPoolOrLane(s.kind)&&e.set(c.STYLE_SWIMLANE_FILLCOLOR,i)),o.strokeColor&&e.set(c.STYLE_STROKECOLOR,o.strokeColor)}return e}computeEdgeStyleValues(t){const e=new Map;if(!this.ignoreBpmnColors){const s=t.extensions;s.strokeColor&&e.set(c.STYLE_STROKECOLOR,s.strokeColor)}return e}computeFontStyleValues(t){var o,i;const e=new Map,s=(o=t.label)==null?void 0:o.font;if(s&&(e.set(c.STYLE_FONTFAMILY,s.name),e.set(c.STYLE_FONTSIZE,s.size),e.set(c.STYLE_FONTSTYLE,on(s))),!this.ignoreBpmnColors){const r=(i=t.label)==null?void 0:i.extensions;r!=null&&r.color&&e.set(c.STYLE_FONTCOLOR,r.color)}return e}computeMessageFlowIconStyle(t){const e=[];return e.push(["shape",I.MESSAGE_FLOW_ICON],[I.IS_INITIATING,String(t.messageVisibleKind===te.INITIATING)]),this.ignoreBpmnColors||t.extensions.strokeColor&&e.push([c.STYLE_STROKECOLOR,t.extensions.strokeColor]),Ve(e).join(";")}}function en(n,t){t.set(I.EVENT_DEFINITION_KIND,n.eventDefinitionKind),(n instanceof ot||n instanceof st&&n.isInterrupting!==void 0)&&t.set(I.IS_INTERRUPTING,String(n.isInterrupting))}function tn(n,t){n instanceof ne?t.set(I.SUB_PROCESS_KIND,n.subProcessKind):n.kind===d.TASK_RECEIVE?t.set(I.IS_INSTANTIATING,String(n.instantiate)):n instanceof H&&t.set(I.GLOBAL_TASK_KIND,n.globalTaskKind);const e=n.markers;e.length>0&&t.set(I.MARKERS,e.join(","))}function nn(n){const t=[],e=n.bpmnElement;return e instanceof et&&t.push(e.sequenceFlowKind),e instanceof nt&&t.push(e.associationDirectionKind),t}function sn(n,t){const e=new Map,s=n.bpmnElement;return t?(e.set(c.STYLE_VERTICAL_ALIGN,c.ALIGN_TOP),n.bpmnElement.kind!=d.TEXT_ANNOTATION&&e.set(c.STYLE_ALIGN,c.ALIGN_CENTER),n instanceof re&&(e.set(c.STYLE_LABEL_WIDTH,t.width+1),e.set(c.STYLE_LABEL_POSITION,"ignore"),e.set(c.STYLE_VERTICAL_LABEL_POSITION,c.ALIGN_MIDDLE))):n instanceof re&&(s instanceof ne||s instanceof H&&s.callActivityKind===J.CALLING_PROCESS)&&!s.markers.includes(_.EXPAND)&&e.set(c.STYLE_VERTICAL_ALIGN,c.ALIGN_TOP),e}function on(n){let t=0;return n.isBold&&(t+=c.FONT_BOLD),n.isItalic&&(t+=c.FONT_ITALIC),n.isStrikeThrough&&(t+=c.FONT_STRIKETHROUGH),n.isUnderline&&(t+=c.FONT_UNDERLINE),t}function Ve(n){return n.filter(([,t])=>t&&t!="undefined").map(([t,e])=>`${t}=${e}`)}class rn{constructor(t,e,s){this.graph=t,this.coordinatesTranslator=e,this.styleComputer=s}render(t,e){this.insertShapesAndEdges(t),this.graph.customFit(e)}insertShapesAndEdges({pools:t,lanes:e,subprocesses:s,otherFlowNodes:o,boundaryEvents:i,edges:r}){this.graph.batchUpdate(()=>{this.graph.getModel().clear(),this.insertShapes(t),this.insertShapes(e),this.insertShapes(s),this.insertShapes(o),this.insertShapes(i),this.insertEdges(r)})}insertShapes(t){for(const e of t)this.insertShape(e)}getParent(t){return this.getCell(t.parentId)??this.graph.getDefaultParent()}insertShape(t){var l;const e=t.bpmnElement,s=this.getParent(e),o=t.bounds;let i=(l=t.label)==null?void 0:l.bounds;i=E.isPoolOrLane(e.kind)?void 0:i;const r=this.styleComputer.computeStyle(t,i);this.insertVertex(s,e.id,e.name,o,i,r)}insertEdges(t){var e;for(const s of t){const o=s.bpmnElement,i=this.graph.getDefaultParent(),r=this.getCell(o.sourceReferenceId),l=this.getCell(o.targetReferenceId),a=(e=s.label)==null?void 0:e.bounds,h=this.styleComputer.computeStyle(s,a),u=this.graph.insertEdge(i,o.id,o.name,r,l,h);if(this.insertWaypoints(s.waypoints,u),a){u.geometry.width=a.width,u.geometry.height=a.height;const f=this.coordinatesTranslator.computeEdgeCenter(u);u.geometry.relative=!1;const p=this.coordinatesTranslator.computeRelativeCoordinates(u.parent,new P(a.x,a.y)),m=p.x+a.width/2-f.x,C=p.y-f.y;u.geometry.offset=new P(m,C)}this.insertMessageFlowIconIfNeeded(s,u)}}insertMessageFlowIconIfNeeded(t,e){if(t.bpmnElement instanceof tt&&t.messageVisibleKind!==te.NONE){const s=this.graph.insertVertex(e,we(e.id),void 0,0,0,20,14,this.styleComputer.computeMessageFlowIconStyle(t));s.geometry.relative=!0,s.geometry.offset=new P(-10,-7)}}insertWaypoints(t,e){t&&(e.geometry.points=t.map(s=>this.coordinatesTranslator.computeRelativeCoordinates(e.parent,new P(s.x,s.y))))}getCell(t){return this.graph.getModel().getCell(t)}insertVertex(t,e,s,o,i,r){const l=this.coordinatesTranslator.computeRelativeCoordinates(t,new P(o.x,o.y)),a=this.graph.insertVertex(t,e,s,l.x,l.y,o.width,o.height,r);if(i){const h=i.x-o.x,u=i.y-o.y;a.geometry.offset=new P(h,u)}return a}}function ln(n,t){return new rn(n,new Ut(n),new Jt(t))}function we(n){return`messageFlowIcon_of_${n}`}function at(n,t,{signal:e,edges:s}={}){let o,i=null;const r=s!=null&&s.includes("leading"),l=s==null||s.includes("trailing"),a=()=>{i!==null&&(n.apply(o,i),o=void 0,i=null)},h=()=>{l&&a(),m()};let u=null;const f=()=>{u!=null&&clearTimeout(u),u=setTimeout(()=>{u=null,h()},t)},p=()=>{u!==null&&(clearTimeout(u),u=null)},m=()=>{p(),o=void 0,i=null},C=()=>{p(),a()},b=function(...j){if(e!=null&&e.aborted)return;o=this,i=j;const _t=u==null;f(),r&&_t&&a()};return b.schedule=f,b.cancel=m,b.flush=C,e==null||e.addEventListener("abort",m,{once:!0}),b}function an(n,t,{signal:e,edges:s=["leading","trailing"]}={}){let o=null;const i=at(n,t,{signal:e,edges:s}),r=function(...l){o==null?o=Date.now():Date.now()-o>=t&&(o=Date.now(),i.cancel(),i(...l)),i(...l)};return r.cancel=i.cancel,r.flush=i.flush,r}class ct extends L.mxCellOverlay{constructor(e,s){super(null,"",s.position.horizontalAlign,s.position.verticalAlign,null,"default");g(this,"style");this.label=e,this.style=s.style}getBounds(e){const s=e.view.graph.getModel().isEdge(e.cell),o=e.view.scale;let i;const r=0,l=0;return s?i=this.computeEdgeBounds(e):(i=new P,this.align==c.ALIGN_LEFT?i.x=e.x:this.align==c.ALIGN_CENTER?i.x=e.x+e.width/2:i.x=e.x+e.width,this.verticalAlign==c.ALIGN_TOP?i.y=e.y:this.verticalAlign==c.ALIGN_MIDDLE?i.y=e.y+e.height/2:i.y=e.y+e.height),new Ee(Math.round(i.x-(r*this.defaultOverlap-this.offset.x)*o),Math.round(i.y-(l*this.defaultOverlap-this.offset.y)*o),r*o,l*o)}computeEdgeBounds(e){const s=e.absolutePoints;if(this.align==c.ALIGN_LEFT)return s[0];if(this.align==c.ALIGN_CENTER){if(s.length%2==1)return s[Math.floor(s.length/2)];{const o=s.length/2,i=s[o-1],r=s[o];return new P(i.x+(r.x-i.x)/2,i.y+(r.y-i.y)/2)}}else return s.at(-1)}}class De extends L.mxText{constructor(t,e,s){super(t,e,void 0,void 0,s.font.color,void 0,s.font.size,void 0,void 0,void 0,void 0,void 0,void 0,void 0,s.fill.color,s.stroke.color),this.fillOpacity=s.fill.opacity,this.strokewidth=s.stroke.width}}function cn(n){return Object.values(k).map(t=>t).includes(n)}function un(n,t){return dn(n.style,t)}function dn(n,t){const e=[],s=n.split(";"),i=s[0].replace(/shape=bpmn./g,""),r=new Map;r.set("bpmn-type-activity",E.isActivity(i)),r.set("bpmn-type-container",E.isPoolOrLane(i)),r.set("bpmn-type-event",E.isEvent(i)),r.set("bpmn-type-flow",cn(i)),r.set("bpmn-type-gateway",E.isGateway(i)),r.set("bpmn-type-task",E.isTask(i));for(const[l]of[...r].filter(([,a])=>a))e.push(l);e.push(Ce(i));for(const[l,a]of s.map(h=>{const u=h.split("=");return[u[0],u[1]]}))switch(l){case I.EVENT_DEFINITION_KIND:{e.push(`bpmn-event-def-${a}`);break}case I.EVENT_BASED_GATEWAY_KIND:{e.push(`bpmn-gateway-kind-${a.toLowerCase()}`);break}case I.IS_INITIATING:{e.push(a=="true"?"bpmn-icon-initiating":"bpmn-icon-non-initiating");break}case I.SUB_PROCESS_KIND:{e.push(`bpmn-sub-process-${a.toLowerCase()}`);break}case I.GLOBAL_TASK_KIND:{e.push(Ce(a));break}}return t&&e.push("bpmn-label"),e}function Ce(n){return n?"bpmn-"+n.replace(/([A-Z])/g,t=>"-"+t[0].toLowerCase()):""}const Ue=function(n){const t=n.createSvgCanvas;n.createSvgCanvas=function(){var o;const e=t.bind(this)(),s=e.getTextCss;if(e.getTextCss=function(){const i=this.pointerEvents;this.pointerEvents=!1;const r=s.bind(this)();return this.pointerEvents=i,r},(o=this.state)!=null&&o.cell){const i=this.state.cell,r=un(i,this.dialect===c.DIALECT_STRICTHTML),l=this.state.style[I.EXTRA_CSS_CLASSES];typeof l=="string"&&r.push(...l.split(",")),this.node.setAttribute("class",r.join(" ")),this.node.dataset.bpmnId=this.state.cell.id}return e}};class hn extends L.mxCellRenderer{constructor(t){super(),this.iconPainter=t}createCellOverlays(t){const s=t.view.graph.getCellOverlays(t.cell);let o=null;if(s!=null){o=new L.mxDictionary;for(const i of s){const r=t.overlays==null?null:t.overlays.remove(i);if(r!=null){o.put(i,r);continue}let l;i instanceof ct?l=new De(i.label,new Ee(0,0,0,0),i.style):(l=new L.mxImageShape(new Ee(0,0,0,0),i.image.src),l.preserveImageAspect=!1),l.dialect=t.view.graph.dialect,l.overlay=i,this.initializeOverlay(t,l),this.installCellOverlayListeners(t,i,l),i.cursor!=null&&(l.node.style.cursor=i.cursor),l instanceof De&&(l.node.classList.add("overlay-badge"),l.node.dataset.bpmnId=t.cell.id),o.put(i,l)}}t.overlays!=null&&t.overlays.visit(function(i,r){r.destroy()}),t.overlays=o}createShape(t){const e=super.createShape(t);return"iconPainter"in e&&(e.iconPainter=this.iconPainter),Ue(e),e}createLabel(t,e){super.createLabel(t,e),Ue(t.text)}}function fn(n,t,e,s){let o,i;n.height<n.width||n.height==n.width&&e.width<=e.height?(o=e.width,i=e.width*n.height/n.width):(o=e.height*n.width/n.height,i=e.height);const r=t.strokeWidth?(t.strokeWidth-1)*2:0,l=o*s-r,a=i*s-r;return{width:l,height:a}}class gn{constructor({canvas:t,shapeConfig:e,iconConfig:s}){g(this,"canvas");g(this,"iconOriginalSize");g(this,"scaleX");g(this,"scaleY");g(this,"iconPaintingOriginX",0);g(this,"iconPaintingOriginY",0);g(this,"shapeConfiguration");this.canvas=t,this.shapeConfiguration=e,this.iconOriginalSize=s.originalSize;const o=s.ratioFromParent;if(o){const i=fn(this.iconOriginalSize,s.styleConfig,this.shapeConfiguration,o);this.scaleX=i.width/this.iconOriginalSize.width,this.scaleY=i.height/this.iconOriginalSize.height}else this.scaleX=1,this.scaleY=1;this.updateCanvasStyle(s.styleConfig),s.setIconOriginFunct(this)}setIconOriginToShapeTopLeftProportionally(t){const e=this.shapeConfiguration;this.iconPaintingOriginX=e.x+e.width/t,this.iconPaintingOriginY=e.y+e.height/t}setIconOriginToShapeTopLeft(t=T.SHAPE_ACTIVITY_TOP_MARGIN,e=T.SHAPE_ACTIVITY_LEFT_MARGIN){const s=this.shapeConfiguration;this.iconPaintingOriginX=s.x+e,this.iconPaintingOriginY=s.y+t}setIconOriginForIconCentered(){const t=this.shapeConfiguration;this.iconPaintingOriginX=t.x+(t.width-this.iconOriginalSize.width*this.scaleX)/2,this.iconPaintingOriginY=t.y+(t.height-this.iconOriginalSize.height*this.scaleY)/2}setIconOriginForIconBottomCentered(t=T.SHAPE_ACTIVITY_BOTTOM_MARGIN){const e=this.shapeConfiguration;this.iconPaintingOriginX=e.x+(e.width-this.iconOriginalSize.width*this.scaleX)/2,this.iconPaintingOriginY=e.y+(e.height-this.iconOriginalSize.height*this.scaleY-t)}translateIconOrigin(t,e){this.iconPaintingOriginX+=this.scaleX*t,this.iconPaintingOriginY+=this.scaleY*e}computeScaleFromOriginX(t){return this.iconPaintingOriginX+t*this.scaleX}computeScaleFromOriginY(t){return this.iconPaintingOriginY+t*this.scaleY}updateCanvasStyle({isFilled:t,strokeColor:e,fillColor:s,strokeWidth:o}){t?this.canvas.setFillColor(e):this.canvas.setFillColor(s),this.canvas.setStrokeWidth(o)}arcTo(t,e,s,o,i,r,l){this.canvas.arcTo(t*this.scaleX,e*this.scaleY,s,o,i,this.computeScaleFromOriginX(r),this.computeScaleFromOriginY(l))}begin(){this.canvas.begin()}close(){this.canvas.close()}curveTo(t,e,s,o,i,r){this.canvas.curveTo(this.computeScaleFromOriginX(t),this.computeScaleFromOriginY(e),this.computeScaleFromOriginX(s),this.computeScaleFromOriginY(o),this.computeScaleFromOriginX(i),this.computeScaleFromOriginY(r))}fill(){this.canvas.fill()}fillAndStroke(){this.canvas.fillAndStroke()}setFillColor(t){this.canvas.setFillColor(t)}stroke(){this.canvas.stroke()}setStrokeColor(t){this.canvas.setStrokeColor(t)}setRoundLineJoin(){this.canvas.setLineJoin("round")}lineTo(t,e){this.canvas.lineTo(this.computeScaleFromOriginX(t),this.computeScaleFromOriginY(e))}moveTo(t,e){this.canvas.moveTo(this.computeScaleFromOriginX(t),this.computeScaleFromOriginY(e))}rect(t,e,s,o){this.canvas.rect(this.computeScaleFromOriginX(t),this.computeScaleFromOriginY(e),s*this.scaleX,o*this.scaleY)}roundrect(t,e,s,o,i,r){this.canvas.roundrect(this.computeScaleFromOriginX(t),this.computeScaleFromOriginY(e),s*this.scaleX,o*this.scaleY,i,r)}ellipse(t,e,s,o){this.canvas.ellipse(this.computeScaleFromOriginX(t),this.computeScaleFromOriginY(e),s*this.scaleX,o*this.scaleY)}rotateOnIconCenter(t){const e=this.iconPaintingOriginX+this.iconOriginalSize.width/2*this.scaleX,s=this.iconPaintingOriginY+this.iconOriginalSize.height/2*this.scaleY;this.canvas.rotate(t,!1,!1,e,s)}}function X({canvas:n,x:t,y:e,width:s,height:o,shape:i,ratioFromParent:r,isFilled:l,iconStrokeWidth:a}){const h=v.getValue(i.style,c.STYLE_STROKEWIDTH,T.STROKE_WIDTH_THIN),u=v.getValue(i.style,c.STYLE_FILLCOLOR,T.DEFAULT_FILL_COLOR),f=v.getValue(i.style,c.STYLE_STROKECOLOR,T.DEFAULT_STROKE_COLOR),p=v.getValue(i.style,c.STYLE_MARGIN,T.DEFAULT_MARGIN);return r??(r=.25),l??(l=!1),a??(a=0),{canvas:n,ratioFromParent:r,setIconOriginFunct:m=>m.setIconOriginForIconCentered(),shapeConfig:{x:t,y:e,width:s,height:o,strokeWidth:h},iconStyleConfig:{isFilled:l,fillColor:u,strokeColor:f,strokeWidth:a,margin:p}}}class Tn{newBpmnCanvas({canvas:t,ratioFromParent:e,setIconOriginFunct:s,shapeConfig:o,iconStyleConfig:i},r){return new gn({canvas:t,shapeConfig:o,iconConfig:{originalSize:r,styleConfig:i,ratioFromParent:e,setIconOriginFunct:s}})}paintEnvelopeIcon(t){const e={width:485.41,height:321.76},s=this.newBpmnCanvas(t,e),o=e.width,i=e.height;s.rect(0,0,o,i),s.fillAndStroke();const{iconStyleConfig:r}=t;r.isFilled&&s.setStrokeColor(r.fillColor),s.begin(),s.moveTo(0,0),s.lineTo(o*.5,i*.6),s.lineTo(o,0),s.moveTo(0,i),s.lineTo(o/3,i*.45),s.moveTo(o,i),s.lineTo(o*2/3,i*.45),s.stroke()}paintCircleIcon(t){const e={width:t.shapeConfig.width,height:t.shapeConfig.height},s=this.newBpmnCanvas(t,e),o=e.width,i=e.height;o>0&&i>0&&s.ellipse(0,0,o,i),t.iconStyleConfig.isFilled?s.fillAndStroke():s.stroke()}paintClockIcon(t){const e=this.newBpmnCanvas(t,{height:152,width:152});e.begin(),e.moveTo(184,60),e.curveTo(188.4,60,192,56.4,192,52),e.lineTo(192,48),e.curveTo(192,40,188.4,40,184,40),e.curveTo(179.6,40,176,43.6,176,48),e.lineTo(176,52),e.curveTo(176,56.4,179.6,60,184,60),e.close(),e.moveTo(184,308),e.curveTo(179.6,308,176,311.6,176,316),e.lineTo(176,320),e.curveTo(176,324.4,179.6,328,184,328),e.curveTo(188.4,328,192,324.4,192,320),e.lineTo(192,316),e.curveTo(192,311.6,188.4,308,184,308),e.close(),e.moveTo(52,176),e.lineTo(48,176),e.curveTo(43.6,176,40,179.6,40,184),e.curveTo(40,188.4,43.6,192,48,192),e.lineTo(52,192),e.curveTo(56.4,192,69,188.4,60,184),e.curveTo(60,179.6,56.4,176,52,176),e.close(),e.moveTo(320,176),e.lineTo(316,176),e.curveTo(311.6,176,308,179.6,308,184),e.curveTo(308,188.4,311.6,192,316,192),e.lineTo(320,192),e.curveTo(324.4,192,328,188.4,328,184),e.curveTo(328,179.6,324.4,176,320,176),e.moveTo(93.6,82.4),e.curveTo(90.4,79.2,85.6,79.2,82.4,82.4),e.curveTo(79.2,85.6,79.2,90.4,82.4,93.6),e.lineTo(85.2,96.4),e.curveTo(86.8,98,88.8,98.8,90.8,98.8),e.curveTo(92.8,98.8,94.4,98,96.4,96.4),e.curveTo(99.6,93.2,99.6,88.4,96.4,85.2),e.lineTo(93.6,82.4),e.moveTo(85.2,271.6),e.lineTo(82.4,274.4),e.curveTo(79.2,277.6,79.2,282.4,82.4,285.6),e.curveTo(84,287.2,86,288,88,288),e.curveTo(90,288,92,287.2,93.6,285.6),e.lineTo(96.4,282.8),e.curveTo(99.6,279.6,99.6,274.8,96.4,271.6),e.curveTo(93.2,268.4,88.4,268.4,85.2,271.6),e.moveTo(274.4,82.4),e.lineTo(271.6,85.2),e.curveTo(268.4,88.4,268.4,93.2,271.6,96.4),e.curveTo(273.298,98,275.2,98.8,277.2,98.8),e.curveTo(279.2,98.8,281.2,98,282.8,96.4),e.lineTo(285.6,93.6),e.curveTo(288.8,90.4,288.8,85.6,285.6,82.4),e.curveTo(282.4,79.2,277.6,79.2,274.4,82.4),e.moveTo(192,180.8),e.lineTo(192,108),e.curveTo(192,103.6,188.4,100,184,100),e.curveTo(179.6,100,176,103.6,176,108),e.lineTo(176,184),e.curveTo(176,186,176.8,188,178.4,189.6),e.lineTo(266,277.2),e.curveTo(267.6,278.8,269.6,279.6,271.6,279.6),e.curveTo(273.6,279.6,275.6,278.8,277.2,277.2),e.curveTo(280.4,274,280.4,269.2,277.2,266),e.lineTo(192,180.8),e.moveTo(184,0),e.curveTo(82.4,0,0,82.4,0,184),e.curveTo(0,285.6,82.4,368,184,368),e.curveTo(285.6,368,368,285.6,368,184),e.curveTo(368,82.4,285.6,0,184,0),e.moveTo(184,352),e.curveTo(91.2,352,16,276.8,16,184),e.curveTo(16,91.2,91.2,16,184,16),e.curveTo(276.8,16,352,91.2,352,184),e.curveTo(352,276.8,276.8,352,184,352),e.fillAndStroke()}paintTriangleIcon(t){const e=this.newBpmnCanvas(t,{height:735,width:849});e.begin(),e.moveTo(497,55),e.lineTo(817,609),e.curveTo(849,665,808,735,744,735),e.lineTo(105,735),e.curveTo(40,735,0,665,32,609),e.lineTo(352,55),e.curveTo(384,0,465,0,497,55),e.close(),e.fillAndStroke()}paintUpArrowheadIcon(t){const e=this.newBpmnCanvas(t,{height:50,width:40});e.begin(),e.moveTo(0,49.5),e.lineTo(19.5,1),e.curveTo(19.75,.25,20,0,20.25,.25),e.lineTo(40,49.5),e.curveTo(40,49.5,39.75,50,39.6,49.75),e.lineTo(20,30),e.lineTo(.4,49.75),e.curveTo(.4,49.75,.25,50,0,49.5),e.close(),e.fillAndStroke()}paintDoubleLeftArrowheadsIcon(t){const e=this.newBpmnCanvas(t,{height:53.5,width:105});e.begin(),e.moveTo(91.4,0),e.curveTo(91.4,0,91.2,0,91,.2),e.lineTo(50,25),e.curveTo(47.9,25.8,46.7,26.6,46.4,27.3),e.lineTo(46.4,0),e.curveTo(46.4,0,46.2,0,46,.2),e.lineTo(4.9,25),e.curveTo(2,26.2,0,27.3,4.9,28.5),e.lineTo(45.8,53),e.curveTo(46,53.3,46.2,53.5,46.4,53.5),e.lineTo(46.4,27),e.curveTo(46.6,27.3,47.8,28.1,49.9,29.9),e.lineTo(90.8,53.3),e.curveTo(91,53.3,91.2,53.5,91.4,53.5),e.lineTo(91.4,0),e.close(),e.fillAndStroke()}drawCrossIcon(t){const e=this.newBpmnCanvas(t,{height:1,width:1});return e.begin(),e.moveTo(.38,0),e.lineTo(.62,0),e.lineTo(.62,.38),e.lineTo(1,.38),e.lineTo(1,.62),e.lineTo(.62,.62),e.lineTo(.62,1),e.lineTo(.38,1),e.lineTo(.38,.62),e.lineTo(0,.62),e.lineTo(0,.38),e.lineTo(.38,.38),e.close(),e}paintListIcon(t){const e=this.newBpmnCanvas(t,{height:60,width:60});e.begin(),e.moveTo(0,0),e.lineTo(60,0),e.lineTo(60,60),e.lineTo(0,60),e.lineTo(0,0),e.close(),e.moveTo(5,5),e.lineTo(55,5),e.close(),e.moveTo(5,21.6),e.lineTo(55,21.6),e.close(),e.moveTo(5,38.3),e.lineTo(55,38.3),e.close(),e.moveTo(5,55),e.lineTo(55,55),e.close(),e.fillAndStroke()}paintXCrossIcon(t){const e=this.drawCrossIcon(t);e.rotateOnIconCenter(45),e.fillAndStroke()}paintPlusCrossIcon(t){this.drawCrossIcon(t).fillAndStroke()}paintAsteriskIcon(t){const e=this.newBpmnCanvas(t,{height:1,width:1});fe(e),e.fillAndStroke(),fe(e),e.rotateOnIconCenter(60),e.fillAndStroke(),fe(e),e.rotateOnIconCenter(240),e.fillAndStroke()}paintPersonIcon(t){const e=this.newBpmnCanvas({...t,iconStyleConfig:{...t.iconStyleConfig,isFilled:!0}},{height:239.68,width:143.61});e.begin(),e.moveTo(124.31,150.29),e.lineTo(99.66,141.03),e.arcTo(6.43,6.43,0,0,1,95.51,135.03),e.lineTo(95.51,130.66),e.arcTo(47.75,47.75,0,0,0,119.51,89.25),e.lineTo(119.51,71.25),e.arcTo(47.62,47.62,0,0,0,101.18,33.64),e.arcTo(29.35,29.35,0,0,0,101.52,29.14),e.arcTo(29.68,29.68,0,0,0,42.17,29.14),e.arcTo(29.24,29.24,0,0,0,42.53,33.63),e.arcTo(47.65,47.65,0,0,0,24.14,71.23),e.lineTo(24.14,89.23),e.arcTo(47.7,47.7,0,0,0,48.19,130.63),e.lineTo(48.19,135.03),e.arcTo(6.43,6.43,0,0,1,44.03,141.03),e.lineTo(19.31,150.29),e.arcTo(29.81,29.81,0,0,0,.09,178.03),e.lineTo(.09,233.51),e.arcTo(5.63,5.63,0,1,0,11.34,233.51),e.lineTo(11.34,178.03),e.arcTo(18.19,18.19,0,0,1,11.57,175.17),e.lineTo(20.5,184.11),e.arcTo(12.32,12.32,0,0,1,24.14,192.89),e.lineTo(24.14,233.51),e.arcTo(5.63,5.63,0,1,0,35.39,233.51),e.lineTo(35.39,192.93),e.arcTo(23.5,23.5,0,0,0,28.46,176.2),e.lineTo(17.04,164.78),e.arcTo(18.34,18.34,0,0,1,23.29,160.78),e.lineTo(43.65,153.15),e.lineTo(66.22,175.72),e.lineTo(66.22,233.51),e.arcTo(5.63,5.63,0,1,0,77.47,233.51),e.lineTo(77.47,175.76),e.lineTo(100.04,153.19),e.lineTo(120.4,160.82),e.arcTo(18.39,18.39,0,0,1,126.65,164.82),e.lineTo(115.24,176.24),e.arcTo(23.5,23.5,0,0,0,108.31,192.93),e.lineTo(108.31,233.55),e.arcTo(5.63,5.63,0,1,0,119.56,233.55),e.lineTo(119.56,192.93),e.arcTo(12.35,12.35,0,0,1,123.19,184.15),e.lineTo(132.13,175.22),e.arcTo(18,18,0,0,1,132.36,178.08),e.lineTo(132.36,233.56),e.arcTo(5.63,5.63,0,0,0,143.61,233.56),e.lineTo(143.61,178.03),e.arcTo(29.81,29.81,0,0,0,124.31,150.29),e.close(),e.moveTo(71.85,10.72),e.arcTo(18.46,18.46,0,0,1,90.17,27.18),e.arcTo(47.68,47.68,0,0,0,53.53,27.18),e.arcTo(18.44,18.44,0,0,1,71.85,10.72),e.close(),e.moveTo(35.39,71.23),e.arcTo(36.46,36.46,0,0,1,108.31,71.23),e.lineTo(108.31,77.4),e.curveTo(82.12,75.4,56.97,60.55,56.71,60.4),e.arcTo(5.62,5.62,0,0,0,48.78,62.71),e.curveTo(46.24,67.79,40.45,71.89,35.39,74.62),e.close(),e.moveTo(35.39,89.23),e.lineTo(35.39,87.08),e.curveTo(40.55,84.85,49.73,80.08,55.67,72.66),e.curveTo(64.83,77.46,85.92,87.21,108.31,88.66),e.lineTo(108.31,89.24),e.arcTo(36.46,36.46,0,1,1,35.39,89.24),e.close(),e.moveTo(71.85,165.45),e.lineTo(54.06,147.69),e.arcTo(17.7,17.7,0,0,0,59.43,135.32),e.arcTo(47.57,47.57,0,0,0,84.27,135.32),e.arcTo(17.7,17.7,0,0,0,89.64,147.69),e.close(),e.fill()}paintGearIcon(t){const e=this.newBpmnCanvas(t,{height:100,width:100});pn(e),e.translateIconOrigin(14,14),En(e)}paintExpandIcon(t){const e={width:16,height:16},s=this.newBpmnCanvas(t,e),o=e.width,i=e.height;s.roundrect(0,0,o,i,2,2),s.stroke(),s.begin(),s.moveTo(o/2,i/4),s.lineTo(o/2,i*3/4),s.close(),s.moveTo(o/4,i/2),s.lineTo(o*3/4,i/2),s.close(),s.fillAndStroke()}paintLoopIcon(t){const{iconStyleConfig:e}=t;e.fillColor=e.strokeColor;const s=this.newBpmnCanvas(t,{width:22.49,height:21.62});s.begin(),s.moveTo(5.5,19.08),s.arcTo(8,8,0,1,1,10.5,21.08),s.stroke(),s.begin(),s.moveTo(7.5,14.08),s.lineTo(5.75,19.08),s.lineTo(0,17.08),s.close(),s.fillAndStroke()}paintSequentialMultiInstanceIcon(t){const e={width:16,height:16},s=this.newBpmnCanvas(t,e),{canvas:o,iconStyleConfig:i}=t;o.setFillColor(i.strokeColor);const r=e.width,l=e.height/5;s.rect(0,0,r,l),s.fill(),s.rect(0,2*l,r,l),s.fill(),s.rect(0,4*l,r,l),s.fill()}paintParallelMultiInstanceIcon(t){const e={width:16,height:16},s=this.newBpmnCanvas(t,e),{canvas:o,iconStyleConfig:i}=t;o.setFillColor(i.strokeColor);const r=e.width/5,l=e.height;s.begin(),s.rect(0,0,r,l),s.fill(),s.rect(2*r,0,r,l),s.fill(),s.rect(4*r,0,r,l),s.fill()}paintRightArrowIcon(t){const e=this.newBpmnCanvas(t,{width:512,height:415.23});e.setRoundLineJoin(),e.begin(),e.moveTo(512,207.61),e.lineTo(304.38,0),e.lineTo(304.38,135.39),e.lineTo(0,135.39),e.lineTo(0,279.84),e.lineTo(304.38,279.84),e.lineTo(304.38,415.23),e.lineTo(512,207.61),e.close(),e.fillAndStroke()}paintErrorIcon(t){const e=this.newBpmnCanvas(t,{width:72.44,height:71.82});e.begin(),e.moveTo(0,53.32),e.lineTo(19.48,0),e.lineTo(19.48,0),e.lineTo(50.85,40.07),e.lineTo(72.44,18.21),e.lineTo(53.12,71.82),e.lineTo(22.5,31.37),e.close(),e.fillAndStroke()}paintHandIcon(t){const e=this.newBpmnCanvas(t,{width:343.65,height:354.12});e.begin(),e.moveTo(231.66,336.39),e.curveTo(240.84,316.9,220.53,306.92,220.53,306.92),e.curveTo(215.2,303.67,188.58,287.43,140.67,258.19),e.lineTo(146.33,248.39),e.curveTo(223.98,269.38,267.12,281.04,275.75,283.38),e.curveTo(275.75,283.38,297.25,288,301.42,267.77),e.curveTo(306.34,245.29,288.32,238.63,288.32,238.63),e.curveTo(279.91,236.44,237.86,225.48,162.18,205.75),e.lineTo(165.2,194.8),e.curveTo(255.88,204.4,306.27,209.73,316.34,210.8),e.curveTo(316.34,210.8,339.89,212.16,341.76,189.55),e.curveTo(343.65,166.93,320.5,164.13,320.5,164.13),e.curveTo(310.43,163.1,260.04,157.99,169.35,148.77),e.lineTo(169.35,138.97),e.curveTo(253.41,132.12,300.11,128.32,309.45,127.56),e.curveTo(309.45,127.56,332.27,122.38,332.27,102.61),e.curveTo(332.27,82.85,305.48,81.87,305.48,81.87),e.curveTo(293.99,82.2,236.54,83.88,133.13,86.9),e.lineTo(127.61,81.87),e.curveTo(145.3,59.39,155.12,46.9,157.09,44.41),e.curveTo(157.09,44.41,171.12,26.8,156.78,12.72),e.curveTo(143.83,0,124.08,14.49,124.08,14.49),e.curveTo(116.45,19.41,78.35,44.06,9.77,88.43),e.lineTo(0,251.94),e.curveTo(122.84,308.79,191.09,340.37,204.74,346.69),e.curveTo(204.74,346.69,222.91,354.12,231.66,336.39),e.fillAndStroke()}paintScriptIcon(t){t.iconStyleConfig.fillColor=t.iconStyleConfig.strokeColor;const e=this.newBpmnCanvas(t,{width:458.75,height:461.64});e.begin(),e.moveTo(67.85,.57),e.curveTo(50.73,0,33.26,8.86,22.35,18.84),e.curveTo(8.11,32.15,0,50.77,0,70.26),e.curveTo(0,73.15,0,87.59,0,113.6),e.curveTo(55.4,113.6,86.18,113.6,92.33,113.6),e.curveTo(94.92,150.46,85.64,180.4,74.22,211.27),e.curveTo(40.16,298.07,30.77,339.83,55.56,410.87),e.curveTo(63.72,438.26,87.59,457.85,114.91,461.09),e.curveTo(216.96,460.85,294.9,461.64,388.41,461.2),e.curveTo(407.2,461.09,425.14,453.55,438.3,440.13),e.curveTo(451.46,426.71,458.75,403.06,458.46,384.26),e.curveTo(458.43,382.23,458.18,365.93,458.15,363.89),e.curveTo(432.12,364.24,406.09,364.04,380.06,364.04),e.curveTo(377.61,347.52,377.24,337.58,378.28,324.48),e.curveTo(380.5,296.47,389.08,273.36,398.59,247.1),e.curveTo(408.11,220.83,418.41,191.47,420.86,154.24),e.curveTo(422.11,135.34,421.4,110.24,417.77,86.75),e.curveTo(417.76,86.71,417.73,86.54,417.69,86.22),e.curveTo(417.64,85.95,417.61,85.79,417.6,85.76),e.curveTo(414.03,68.13,410.49,48.84,399.79,31.47),e.curveTo(389.09,14.11,366.95,.59,341.75,.59),e.curveTo(286.97,.59,122.63,.57,67.85,.57),e.close(),e.moveTo(85.04,72.68),e.curveTo(80.63,72.68,45.33,72.68,40.92,72.68),e.curveTo(40.46,58.4,47.15,51.87,50.27,48.75),e.curveTo(55.8,44.28,59.84,41,73.82,41),e.curveTo(78.45,52.13,82.23,62.71,85.04,72.68),e.close(),e.moveTo(364.94,52.9),e.curveTo(370,61.11,373.9,76.44,377.38,93.51),e.curveTo(380.35,113.1,381.01,136.42,380.02,151.57),e.curveTo(377.97,182.76,369.51,207.12,360.1,233.1),e.curveTo(350.69,259.09,340.27,286.77,337.53,321.27),e.curveTo(336.38,335.86,336.72,346.69,338.87,364.01),e.curveTo(326.35,364.01,263.75,364.01,151.06,364.01),e.curveTo(151.06,382.2,151.06,392.31,151.06,394.33),e.curveTo(147.77,404.8,138.9,418.2,127.43,419.94),e.curveTo(111.49,422.35,97.86,411.8,94.75,399.19),e.curveTo(65.14,321.99,94.93,275.54,112.57,225.47),e.curveTo(130.14,177.95,137.92,117.41,112.71,42.09),e.curveTo(192.88,41.9,274.33,42.21,342.89,41.98),e.curveTo(357.15,42.03,359.83,44.61,364.94,52.9),e.close(),e.moveTo(409.96,399.48),e.curveTo(409.96,408.42,398.54,425.67,392.02,425.67),e.curveTo(325.19,425.79,252.29,425.67,185.23,425.67),e.curveTo(189.88,424.43,194.66,405.64,194.66,399.48),e.curveTo(237.72,399.48,388.43,399.48,409.96,399.48),e.close(),e.fill(),e.begin(),e.moveTo(182.1,131.2),e.lineTo(182.1,151.68),e.lineTo(321.89,151.68),e.lineTo(321.89,131.2),e.lineTo(182.1,131.2),e.close(),e.moveTo(162.25,251.09),e.lineTo(162.25,271.49),e.lineTo(301.96,271.49),e.lineTo(301.96,251.09),e.lineTo(162.25,251.09),e.close(),e.fill()}paintTableIcon(t){const e=this.newBpmnCanvas(t,{width:640,height:640});e.begin(),e.moveTo(.19,.1),e.lineTo(298.78,.1),e.lineTo(298.78,198.88),e.lineTo(.19,198.88),e.lineTo(.19,.1),e.close(),e.fillAndStroke(),e.begin(),e.moveTo(0,0),e.lineTo(298.78,0),e.lineTo(298.78,48.88),e.lineTo(0,48.88),e.lineTo(0,0),e.close(),e.fillAndStroke(),e.begin(),e.moveTo(0,48.88),e.lineTo(98.78,48.88),e.lineTo(98.78,198.88),e.lineTo(0,198.88),e.lineTo(0,48.88),e.close(),e.fillAndStroke(),e.begin(),e.moveTo(1.09,122.69),e.lineTo(298.78,122.69),e.close(),e.fillAndStroke(),e.setFillColor(t.iconStyleConfig.strokeColor),e.begin(),e.moveTo(0,0),e.lineTo(298.78,0),e.lineTo(298.78,48.88),e.lineTo(0,48.88),e.lineTo(0,0),e.close(),e.fillAndStroke()}paintPentagon(t){const e=this.newBpmnCanvas(t,{width:16,height:16});e.begin(),e.moveTo(16,6.5),e.lineTo(8,0),e.lineTo(0,6.5),e.lineTo(3,16),e.lineTo(13,16),e.lineTo(16,6.5),e.lineTo(8,0),e.stroke()}}function fe(n){n.begin(),n.moveTo(.38,0),n.lineTo(.62,0),n.lineTo(.62,1),n.lineTo(.38,1),n.close()}function pn(n){n.begin(),n.moveTo(2.06,24.62),n.lineTo(10.17,30.95),n.lineTo(9.29,37.73),n.lineTo(0,41.42),n.lineTo(2.95,54.24),n.lineTo(13.41,52.92),n.lineTo(17.39,58.52),n.lineTo(13.56,67.66),n.lineTo(24.47,74.44),n.lineTo(30.81,66.33),n.lineTo(37.88,67.21),n.lineTo(41.57,76.5),n.lineTo(54.24,73.55),n.lineTo(53.06,62.94),n.lineTo(58.52,58.52),n.lineTo(67.21,63.09),n.lineTo(74.58,51.88),n.lineTo(66.03,45.25),n.lineTo(66.92,38.62),n.lineTo(76.5,34.93),n.lineTo(73.7,22.26),n.lineTo(62.64,23.44),n.lineTo(58.81,18.42),n.lineTo(62.79,8.7),n.lineTo(51.74,2.21),n.lineTo(44.81,10.47),n.lineTo(38.03,9.43),n.lineTo(33.75,0),n.lineTo(21.52,3.24),n.lineTo(22.7,13.56),n.lineTo(18.13,17.54),n.lineTo(8.7,13.56),n.close(),me(n,24.8,39)}function En(n){n.begin(),n.moveTo(16.46,41.42),n.lineTo(24.57,47.75),n.lineTo(23.69,54.53),n.lineTo(14.4,58.22),n.lineTo(17.35,71.04),n.lineTo(27.81,69.72),n.lineTo(31.79,75.32),n.lineTo(27.96,84.46),n.lineTo(38.87,91.24),n.lineTo(45.21,83.13),n.lineTo(52.28,84.01),n.lineTo(55.97,93.3),n.lineTo(68.64,90.35),n.lineTo(67.46,79.74),n.lineTo(72.92,75.32),n.lineTo(81.61,79.89),n.lineTo(88.98,68.68),n.lineTo(80.43,62.05),n.lineTo(81.32,55.42),n.lineTo(90.9,51.73),n.lineTo(88.1,39.06),n.lineTo(77.04,40.24),n.lineTo(73.21,35.22),n.lineTo(77.19,25.5),n.lineTo(66.14,19.01),n.lineTo(59.21,27.27),n.lineTo(52.43,26.23),n.lineTo(48.15,16.8),n.lineTo(35.92,20.04),n.lineTo(37.1,30.36),n.lineTo(32.53,34.34),n.lineTo(23.1,30.36),n.close();const t=39.2,e=55.8;me(n,t,e),n.begin(),me(n,t,e)}function me(n,t,e){n.moveTo(t,e),n.arcTo(13.5,13.5,0,1,1,t+2*13.5,e),n.arcTo(13.5,13.5,0,0,1,t,e),n.close(),n.fillAndStroke()}class ut{static get(){return this.instance}static set(t){this.instance=t}}g(ut,"instance",new Tn);const Ae=1.25,Sn=1/Ae;class In extends L.mxGraph{constructor(e){super(e);g(this,"currentZoomLevel",1);this.zoomFactor=Ae,this.container&&(this.container.style.cursor="default")}createGraphView(){return new Cn(this)}createCellRenderer(){return new hn(ut.get())}batchUpdate(e){this.model.beginUpdate();try{e()}finally{this.model.endUpdate()}}fit(e,s,o,i,r,l,a){const h=super.fit(e,s,o,i,r,l,a);return this.setCurrentZoomLevel(h),h}setCurrentZoomLevel(e){this.currentZoomLevel=e??this.view.scale}zoomActual(){super.zoomActual(),this.setCurrentZoomLevel()}zoomIn(){super.zoomIn(),this.setCurrentZoomLevel()}zoomOut(){super.zoomOut(),this.setCurrentZoomLevel()}customFit(e){this.zoomActual();const s=e==null?void 0:e.type;if(s==null||s==Q.None)return;const o=Wt(e==null?void 0:e.margin);if(s==Q.Center){const r=this.getGraphBounds(),l=this.container.clientWidth-o,a=this.container.clientHeight-o,h=r.width/this.view.scale,u=r.height/this.view.scale,f=Math.min(3,Math.min(l/h,a/u));this.setCurrentZoomLevel(f),this.view.scaleAndTranslate(f,(o+l-h*f)/(2*f)-r.x/this.view.scale,(o+a-u*f)/(2*f)-r.y/this.view.scale)}else{let i=!1,r=!1;switch(s){case Q.Horizontal:{r=!0;break}case Q.Vertical:{i=!0;break}}this.fit(this.border,!1,o,!0,i,r)}}registerMouseWheelZoomListeners(e){e=Ht(e),G.addMouseWheelListener(at(this.createMouseWheelZoomListener(!0),e.debounceDelay),this.container),G.addMouseWheelListener(an(this.createMouseWheelZoomListener(!1),e.throttleDelay),this.container)}manageMouseWheelZoomEvent(e,s,o){if(o){const[i,r]=this.getEventRelativeCoordinates(s),[l,a,h]=this.getScaleAndTranslationDeltas(i,r);this.view.scaleAndTranslate(l,this.view.translate.x+a,this.view.translate.y+h),G.consume(s)}else this.currentZoomLevel*=e?Ae:Sn}createMouseWheelZoomListener(e){return(s,o)=>{if(G.isConsumed(s)||!(s instanceof MouseEvent))return;s.ctrlKey&&!s.altKey&&!s.shiftKey&&!s.metaKey&&this.manageMouseWheelZoomEvent(o,s,e)}}getEventRelativeCoordinates(e){const s=this.container.getBoundingClientRect(),o=e.clientX-s.left,i=e.clientY-s.top;return[o,i]}getScaleAndTranslationDeltas(e,s){const[o,i]=this.calculateFactorAndScale(),[r,l]=this.calculateTranslationDeltas(o,i,e*2,s*2);return[i,r,l]}calculateTranslationDeltas(e,s,o,i){if(e>1){const r=(e-1)/(s*2);o*=-r,i*=-r}else{const r=(1/e-1)/(this.view.scale*2);o*=r,i*=r}return[o,i]}calculateFactorAndScale(){const e=Math.round(this.currentZoomLevel*100)/100;return[e/this.view.scale,e]}}class Cn extends L.mxGraphView{getFloatingTerminalPoint(t,e,s,o){if(t.absolutePoints.filter(Boolean).length<2)return super.getFloatingTerminalPoint(t,e,s,o);const l=t.absolutePoints;return o?l[1]:l.at(-2)}}class mn{configureMarkers(){this.registerArrowDashMarker()}registerArrowDashMarker(){const t=(e,s,o,i,r,l,a,h,u)=>{const f=r*(a+u+4),p=l*(a+u+4);return function(){e.begin(),e.moveTo(i.x-f/2-p/2,i.y-p/2+f/2),e.lineTo(i.x+p/2-3*f/2,i.y-3*p/2-f/2),e.stroke()}};L.mxMarker.addMarker(rt.ARROW_DASH,t)}}const An=[_.LOOP,_.MULTI_INSTANCE_PARALLEL,_.MULTI_INSTANCE_SEQUENTIAL,_.COMPENSATION,_.EXPAND,_.ADHOC];function vn(n){const t=An.filter(e=>n.includes(e));for(const e of n.filter(s=>!t.includes(s)))t.push(e);return t}function On(n,t){return n===1?e=>e.setIconOriginForIconBottomCentered():e=>{e.setIconOriginForIconBottomCentered();const s=Math.pow(-1,t)*(T.SHAPE_ACTIVITY_MARKER_ICON_SIZE+T.SHAPE_ACTIVITY_MARKER_ICON_MARGIN)/2;e.translateIconOrigin(s,0)}}class Re extends _e{constructor(){super(void 0,void 0,void 0);g(this,"iconPainter");g(this,"markerPainterFunctions",new Map([[_.EXPAND,e=>this.iconPainter.paintExpandIcon(e)],[_.LOOP,e=>this.iconPainter.paintLoopIcon(e)],[_.MULTI_INSTANCE_PARALLEL,e=>this.iconPainter.paintParallelMultiInstanceIcon(e)],[_.MULTI_INSTANCE_SEQUENTIAL,e=>this.iconPainter.paintSequentialMultiInstanceIcon(e)]]))}paintForeground(e,s,o,i,r){super.paintForeground(e,s,o,i,r),this.paintMarkerIcons(X({canvas:e,x:s,y:o,width:i,height:r,shape:this,ratioFromParent:0,iconStrokeWidth:1.5}))}paintMarkerIcons(e){var o;const s=v.getValue(this.style,I.MARKERS,void 0);if(s){const i=vn(s.split(","));for(const[r,l]of i.entries())e={...e,setIconOriginFunct:On(i.length,r+1)},e.canvas.save(),(o=this.markerPainterFunctions.get(l))==null||o(e),e.canvas.restore()}}paintEnvelopeIcon(e,s){this.iconPainter.paintEnvelopeIcon({...e,setIconOriginFunct:o=>o.setIconOriginToShapeTopLeft(),ratioFromParent:.2,iconStyleConfig:{...e.iconStyleConfig,isFilled:s}})}}class U extends Re{paintForeground(t,e,s,o,i){super.paintForeground(t,e,s,o,i),this.paintTaskIcon(X({canvas:t,x:e,y:s,width:o,height:i,shape:this}))}}class Ln extends U{paintTaskIcon(t){}}class Nn extends U{paintTaskIcon(t){this.iconPainter.paintGearIcon({...t,setIconOriginFunct:e=>e.setIconOriginToShapeTopLeftProportionally(20)})}}class _n extends U{paintTaskIcon(t){this.iconPainter.paintPersonIcon({...t,setIconOriginFunct:e=>e.setIconOriginToShapeTopLeftProportionally(20)})}}class yn extends U{paintTaskIcon(t){if(!lt(this.style)){this.paintEnvelopeIcon(t,!1);return}const e=4,s=4,o={...t.shapeConfig,width:20,height:20};this.iconPainter.paintCircleIcon({canvas:t.canvas,shapeConfig:o,iconStyleConfig:{...t.iconStyleConfig,isFilled:!1},ratioFromParent:void 0,setIconOriginFunct:i=>i.setIconOriginToShapeTopLeft(s,e)}),o.x+=e,o.y+=s,this.iconPainter.paintEnvelopeIcon({...t,shapeConfig:o,ratioFromParent:.65,setIconOriginFunct:i=>i.setIconOriginForIconCentered()})}}class wn extends U{paintTaskIcon(t){this.paintEnvelopeIcon(t,!0)}}class Rn extends U{paintTaskIcon(t){this.iconPainter.paintHandIcon({...t,ratioFromParent:.18,setIconOriginFunct:e=>e.setIconOriginToShapeTopLeftProportionally(20)})}}class bn extends U{paintTaskIcon(t){this.iconPainter.paintScriptIcon({...t,ratioFromParent:.22,setIconOriginFunct:e=>e.setIconOriginToShapeTopLeftProportionally(20)})}}class Fn extends Re{paintForeground(t,e,s,o,i){super.paintForeground(t,e,s,o,i);const r=X({canvas:t,x:e,y:s,width:o,height:i,shape:this});switch(v.getValue(this.style,I.GLOBAL_TASK_KIND,void 0)){case d.GLOBAL_TASK_MANUAL:{this.iconPainter.paintHandIcon({...r,ratioFromParent:.18,setIconOriginFunct:l=>l.setIconOriginToShapeTopLeftProportionally(20)});break}case d.GLOBAL_TASK_SCRIPT:{this.iconPainter.paintScriptIcon({...r,ratioFromParent:.22,setIconOriginFunct:l=>l.setIconOriginToShapeTopLeftProportionally(20)});break}case d.GLOBAL_TASK_USER:{this.iconPainter.paintPersonIcon({...r,setIconOriginFunct:l=>l.setIconOriginToShapeTopLeftProportionally(20)});break}case d.GLOBAL_TASK_BUSINESS_RULE:{this.iconPainter.paintTableIcon({...r,ratioFromParent:.6,setIconOriginFunct:l=>l.setIconOriginToShapeTopLeftProportionally(15)});break}}}}class Pn extends Re{paintBackground(t,e,s,o,i){const r=v.getValue(this.style,I.SUB_PROCESS_KIND,void 0);if(t.save(),r===Y.EVENT&&(t.setDashed(!0,!1),t.setDashPattern("1 2")),super.paintBackground(t,e,s,o,i),r===Y.TRANSACTION){const l=T.SUB_PROCESS_TRANSACTION_INNER_RECT_OFFSET,a=T.SUB_PROCESS_TRANSACTION_INNER_RECT_ARC_SIZE;t.roundrect(e+l,s+l,o-2*l,i-2*l,a,a),t.stroke()}t.restore()}}class kn extends U{paintTaskIcon(t){this.iconPainter.paintTableIcon({...t,ratioFromParent:.6,setIconOriginFunct:e=>e.setIconOriginToShapeTopLeftProportionally(15)})}}class Bn extends L.mxConnector{paintEdgeShape(t,e){const s=this.createMarker(t,e,!0),o=this.createMarker(t,e,!1);this.paintEdgeLine(t,e),t.setShadow(!1),t.setDashed(!1,!1),s!=null&&(t.setFillColor(v.getValue(this.style,I.EDGE_START_FILL_COLOR,this.stroke)),s()),o!=null&&(t.setFillColor(v.getValue(this.style,I.EDGE_END_FILL_COLOR,this.stroke)),o())}paintEdgeLine(t,e){const s=Mn(t);We(t,"stroke"),this.paintLine(t,e,this.isRounded),We(t,s)}}function Mn(n){return n instanceof ye?n.pointerEventsValue:null}function We(n,t){n instanceof ye&&(n.pointerEventsValue=t)}class be extends L.mxEllipse{constructor(){super(void 0,void 0,void 0);g(this,"iconPainter");g(this,"iconPainters",new Map([[y.MESSAGE,e=>this.iconPainter.paintEnvelopeIcon({...e,ratioFromParent:.5})],[y.TERMINATE,e=>this.iconPainter.paintCircleIcon({...e,ratioFromParent:.6})],[y.TIMER,e=>this.iconPainter.paintClockIcon({...e,setIconOriginFunct:s=>s.setIconOriginToShapeTopLeftProportionally(5)})],[y.SIGNAL,e=>this.iconPainter.paintTriangleIcon({...e,ratioFromParent:.55,iconStyleConfig:{...e.iconStyleConfig,strokeWidth:T.STROKE_WIDTH_THIN.valueOf()},setIconOriginFunct:s=>s.setIconOriginToShapeTopLeftProportionally(4)})],[y.LINK,e=>this.iconPainter.paintRightArrowIcon({...e,ratioFromParent:.55,iconStyleConfig:{...e.iconStyleConfig,strokeWidth:1.5}})],[y.ERROR,e=>this.iconPainter.paintErrorIcon({...e,ratioFromParent:.55,iconStyleConfig:{...e.iconStyleConfig,strokeWidth:1.5}})],[y.COMPENSATION,e=>this.iconPainter.paintDoubleLeftArrowheadsIcon({...e,ratioFromParent:.7,iconStyleConfig:{...e.iconStyleConfig,strokeWidth:1.5}})],[y.CANCEL,e=>this.iconPainter.paintXCrossIcon({...e,ratioFromParent:.78})],[y.ESCALATION,e=>this.iconPainter.paintUpArrowheadIcon({...e,ratioFromParent:.55,iconStyleConfig:{...e.iconStyleConfig,strokeWidth:T.STROKE_WIDTH_THIN.valueOf()}})],[y.CONDITIONAL,e=>this.iconPainter.paintListIcon({...e,ratioFromParent:.6,iconStyleConfig:{...e.iconStyleConfig,strokeWidth:1.5}})]]));g(this,"withFilledIcon",!1)}paintVertexShape(e,s,o,i,r){const l=X({canvas:e,x:s,y:o,width:i,height:r,shape:this,isFilled:this.withFilledIcon});xn(l,v.getValue(this.style,I.IS_INTERRUPTING,void 0)),this.paintOuterShape(l),Yn(l),this.paintInnerShape(l)}paintOuterShape({canvas:e,shapeConfig:{x:s,y:o,width:i,height:r}}){super.paintVertexShape(e,s,o,i,r)}paintInnerShape(e){const s=this.iconPainters.get(v.getValue(this.style,I.EVENT_DEFINITION_KIND,y.NONE));s==null||s(e)}}function xn(n,t){n.canvas.save(),t==="false"&&(n.canvas.setDashed(!0,!1),n.canvas.setDashPattern("3 2"))}function Yn(n){n.canvas.restore()}class Gn extends be{constructor(){super(),this.withFilledIcon=!0}}class ve extends be{paintOuterShape({canvas:t,shapeConfig:{x:e,y:s,width:o,height:i,strokeWidth:r}}){t.ellipse(e,s,o,i),t.fillAndStroke();const l=r*1.5;t.ellipse(o*.02+l+e,i*.02+l+s,o*.96-2*l,i*.96-2*l),t.stroke()}}class Vn extends ve{constructor(){super(),this.withFilledIcon=!0}}class Dn extends _e{constructor(){super(...arguments);g(this,"iconPainter")}paintVertexShape(e,s,o,i,r){const l=X({canvas:e,x:s,y:o,width:i,height:r,shape:this,ratioFromParent:1,isFilled:v.getValue(this.style,I.IS_INITIATING,"true")=="false"});this.iconPainter.paintEnvelopeIcon(l)}}class se extends L.mxRhombus{constructor(){super(...arguments);g(this,"iconPainter")}paintVertexShape(e,s,o,i,r){const l=X({canvas:e,x:s,y:o,width:i,height:r,shape:this});this.paintOuterShape(l),this.paintInnerShape(l)}paintOuterShape({canvas:e,shapeConfig:{x:s,y:o,width:i,height:r}}){super.paintVertexShape(e,s,o,i,r)}}class Un extends se{paintInnerShape(t){this.iconPainter.paintXCrossIcon({...t,iconStyleConfig:{...t.iconStyleConfig,isFilled:!0},ratioFromParent:.5})}}class Wn extends se{paintInnerShape(t){this.iconPainter.paintPlusCrossIcon({...t,iconStyleConfig:{...t.iconStyleConfig,isFilled:!0},ratioFromParent:.5})}}class Hn extends se{paintInnerShape(t){this.iconPainter.paintCircleIcon({...t,ratioFromParent:.62,iconStyleConfig:{...t.iconStyleConfig,isFilled:!1,strokeWidth:T.STROKE_WIDTH_THICK.valueOf()}})}}class Kn extends se{paintInnerShape(t){this.iconPainter.paintAsteriskIcon({...t,iconStyleConfig:{...t.iconStyleConfig,isFilled:!0},ratioFromParent:.5})}}class zn extends se{paintInnerShape(t){t={...t,iconStyleConfig:{...t.iconStyleConfig,strokeWidth:1}},this.iconPainter.paintCircleIcon({...t,ratioFromParent:.55}),lt(this.style)||this.iconPainter.paintCircleIcon({...t,ratioFromParent:.45});const e={...t,ratioFromParent:.3};v.getValue(this.style,I.EVENT_BASED_GATEWAY_KIND,ee.Exclusive)==ee.Parallel?this.iconPainter.paintPlusCrossIcon(e):this.iconPainter.paintPentagon(e)}}class Xn extends _e{paintForeground(t,e,s,o,i){t.begin(),t.moveTo(e+T.TEXT_ANNOTATION_BORDER_LENGTH,s),t.lineTo(e,s),t.lineTo(e,s+i),t.lineTo(e+T.TEXT_ANNOTATION_BORDER_LENGTH,s+i),t.stroke()}paintBackground(t,e,s,o,i){t.save(),t.setStrokeColor("none"),super.paintBackground(t,e,s,o,i),t.restore()}}const Zn=()=>{const n=[[d.EVENT_END,Gn],[d.EVENT_START,be],[d.EVENT_INTERMEDIATE_THROW,Vn],[d.EVENT_INTERMEDIATE_CATCH,ve],[d.EVENT_BOUNDARY,ve],[d.GATEWAY_COMPLEX,Kn],[d.GATEWAY_EVENT_BASED,zn],[d.GATEWAY_EXCLUSIVE,Un],[d.GATEWAY_INCLUSIVE,Hn],[d.GATEWAY_PARALLEL,Wn],[d.SUB_PROCESS,Pn],[d.CALL_ACTIVITY,Fn],[d.TASK,Ln],[d.TASK_SERVICE,Nn],[d.TASK_USER,_n],[d.TASK_RECEIVE,yn],[d.TASK_SEND,wn],[d.TASK_MANUAL,Rn],[d.TASK_SCRIPT,bn],[d.TASK_BUSINESS_RULE,kn],[d.TEXT_ANNOTATION,Xn],[I.EDGE,Bn],[I.MESSAGE_FLOW_ICON,Dn]];for(const[t,e]of n)Gt.registerShape(t,e)};class jn{configureShapes(){Zn()}}const dt=12;class Fe extends Map{get(t){return super.get(t)??(()=>{})}}const $n=new Fe([[k.SEQUENCE_FLOW,n=>{n[c.STYLE_ENDARROW]=c.ARROW_BLOCK_THIN}],[k.MESSAGE_FLOW,n=>{n[c.STYLE_DASHED]=!0,n[c.STYLE_DASH_PATTERN]="8 5",n[c.STYLE_STARTARROW]=c.ARROW_OVAL,n[c.STYLE_STARTSIZE]=8,n[c.STYLE_STARTFILL]=!0,n[I.EDGE_START_FILL_COLOR]=T.MESSAGE_FLOW_MARKER_START_FILL_COLOR,n[c.STYLE_ENDARROW]=c.ARROW_BLOCK_THIN,n[c.STYLE_ENDFILL]=!0,n[I.EDGE_END_FILL_COLOR]=T.MESSAGE_FLOW_MARKER_END_FILL_COLOR}],[k.ASSOCIATION_FLOW,n=>{n[c.STYLE_DASHED]=!0,n[c.STYLE_DASH_PATTERN]="1 2",n[c.STYLE_STARTSIZE]=dt}]]),qn=new Fe([[x.DEFAULT,n=>{n[c.STYLE_STARTARROW]=rt.ARROW_DASH}],[x.CONDITIONAL_FROM_ACTIVITY,n=>{n[c.STYLE_STARTARROW]=c.ARROW_DIAMOND_THIN,n[c.STYLE_STARTSIZE]=18,n[c.STYLE_STARTFILL]=!0,n[I.EDGE_START_FILL_COLOR]=T.SEQUENCE_FLOW_CONDITIONAL_FROM_ACTIVITY_MARKER_FILL_COLOR}]]),Qn=new Fe([[K.NONE,n=>{}],[K.ONE,n=>{n[c.STYLE_ENDARROW]=c.ARROW_OPEN_THIN}],[K.BOTH,n=>{n[c.STYLE_STARTARROW]=c.ARROW_OPEN_THIN,n[c.STYLE_ENDARROW]=c.ARROW_OPEN_THIN}]]);class ht{constructor(t){this.graph=t}configureStyles(){this.configureDefaultVertexStyle(),this.configurePoolStyle(),this.configureLaneStyle(),this.configureTextAnnotationStyle(),this.configureGroupStyle(),this.configureActivityStyles(),this.configureEventStyles(),this.configureGatewayStyles(),this.configureDefaultEdgeStyle(),this.configureFlowStyles()}getStylesheet(){return this.graph.getStylesheet()}putCellStyle(t,e){this.getStylesheet().putCellStyle(t,e)}configureDefaultVertexStyle(){const t=this.getStylesheet().getDefaultVertexStyle();He(t),t[c.STYLE_ABSOLUTE_ARCSIZE]=!0,t[c.STYLE_ARCSIZE]=T.SHAPE_ARC_SIZE}configurePoolStyle(){const t={};t[c.STYLE_SHAPE]=c.SHAPE_SWIMLANE,t[c.STYLE_VERTICAL_ALIGN]=c.ALIGN_MIDDLE,t[c.STYLE_ALIGN]=c.ALIGN_CENTER,t[c.STYLE_STARTSIZE]=T.POOL_LABEL_SIZE,t[c.STYLE_FILLCOLOR]=T.POOL_LABEL_FILL_COLOR,this.graph.getStylesheet().putCellStyle(d.POOL,t)}configureLaneStyle(){const t={};t[c.STYLE_SHAPE]=c.SHAPE_SWIMLANE,t[c.STYLE_VERTICAL_ALIGN]=c.ALIGN_MIDDLE,t[c.STYLE_ALIGN]=c.ALIGN_CENTER,t[c.STYLE_SWIMLANE_LINE]=0,t[c.STYLE_STARTSIZE]=T.LANE_LABEL_SIZE,t[c.STYLE_FILLCOLOR]=T.LANE_LABEL_FILL_COLOR,this.graph.getStylesheet().putCellStyle(d.LANE,t)}configureEventStyles(){for(const t of E.eventKinds()){const e={};e[c.STYLE_SHAPE]=t,e[c.STYLE_PERIMETER]=Ge.EllipsePerimeter,e[c.STYLE_STROKEWIDTH]=t==d.EVENT_END?T.STROKE_WIDTH_THICK:T.STROKE_WIDTH_THIN,e[c.STYLE_VERTICAL_LABEL_POSITION]=c.ALIGN_BOTTOM,this.putCellStyle(t,e)}}configureTextAnnotationStyle(){const t={};t[c.STYLE_SHAPE]=d.TEXT_ANNOTATION,t[c.STYLE_VERTICAL_ALIGN]=c.ALIGN_MIDDLE,t[c.STYLE_ALIGN]=c.ALIGN_LEFT,t[c.STYLE_SPACING_LEFT]=5,t[c.STYLE_FILLCOLOR]=T.TEXT_ANNOTATION_FILL_COLOR,t[c.STYLE_STROKEWIDTH]=T.STROKE_WIDTH_THIN,this.putCellStyle(d.TEXT_ANNOTATION,t)}configureGroupStyle(){const t={};t[c.STYLE_ROUNDED]=!0,t[c.STYLE_DASHED]=!0,t[c.STYLE_DASH_PATTERN]="7 4 1 4",t[c.STYLE_STROKEWIDTH]=T.STROKE_WIDTH_THIN,t[c.STYLE_FILLCOLOR]=T.GROUP_FILL_COLOR,t[c.STYLE_ALIGN]=c.ALIGN_CENTER,t[c.STYLE_VERTICAL_ALIGN]=c.ALIGN_TOP,this.putCellStyle(d.GROUP,t)}configureActivityStyles(){for(const t of E.activityKinds()){const e={};e[c.STYLE_SHAPE]=t,e[c.STYLE_ROUNDED]=!0,e[c.STYLE_VERTICAL_ALIGN]=c.ALIGN_MIDDLE,e[c.STYLE_STROKEWIDTH]=t==d.CALL_ACTIVITY?T.STROKE_WIDTH_THICK:T.STROKE_WIDTH_THIN,this.putCellStyle(t,e)}}configureGatewayStyles(){for(const t of E.gatewayKinds()){const e={};e[c.STYLE_SHAPE]=t,e[c.STYLE_PERIMETER]=Ge.RhombusPerimeter,e[c.STYLE_STROKEWIDTH]=T.STROKE_WIDTH_THIN,e[c.STYLE_VERTICAL_ALIGN]=c.ALIGN_TOP,e[c.STYLE_LABEL_POSITION]=c.ALIGN_LEFT,e[c.STYLE_VERTICAL_LABEL_POSITION]=c.ALIGN_TOP,this.putCellStyle(t,e)}}configureDefaultEdgeStyle(){const t=this.getStylesheet().getDefaultEdgeStyle();He(t),t[c.STYLE_SHAPE]=I.EDGE,t[c.STYLE_ENDSIZE]=dt,t[c.STYLE_STROKEWIDTH]=1.5,t[c.STYLE_ROUNDED]=!0,t[c.STYLE_ARCSIZE]=5,t[c.STYLE_VERTICAL_ALIGN]=c.ALIGN_BOTTOM,delete t[c.STYLE_ENDARROW]}configureEdgeStyles(t,e){for(const s of t){const o={};e.get(s)(o),this.graph.getStylesheet().putCellStyle(s.toString(),o)}}configureFlowStyles(){this.configureEdgeStyles(Object.values(k),$n),this.configureEdgeStyles(Object.values(x),qn),this.configureEdgeStyles(Object.values(K),Qn)}}function He(n){n[c.STYLE_FONTFAMILY]=T.DEFAULT_FONT_FAMILY,n[c.STYLE_FONTSIZE]=T.DEFAULT_FONT_SIZE,n[c.STYLE_FONTCOLOR]=T.DEFAULT_FONT_COLOR,n[c.STYLE_FILLCOLOR]=T.DEFAULT_FILL_COLOR,n[c.STYLE_STROKECOLOR]=T.DEFAULT_STROKE_COLOR,n[c.STYLE_LABEL_BACKGROUNDCOLOR]=c.NONE,n[c.STYLE_WHITE_SPACE]="wrap"}class Jn{constructor(t){g(this,"graph");this.graph=new In(t)}configure(t){return this.configureGraph(),this.configureNavigationSupport(t),new ht(this.graph).configureStyles(),new jn().configureShapes(),new mn().configureMarkers(),this.graph}configureGraph(){this.graph.setCellsLocked(!0),this.graph.setCellsSelectable(!1),this.graph.setEdgeLabelsMovable(!1),this.graph.setHtmlLabels(!0),this.graph.setConstrainChildren(!1),this.graph.setExtendParents(!1),this.graph.foldingEnabled=!1}configureNavigationSupport(t){var s;const e=this.graph.panningHandler;(s=t==null?void 0:t.navigation)!=null&&s.enabled?(e.addListener(G.PAN_START,Ke(this.graph,"grab")),e.addListener(G.PAN_END,Ke(this.graph,"default")),e.usePopupTrigger=!1,e.isForcePanningEvent=o=>G.isLeftMouseButton(o.getEvent())||G.isMultiTouchEvent(o.getEvent()),this.graph.setPanning(!0),this.graph.registerMouseWheelZoomListeners(t.navigation.zoom)):(this.graph.setPanning(!1),e.setPinchEnabled(!1),e.isForcePanningEvent=o=>!1)}}function Ke(n,t){return()=>{n.container.style.cursor=t}}class es{constructor(t){this.graph=t}fit(t){this.graph.customFit(t)}zoom(t){t=="in"?this.graph.zoomIn():this.graph.zoomOut()}}class ts{constructor(t){this.convertedElements=t}deserialize(t){const e=S(t.category).flatMap(s=>S(s.categoryValue));for(const s of e)this.convertedElements.registerCategoryValue(s.id,s.value)}}class Z{}class ns{constructor(t){this.options=t}warning(t){var s;if((s=this.options)!=null&&s.disableConsoleLog)return;const e=t.getMessage();console.warn(`[bv-parser] ${e.template}`,...e.arguments)}}class ss extends Z{constructor(t,e){super(),this.groupBpmnElementId=t,this.categoryValueReference=e}getMessage(){return{arguments:[this.categoryValueReference,this.groupBpmnElementId],template:"Group json deserialization: unable to find category value ref %s for bpmn element %s"}}}class os extends Z{constructor(t){super(),this.bpmnElementId=t}getMessage(){return{arguments:[this.bpmnElementId],template:"Shape json deserialization: unable to find bpmn element with id %s"}}}class is extends Z{constructor(t){super(),this.bpmnElementId=t}getMessage(){return{arguments:[this.bpmnElementId],template:"Edge json deserialization: unable to find bpmn element with id %s"}}}class rs extends Z{constructor(t,e){super(),this.shapeOrEdgeId=t,this.labelStyleId=e}getMessage(){return{arguments:[this.labelStyleId,this.shapeOrEdgeId],template:"Unable to assign font from style %s to shape/edge %s"}}}class ls extends Z{constructor(t,e){super(),this.laneId=t,this.flowNodeReference=e}getMessage(){return{arguments:[this.flowNodeReference,this.laneId],template:"Unable to assign lane %s as parent: flow node %s is not found"}}}class as extends Z{constructor(t,e,s){super(),this.bpmnElementId=t,this.attachedToReference=e,this.attachedToKind=s}getMessage(){return{arguments:[this.bpmnElementId,this.attachedToReference,this.attachedToKind],template:"The boundary event %s must be attached to an activity, and not to %s of kind %s"}}}class cs{constructor(){g(this,"poolsById",new Map);g(this,"poolsByProcessRef",new Map);g(this,"messageFlows",new Map);g(this,"flowNodes",new Map);g(this,"lanes",new Map);g(this,"sequenceFlows",new Map);g(this,"associationFlows",new Map);g(this,"eventDefinitionsOfDefinitions",new Map);g(this,"globalTasks",new Map);g(this,"categoryValues",new Map)}getFlows(){return[...this.messageFlows.values(),...this.sequenceFlows.values(),...this.associationFlows.values()]}findPoolById(t){return this.poolsById.get(t)}findPoolByProcessRef(t){return this.poolsByProcessRef.get(t)}registerPool(t,e){this.poolsById.set(t.id,t),e&&this.poolsByProcessRef.set(e,t)}findMessageFlow(t){return this.messageFlows.get(t)}registerMessageFlow(t){this.messageFlows.set(t.id,t)}findFlowNode(t){return this.flowNodes.get(t)}registerFlowNode(t){this.flowNodes.set(t.id,t)}findLane(t){return this.lanes.get(t)}registerLane(t){this.lanes.set(t.id,t)}findSequenceFlow(t){return this.sequenceFlows.get(t)}registerSequenceFlow(t){this.sequenceFlows.set(t.id,t)}findAssociationFlow(t){return this.associationFlows.get(t)}registerAssociationFlow(t){this.associationFlows.set(t.id,t)}findEventDefinitionOfDefinition(t){return this.eventDefinitionsOfDefinitions.get(t)}registerEventDefinitionsOfDefinition(t,e){this.eventDefinitionsOfDefinitions.set(t,e)}findGlobalTask(t){return this.globalTasks.get(t)}registerGlobalTask(t,e){this.globalTasks.set(t,e)}findCategoryValue(t){return this.categoryValues.get(t)}registerCategoryValue(t,e){this.categoryValues.set(t,{value:e})}}const ft=(n,t,e,s)=>{const o=n.findCategoryValue(e.categoryValueRef);if(o)return new M(e.id,o.value,d.GROUP,s);t.warning(new ss(e.id,e.categoryValueRef))},gt=(n,t)=>{for(const e of S(t)){const s=e.associationDirection;n.registerAssociationFlow(new nt(e.id,void 0,e.sourceRef,e.targetRef,s))}};class us{constructor(t,e){this.convertedElements=t,this.parsingMessageCollector=e}deserialize(t){for(const e of S(t))this.parseCollaboration(e)}parseCollaboration(t){this.buildParticipant(t.participant),this.buildMessageFlows(t.messageFlow),gt(this.convertedElements,t.association),this.buildGroups(t.group),this.buildTextAnnotation(t.textAnnotation)}buildParticipant(t){for(const e of S(t))this.convertedElements.registerPool(new M(e.id,e.name,d.POOL),e.processRef)}buildMessageFlows(t){for(const e of S(t))this.convertedElements.registerMessageFlow(new tt(e.id,e.name,e.sourceRef,e.targetRef))}buildGroups(t){for(const e of S(t)){const s=ft(this.convertedElements,this.parsingMessageCollector,e);s&&this.convertedElements.registerFlowNode(s)}}buildTextAnnotation(t){for(const e of S(t))this.convertedElements.registerFlowNode(new M(e.id,e.text,d.TEXT_ANNOTATION))}}class ds{constructor(t,e,s,o){this.x=t,this.y=e,this.width=s,this.height=o}}class hs{constructor(t,e,s,o,i=te.NONE){g(this,"extensions",{});this.id=t,this.bpmnElement=e,this.waypoints=s,this.label=o,this.messageVisibleKind=i}}class fs{constructor(t,e){this.x=t,this.y=e}}class gs{constructor(t,e){g(this,"extensions",{});this.font=t,this.bounds=e}}class Ts{constructor(t,e,s,o,i,r){this.name=t,this.size=e,this.isBold=s,this.isItalic=o,this.isUnderline=i,this.isStrikeThrough=r}}class ps{constructor(t,e){g(this,"convertedFonts",new Map);this.convertedElements=t,this.parsingMessageCollector=e}deserialize(t){const e=[],s=[],o=[],i=[],r=S(t)[0];if(r){this.deserializeFonts(r.BPMNLabelStyle);const l=r.BPMNPlane,a=this.deserializeEdges(l.BPMNEdge),h=this.deserializeShapes(l.BPMNShape);e.push(...h.flowNodes),s.push(...h.lanes),o.push(...h.pools),i.push(...a)}return{flowNodes:e,lanes:s,pools:o,edges:i}}deserializeFonts(t){for(const e of S(t))for(const s of S(e.Font))this.convertedFonts.set(e.id,new Ts(s.name,s.size,s.isBold,s.isItalic,s.isUnderline,s.isStrikeThrough))}deserializeShapes(t){const e={flowNodes:[],lanes:[],pools:[]};for(const s of S(t))this.deserializeShapeAndStoreIfFound(s,e.flowNodes,o=>this.convertedElements.findFlowNode(o))||this.deserializeShapeAndStoreIfFound(s,e.lanes,o=>this.convertedElements.findLane(o))||this.deserializeShapeAndStoreIfFound(s,e.pools,o=>this.convertedElements.findPoolById(o))||this.parsingMessageCollector.warning(new os(s.bpmnElement));return e}deserializeShapeAndStoreIfFound(t,e,s){const o=this.deserializeShape(t,s);return o?(e.push(o),!0):!1}deserializeShape(t,e){const s=e(t.bpmnElement);if(s){const o=ze(t);(s instanceof ne||s instanceof H&&s.callActivityKind===J.CALLING_PROCESS)&&!t.isExpanded&&s.markers.push(_.EXPAND);let i;E.isPoolOrLane(s.kind)&&(i=t.isHorizontal??!0);const r=t.BPMNLabel,l=this.deserializeLabel(r,t.id),a=new re(t.id,s,o,l,i);return Es(a,t),a}}deserializeEdges(t){return S(t).map(e=>{const s=this.convertedElements.findSequenceFlow(e.bpmnElement)||this.convertedElements.findMessageFlow(e.bpmnElement)||this.convertedElements.findAssociationFlow(e.bpmnElement);if(!s){this.parsingMessageCollector.warning(new is(e.bpmnElement));return}const o=this.deserializeWaypoints(e.waypoint),i=this.deserializeLabel(e.BPMNLabel,e.id),r=e.messageVisibleKind?e.messageVisibleKind:te.NONE,l=new hs(e.id,s,o,i,r);return Ss(l,e),l}).filter(Boolean)}deserializeWaypoints(t){return S(t).map(e=>new fs(e.x,e.y))}deserializeLabel(t,e){if(t&&typeof t=="object"){const s=this.findFont(t.labelStyle,e),o=ze(t),i=new gs(s,o);if("color"in t)return i.extensions.color=t.color,i;if(s||o)return i}}findFont(t,e){let s;return t&&(s=this.convertedFonts.get(t),s||this.parsingMessageCollector.warning(new rs(e,t))),s}}function Es(n,t){"background-color"in t?n.extensions.fillColor=t["background-color"]:"fill"in t&&(n.extensions.fillColor=t.fill),"border-color"in t?n.extensions.strokeColor=t["border-color"]:"stroke"in t&&(n.extensions.strokeColor=t.stroke)}function ze(n){const t=n.Bounds;if(t)return new ds(t.x,t.y,t.width,t.height)}function Ss(n,t){"border-color"in t?n.extensions.strokeColor=t["border-color"]:"stroke"in t&&(n.extensions.strokeColor=t.stroke)}const Is=n=>"source"in n||"target"in n;class Cs{constructor(t){this.convertedElements=t}deserialize(t){for(const e of Je){const s=t[e+"EventDefinition"];for(const o of S(s,!0))this.convertedElements.registerEventDefinitionsOfDefinition(o.id,{id:o.id,kind:e,...Is(o)?{source:o.source,target:o.target}:{}})}}}class ms{constructor(t){this.convertedElements=t}deserialize(t){this.parseGlobalTasks(t.globalTask,d.GLOBAL_TASK),this.parseGlobalTasks(t.globalBusinessRuleTask,d.GLOBAL_TASK_BUSINESS_RULE),this.parseGlobalTasks(t.globalManualTask,d.GLOBAL_TASK_MANUAL),this.parseGlobalTasks(t.globalScriptTask,d.GLOBAL_TASK_SCRIPT),this.parseGlobalTasks(t.globalUserTask,d.GLOBAL_TASK_USER)}parseGlobalTasks(t,e){for(const s of S(t))this.convertedElements.registerGlobalTask(s.id,e)}}const As=(n,t)=>{switch(n){case"adHocSubProcess":return Y.AD_HOC;case"transaction":return Y.TRANSACTION;default:return t.triggeredByEvent?Y.EVENT:Y.EMBEDDED}},vs=["adHocSubProcess","transaction",...E.flowNodeKinds().filter(n=>n!==d.EVENT_BOUNDARY),d.EVENT_BOUNDARY];function Os(n){return["adHocSubProcess","transaction"].includes(n)?d.SUB_PROCESS:n}class Ls{constructor(t,e){g(this,"defaultSequenceFlowIds",[]);g(this,"elementsWithoutParentByProcessId",new Map);g(this,"callActivitiesCallingProcess",new Map);g(this,"eventsByLinkEventDefinition",new Map);this.convertedElements=t,this.parsingMessageCollector=e}deserialize(t){for(const e of S(t))this.parseProcess(e);for(const e of S(t))this.assignParentOfProcessElementsCalledByCallActivity(e.id);this.assignIncomingAndOutgoingIdsFromFlows(),this.assignSourceAndTargetIdsToLinkEvents()}assignParentOfProcessElementsCalledByCallActivity(t){const e=this.callActivitiesCallingProcess.get(t);if(e){const s=this.convertedElements.findPoolByProcessRef(t);s&&(s.parentId=e.id);for(const o of this.elementsWithoutParentByProcessId.get(t))o.parentId=e.id}}assignIncomingAndOutgoingIdsFromFlows(){const t=(e,s,o)=>{const i=this.convertedElements.findFlowNode(e)??this.convertedElements.findLane(e)??this.convertedElements.findPoolById(e);i&&!i[s].includes(o)&&i[s].push(o)};for(const e of this.convertedElements.getFlows())t(e.sourceReferenceId,"outgoingIds",e.id),t(e.targetReferenceId,"incomingIds",e.id)}assignSourceAndTargetIdsToLinkEvents(){var e;const t=[...this.eventsByLinkEventDefinition.entries()].filter(([s])=>s.id);for(const[s,o]of this.eventsByLinkEventDefinition)if(o instanceof Ie){const i=t.find(([r])=>s.target===r.id);o.targetId=(e=i==null?void 0:i[1])==null?void 0:e.id}else o instanceof Se&&(o.sourceIds=t.filter(([i])=>Array.isArray(s.source)?s.source.includes(i.id):s.source===i.id).map(([,i])=>i.id))}parseProcess(t){const e=t.id,s=this.convertedElements.findPoolByProcessRef(e);s&&!s.name&&this.convertedElements.registerPool(new M(s.id,t.name,d.POOL),e),this.buildProcessInnerElements(t,s==null?void 0:s.id)}buildProcessInnerElements(t,e){this.elementsWithoutParentByProcessId.set(t.id,[]);for(const s of vs)this.buildFlowNodeBpmnElements(t[s],Os(s),e,t.id,s);this.buildLaneSetBpmnElements(t.laneSet,e,t.id),this.buildSequenceFlows(t.sequenceFlow),gt(this.convertedElements,t.association)}buildFlowNodeBpmnElements(t,e,s,o,i){for(const r of S(t)){const l=this.buildFlowNodeBpmnElement(e,r,s,i);"default"in r&&E.isWithDefaultSequenceFlow(e)&&this.defaultSequenceFlowIds.push(r.default),l&&(this.convertedElements.registerFlowNode(l),s||this.elementsWithoutParentByProcessId.get(o).push(l))}}buildFlowNodeBpmnElement(t,e,s,o){if(E.isEvent(t))return this.buildShapeBpmnEvent(e,t,s);if(E.isActivity(t))return this.buildShapeBpmnActivity(e,t,s,o);if(t==d.GATEWAY_EVENT_BASED){const i=e;return new it(i.id,i.name,s,i.instantiate,ee[i.eventGatewayType])}else{if(t==d.GROUP)return ft(this.convertedElements,this.parsingMessageCollector,e,s);{const i=t===d.TEXT_ANNOTATION?e.text:e.name;return new M(e.id,i,t,s,e.instantiate)}}}buildShapeBpmnActivity(t,e,s,o){const i=Ns(t);return E.isSubProcess(e)?this.buildShapeBpmnSubProcess(t,s,As(o,t),i):E.isCallActivity(e)?this.buildShapeBpmnCallActivity(t,s,i):new de(t.id,t.name,e,s,t.instantiate,i)}buildShapeBpmnCallActivity(t,e,s){const o=this.convertedElements.findGlobalTask(t.calledElement);if(!o){const i=new H(t.id,t.name,J.CALLING_PROCESS,e,s);return this.callActivitiesCallingProcess.set(t.calledElement,i),i}return new H(t.id,t.name,J.CALLING_GLOBAL_TASK,e,s,o)}buildShapeBpmnEvent(t,e,s){const o=this.getEventDefinitions(t),i=[...o.entries()].map(([,r])=>r.length).reduce((r,l)=>r+l,0);if(i==0&&E.canHaveNoneEvent(e))return new D(t.id,t.name,e,y.NONE,s);if(i==1){const[r,l]=[...o.entries()][0],a=E.isCatchEvent(e)?this.buildShapeBpmnCatchEvent(t,e,r,s):this.buildShapeBpmnThrowEvent(t,e,r,s);return r===y.LINK&&(l[0].id||l[0].target||l[0].source)&&this.eventsByLinkEventDefinition.set(l[0],a),a}}buildShapeBpmnCatchEvent(t,e,s,o){return E.isBoundaryEvent(e)?this.buildShapeBpmnBoundaryEvent(t,s):E.isStartEvent(e)?new st(t.id,t.name,s,o,t.isInterrupting):new Se(t.id,t.name,s,o)}buildShapeBpmnThrowEvent(t,e,s,o){return E.isIntermediateThrowEvent(e)?new Ie(t.id,t.name,s,o):new D(t.id,t.name,e,s,o)}buildShapeBpmnBoundaryEvent(t,e){const s=this.convertedElements.findFlowNode(t.attachedToRef);if(E.isActivity(s==null?void 0:s.kind))return new ot(t.id,t.name,e,t.attachedToRef,t.cancelActivity);this.parsingMessageCollector.warning(new as(t.id,t.attachedToRef,s==null?void 0:s.kind))}getEventDefinitions(t){const e=new Map;for(const s of Je){const o=t[`${s}EventDefinition`];e.set(s,S(o,!0))}for(const s of S(t.eventDefinitionRef)){const o=this.convertedElements.findEventDefinitionOfDefinition(s);o&&e.get(o.kind).push(o)}for(const[s]of[...e.entries()].filter(([,o])=>o.length===0))e.delete(s);return e}buildShapeBpmnSubProcess(t,e,s,o){const i=new ne(t.id,t.name,s,e,o);return this.buildProcessInnerElements(t,t.id),i}buildLaneSetBpmnElements(t,e,s){for(const o of S(t))this.buildLaneBpmnElements(o.lane,e,s)}buildLaneBpmnElements(t,e,s){var o;for(const i of S(t)){const r=new M(i.id,i.name,d.LANE,e);this.convertedElements.registerLane(r),e||this.elementsWithoutParentByProcessId.get(s).push(r),this.assignParentOfLaneFlowNodes(i),(o=i.childLaneSet)!=null&&o.lane&&this.buildLaneBpmnElements(i.childLaneSet.lane,i.id,s)}}assignParentOfLaneFlowNodes(t){for(const e of S(t.flowNodeRef)){const s=this.convertedElements.findFlowNode(e),o=t.id;s?E.isBoundaryEvent(s.kind)||(s.parentId=o):this.parsingMessageCollector.warning(new ls(o,e))}}buildSequenceFlows(t){for(const e of S(t)){const s=this.getSequenceFlowKind(e);this.convertedElements.registerSequenceFlow(new et(e.id,e.name,e.sourceRef,e.targetRef,s))}}getSequenceFlowKind(t){if(this.defaultSequenceFlowIds.includes(t.id))return x.DEFAULT;{const e=this.convertedElements.findFlowNode(t.sourceRef);if(e&&E.isWithDefaultSequenceFlow(e.kind)&&t.conditionExpression)return E.isActivity(e.kind)?x.CONDITIONAL_FROM_ACTIVITY:x.CONDITIONAL_FROM_GATEWAY}return x.NORMAL}}const Ns=n=>{const t=[],e=n.standardLoopCharacteristics,s=S(n.multiInstanceLoopCharacteristics,!0)[0];return e!==void 0?t.push(_.LOOP):s&&t.push(s.isSequential?_.MULTI_INSTANCE_SEQUENTIAL:_.MULTI_INSTANCE_PARALLEL),t};class _s{constructor(t,e,s,o,i,r){this.categoryConverter=t,this.collaborationConverter=e,this.eventDefinitionConverter=s,this.globalTaskConverter=o,this.processConverter=i,this.diagramConverter=r}parse(t){const e=t.definitions;return this.categoryConverter.deserialize(e),this.collaborationConverter.deserialize(e.collaboration),this.eventDefinitionConverter.deserialize(e),this.globalTaskConverter.deserialize(e),this.processConverter.deserialize(e.process),this.diagramConverter.deserialize(e.BPMNDiagram)}}function ys(n){const t=new cs;return new _s(new ts(t),new us(t,n),new Cs(t),new ms(t),new Ls(t,n),new ps(t,n))}const Tt=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",ws=Tt+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",Rs="["+Tt+"]["+ws+"]*",bs=new RegExp("^"+Rs+"$");function pt(n,t){const e=[];let s=t.exec(n);for(;s;){const o=[];o.startIndex=t.lastIndex-s[0].length;const i=s.length;for(let r=0;r<i;r++)o.push(s[r]);e.push(o),s=t.exec(n)}return e}const Pe=function(n){const t=bs.exec(n);return!(t===null||typeof t>"u")};function Fs(n){return typeof n<"u"}const Ps={allowBooleanAttributes:!1,unpairedTags:[]};function ks(n,t){t=Object.assign({},Ps,t);const e=[];let s=!1,o=!1;n[0]==="\uFEFF"&&(n=n.substr(1));for(let i=0;i<n.length;i++)if(n[i]==="<"&&n[i+1]==="?"){if(i+=2,i=Ze(n,i),i.err)return i}else if(n[i]==="<"){let r=i;if(i++,n[i]==="!"){i=je(n,i);continue}else{let l=!1;n[i]==="/"&&(l=!0,i++);let a="";for(;i<n.length&&n[i]!==">"&&n[i]!==" "&&n[i]!=="	"&&n[i]!==`
`&&n[i]!=="\r";i++)a+=n[i];if(a=a.trim(),a[a.length-1]==="/"&&(a=a.substring(0,a.length-1),i--),!Us(a)){let f;return a.trim().length===0?f="Invalid space after '<'.":f="Tag '"+a+"' is an invalid name.",N("InvalidTag",f,w(n,i))}const h=xs(n,i);if(h===!1)return N("InvalidAttr","Attributes for '"+a+"' have open quote.",w(n,i));let u=h.value;if(i=h.index,u[u.length-1]==="/"){const f=i-u.length;u=u.substring(0,u.length-1);const p=$e(u,t);if(p===!0)s=!0;else return N(p.err.code,p.err.msg,w(n,f+p.err.line))}else if(l)if(h.tagClosed){if(u.trim().length>0)return N("InvalidTag","Closing tag '"+a+"' can't have attributes or invalid starting.",w(n,r));if(e.length===0)return N("InvalidTag","Closing tag '"+a+"' has not been opened.",w(n,r));{const f=e.pop();if(a!==f.tagName){let p=w(n,f.tagStartPos);return N("InvalidTag","Expected closing tag '"+f.tagName+"' (opened in line "+p.line+", col "+p.col+") instead of closing tag '"+a+"'.",w(n,r))}e.length==0&&(o=!0)}}else return N("InvalidTag","Closing tag '"+a+"' doesn't have proper closing.",w(n,i));else{const f=$e(u,t);if(f!==!0)return N(f.err.code,f.err.msg,w(n,i-u.length+f.err.line));if(o===!0)return N("InvalidXml","Multiple possible root nodes found.",w(n,i));t.unpairedTags.indexOf(a)!==-1||e.push({tagName:a,tagStartPos:r}),s=!0}for(i++;i<n.length;i++)if(n[i]==="<")if(n[i+1]==="!"){i++,i=je(n,i);continue}else if(n[i+1]==="?"){if(i=Ze(n,++i),i.err)return i}else break;else if(n[i]==="&"){const f=Vs(n,i);if(f==-1)return N("InvalidChar","char '&' is not expected.",w(n,i));i=f}else if(o===!0&&!Xe(n[i]))return N("InvalidXml","Extra text at the end",w(n,i));n[i]==="<"&&i--}}else{if(Xe(n[i]))continue;return N("InvalidChar","char '"+n[i]+"' is not expected.",w(n,i))}if(s){if(e.length==1)return N("InvalidTag","Unclosed tag '"+e[0].tagName+"'.",w(n,e[0].tagStartPos));if(e.length>0)return N("InvalidXml","Invalid '"+JSON.stringify(e.map(i=>i.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return N("InvalidXml","Start tag expected.",1);return!0}function Xe(n){return n===" "||n==="	"||n===`
`||n==="\r"}function Ze(n,t){const e=t;for(;t<n.length;t++)if(n[t]=="?"||n[t]==" "){const s=n.substr(e,t-e);if(t>5&&s==="xml")return N("InvalidXml","XML declaration allowed only at the start of the document.",w(n,t));if(n[t]=="?"&&n[t+1]==">"){t++;break}else continue}return t}function je(n,t){if(n.length>t+5&&n[t+1]==="-"&&n[t+2]==="-"){for(t+=3;t<n.length;t++)if(n[t]==="-"&&n[t+1]==="-"&&n[t+2]===">"){t+=2;break}}else if(n.length>t+8&&n[t+1]==="D"&&n[t+2]==="O"&&n[t+3]==="C"&&n[t+4]==="T"&&n[t+5]==="Y"&&n[t+6]==="P"&&n[t+7]==="E"){let e=1;for(t+=8;t<n.length;t++)if(n[t]==="<")e++;else if(n[t]===">"&&(e--,e===0))break}else if(n.length>t+9&&n[t+1]==="["&&n[t+2]==="C"&&n[t+3]==="D"&&n[t+4]==="A"&&n[t+5]==="T"&&n[t+6]==="A"&&n[t+7]==="["){for(t+=8;t<n.length;t++)if(n[t]==="]"&&n[t+1]==="]"&&n[t+2]===">"){t+=2;break}}return t}const Bs='"',Ms="'";function xs(n,t){let e="",s="",o=!1;for(;t<n.length;t++){if(n[t]===Bs||n[t]===Ms)s===""?s=n[t]:s!==n[t]||(s="");else if(n[t]===">"&&s===""){o=!0;break}e+=n[t]}return s!==""?!1:{value:e,index:t,tagClosed:o}}const Ys=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function $e(n,t){const e=pt(n,Ys),s={};for(let o=0;o<e.length;o++){if(e[o][1].length===0)return N("InvalidAttr","Attribute '"+e[o][2]+"' has no space in starting.",$(e[o]));if(e[o][3]!==void 0&&e[o][4]===void 0)return N("InvalidAttr","Attribute '"+e[o][2]+"' is without value.",$(e[o]));if(e[o][3]===void 0&&!t.allowBooleanAttributes)return N("InvalidAttr","boolean attribute '"+e[o][2]+"' is not allowed.",$(e[o]));const i=e[o][2];if(!Ds(i))return N("InvalidAttr","Attribute '"+i+"' is an invalid name.",$(e[o]));if(!s.hasOwnProperty(i))s[i]=1;else return N("InvalidAttr","Attribute '"+i+"' is repeated.",$(e[o]))}return!0}function Gs(n,t){let e=/\d/;for(n[t]==="x"&&(t++,e=/[\da-fA-F]/);t<n.length;t++){if(n[t]===";")return t;if(!n[t].match(e))break}return-1}function Vs(n,t){if(t++,n[t]===";")return-1;if(n[t]==="#")return t++,Gs(n,t);let e=0;for(;t<n.length;t++,e++)if(!(n[t].match(/\w/)&&e<20)){if(n[t]===";")break;return-1}return t}function N(n,t,e){return{err:{code:n,msg:t,line:e.line||e,col:e.col}}}function Ds(n){return Pe(n)}function Us(n){return Pe(n)}function w(n,t){const e=n.substring(0,t).split(/\r?\n/);return{line:e.length,col:e[e.length-1].length+1}}function $(n){return n.startIndex+n[1].length}const Ws={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(n,t){return t},attributeValueProcessor:function(n,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(n,t,e){return n}},Hs=function(n){return Object.assign({},Ws,n)};class q{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,e){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:e})}addChild(t){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}}function Ks(n,t){const e={};if(n[t+3]==="O"&&n[t+4]==="C"&&n[t+5]==="T"&&n[t+6]==="Y"&&n[t+7]==="P"&&n[t+8]==="E"){t=t+9;let s=1,o=!1,i=!1,r="";for(;t<n.length;t++)if(n[t]==="<"&&!i){if(o&&Zs(n,t)){t+=7;let l,a;[l,a,t]=zs(n,t+1),a.indexOf("&")===-1&&(e[Qs(l)]={regx:RegExp(`&${l};`,"g"),val:a})}else if(o&&js(n,t))t+=8;else if(o&&$s(n,t))t+=8;else if(o&&qs(n,t))t+=9;else if(Xs)i=!0;else throw new Error("Invalid DOCTYPE");s++,r=""}else if(n[t]===">"){if(i?n[t-1]==="-"&&n[t-2]==="-"&&(i=!1,s--):s--,s===0)break}else n[t]==="["?o=!0:r+=n[t];if(s!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:e,i:t}}function zs(n,t){let e="";for(;t<n.length&&n[t]!=="'"&&n[t]!=='"';t++)e+=n[t];if(e=e.trim(),e.indexOf(" ")!==-1)throw new Error("External entites are not supported");const s=n[t++];let o="";for(;t<n.length&&n[t]!==s;t++)o+=n[t];return[e,o,t]}function Xs(n,t){return n[t+1]==="!"&&n[t+2]==="-"&&n[t+3]==="-"}function Zs(n,t){return n[t+1]==="!"&&n[t+2]==="E"&&n[t+3]==="N"&&n[t+4]==="T"&&n[t+5]==="I"&&n[t+6]==="T"&&n[t+7]==="Y"}function js(n,t){return n[t+1]==="!"&&n[t+2]==="E"&&n[t+3]==="L"&&n[t+4]==="E"&&n[t+5]==="M"&&n[t+6]==="E"&&n[t+7]==="N"&&n[t+8]==="T"}function $s(n,t){return n[t+1]==="!"&&n[t+2]==="A"&&n[t+3]==="T"&&n[t+4]==="T"&&n[t+5]==="L"&&n[t+6]==="I"&&n[t+7]==="S"&&n[t+8]==="T"}function qs(n,t){return n[t+1]==="!"&&n[t+2]==="N"&&n[t+3]==="O"&&n[t+4]==="T"&&n[t+5]==="A"&&n[t+6]==="T"&&n[t+7]==="I"&&n[t+8]==="O"&&n[t+9]==="N"}function Qs(n){if(Pe(n))return n;throw new Error(`Invalid entity name ${n}`)}const Js=/^[-+]?0x[a-fA-F0-9]+$/,eo=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,to={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function no(n,t={}){if(t=Object.assign({},to,t),!n||typeof n!="string")return n;let e=n.trim();if(t.skipLike!==void 0&&t.skipLike.test(e))return n;if(n==="0")return 0;if(t.hex&&Js.test(e))return oo(e,16);if(e.search(/[eE]/)!==-1){const s=e.match(/^([-\+])?(0*)([0-9]*(\.[0-9]*)?[eE][-\+]?[0-9]+)$/);if(s){if(t.leadingZeros)e=(s[1]||"")+s[3];else if(!(s[2]==="0"&&s[3][0]==="."))return n;return t.eNotation?Number(e):n}else return n}else{const s=eo.exec(e);if(s){const o=s[1],i=s[2];let r=so(s[3]);if(!t.leadingZeros&&i.length>0&&o&&e[2]!==".")return n;if(!t.leadingZeros&&i.length>0&&!o&&e[1]!==".")return n;if(t.leadingZeros&&i===n)return 0;{const l=Number(e),a=""+l;return a.search(/[eE]/)!==-1?t.eNotation?l:n:e.indexOf(".")!==-1?a==="0"&&r===""||a===r||o&&a==="-"+r?l:n:i?r===a||o+r===a?l:n:e===a||e===o+a?l:n}}else return n}}function so(n){return n&&n.indexOf(".")!==-1&&(n=n.replace(/0+$/,""),n==="."?n="0":n[0]==="."?n="0"+n:n[n.length-1]==="."&&(n=n.substr(0,n.length-1))),n}function oo(n,t){if(parseInt)return parseInt(n,t);if(Number.parseInt)return Number.parseInt(n,t);if(window&&window.parseInt)return window.parseInt(n,t);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}function io(n){return typeof n=="function"?n:Array.isArray(n)?t=>{for(const e of n)if(typeof e=="string"&&t===e||e instanceof RegExp&&e.test(t))return!0}:()=>!1}class ro{constructor(t){this.options=t,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(e,s)=>String.fromCharCode(Number.parseInt(s,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(e,s)=>String.fromCharCode(Number.parseInt(s,16))}},this.addExternalEntities=lo,this.parseXml=fo,this.parseTextData=ao,this.resolveNameSpace=co,this.buildAttributesMap=ho,this.isItStopNode=Eo,this.replaceEntitiesValue=To,this.readStopNodeData=Io,this.saveTextToParentTag=po,this.addChild=go,this.ignoreAttributesFn=io(this.options.ignoreAttributes)}}function lo(n){const t=Object.keys(n);for(let e=0;e<t.length;e++){const s=t[e];this.lastEntities[s]={regex:new RegExp("&"+s+";","g"),val:n[s]}}}function ao(n,t,e,s,o,i,r){if(n!==void 0&&(this.options.trimValues&&!s&&(n=n.trim()),n.length>0)){r||(n=this.replaceEntitiesValue(n));const l=this.options.tagValueProcessor(t,n,e,o,i);return l==null?n:typeof l!=typeof n||l!==n?l:this.options.trimValues?Le(n,this.options.parseTagValue,this.options.numberParseOptions):n.trim()===n?Le(n,this.options.parseTagValue,this.options.numberParseOptions):n}}function co(n){if(this.options.removeNSPrefix){const t=n.split(":"),e=n.charAt(0)==="/"?"/":"";if(t[0]==="xmlns")return"";t.length===2&&(n=e+t[1])}return n}const uo=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function ho(n,t,e){if(this.options.ignoreAttributes!==!0&&typeof n=="string"){const s=pt(n,uo),o=s.length,i={};for(let r=0;r<o;r++){const l=this.resolveNameSpace(s[r][1]);if(this.ignoreAttributesFn(l,t))continue;let a=s[r][4],h=this.options.attributeNamePrefix+l;if(l.length)if(this.options.transformAttributeName&&(h=this.options.transformAttributeName(h)),h==="__proto__"&&(h="#__proto__"),a!==void 0){this.options.trimValues&&(a=a.trim()),a=this.replaceEntitiesValue(a);const u=this.options.attributeValueProcessor(l,a,t);u==null?i[h]=a:typeof u!=typeof a||u!==a?i[h]=u:i[h]=Le(a,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(i[h]=!0)}if(!Object.keys(i).length)return;if(this.options.attributesGroupName){const r={};return r[this.options.attributesGroupName]=i,r}return i}}const fo=function(n){n=n.replace(/\r\n?/g,`
`);const t=new q("!xml");let e=t,s="",o="";for(let i=0;i<n.length;i++)if(n[i]==="<")if(n[i+1]==="/"){const l=W(n,">",i,"Closing Tag is not closed.");let a=n.substring(i+2,l).trim();if(this.options.removeNSPrefix){const f=a.indexOf(":");f!==-1&&(a=a.substr(f+1))}this.options.transformTagName&&(a=this.options.transformTagName(a)),e&&(s=this.saveTextToParentTag(s,e,o));const h=o.substring(o.lastIndexOf(".")+1);if(a&&this.options.unpairedTags.indexOf(a)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${a}>`);let u=0;h&&this.options.unpairedTags.indexOf(h)!==-1?(u=o.lastIndexOf(".",o.lastIndexOf(".")-1),this.tagsNodeStack.pop()):u=o.lastIndexOf("."),o=o.substring(0,u),e=this.tagsNodeStack.pop(),s="",i=l}else if(n[i+1]==="?"){let l=Oe(n,i,!1,"?>");if(!l)throw new Error("Pi Tag is not closed.");if(s=this.saveTextToParentTag(s,e,o),!(this.options.ignoreDeclaration&&l.tagName==="?xml"||this.options.ignorePiTags)){const a=new q(l.tagName);a.add(this.options.textNodeName,""),l.tagName!==l.tagExp&&l.attrExpPresent&&(a[":@"]=this.buildAttributesMap(l.tagExp,o,l.tagName)),this.addChild(e,a,o)}i=l.closeIndex+1}else if(n.substr(i+1,3)==="!--"){const l=W(n,"-->",i+4,"Comment is not closed.");if(this.options.commentPropName){const a=n.substring(i+4,l-2);s=this.saveTextToParentTag(s,e,o),e.add(this.options.commentPropName,[{[this.options.textNodeName]:a}])}i=l}else if(n.substr(i+1,2)==="!D"){const l=Ks(n,i);this.docTypeEntities=l.entities,i=l.i}else if(n.substr(i+1,2)==="!["){const l=W(n,"]]>",i,"CDATA is not closed.")-2,a=n.substring(i+9,l);s=this.saveTextToParentTag(s,e,o);let h=this.parseTextData(a,e.tagname,o,!0,!1,!0,!0);h==null&&(h=""),this.options.cdataPropName?e.add(this.options.cdataPropName,[{[this.options.textNodeName]:a}]):e.add(this.options.textNodeName,h),i=l+2}else{let l=Oe(n,i,this.options.removeNSPrefix),a=l.tagName;const h=l.rawTagName;let u=l.tagExp,f=l.attrExpPresent,p=l.closeIndex;this.options.transformTagName&&(a=this.options.transformTagName(a)),e&&s&&e.tagname!=="!xml"&&(s=this.saveTextToParentTag(s,e,o,!1));const m=e;if(m&&this.options.unpairedTags.indexOf(m.tagname)!==-1&&(e=this.tagsNodeStack.pop(),o=o.substring(0,o.lastIndexOf("."))),a!==t.tagname&&(o+=o?"."+a:a),this.isItStopNode(this.options.stopNodes,o,a)){let C="";if(u.length>0&&u.lastIndexOf("/")===u.length-1)a[a.length-1]==="/"?(a=a.substr(0,a.length-1),o=o.substr(0,o.length-1),u=a):u=u.substr(0,u.length-1),i=l.closeIndex;else if(this.options.unpairedTags.indexOf(a)!==-1)i=l.closeIndex;else{const j=this.readStopNodeData(n,h,p+1);if(!j)throw new Error(`Unexpected end of ${h}`);i=j.i,C=j.tagContent}const b=new q(a);a!==u&&f&&(b[":@"]=this.buildAttributesMap(u,o,a)),C&&(C=this.parseTextData(C,a,o,!0,f,!0,!0)),o=o.substr(0,o.lastIndexOf(".")),b.add(this.options.textNodeName,C),this.addChild(e,b,o)}else{if(u.length>0&&u.lastIndexOf("/")===u.length-1){a[a.length-1]==="/"?(a=a.substr(0,a.length-1),o=o.substr(0,o.length-1),u=a):u=u.substr(0,u.length-1),this.options.transformTagName&&(a=this.options.transformTagName(a));const C=new q(a);a!==u&&f&&(C[":@"]=this.buildAttributesMap(u,o,a)),this.addChild(e,C,o),o=o.substr(0,o.lastIndexOf("."))}else{const C=new q(a);this.tagsNodeStack.push(e),a!==u&&f&&(C[":@"]=this.buildAttributesMap(u,o,a)),this.addChild(e,C,o),e=C}s="",i=p}}else s+=n[i];return t.child};function go(n,t,e){const s=this.options.updateTag(t.tagname,e,t[":@"]);s===!1||(typeof s=="string"&&(t.tagname=s),n.addChild(t))}const To=function(n){if(this.options.processEntities){for(let t in this.docTypeEntities){const e=this.docTypeEntities[t];n=n.replace(e.regx,e.val)}for(let t in this.lastEntities){const e=this.lastEntities[t];n=n.replace(e.regex,e.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const e=this.htmlEntities[t];n=n.replace(e.regex,e.val)}n=n.replace(this.ampEntity.regex,this.ampEntity.val)}return n};function po(n,t,e,s){return n&&(s===void 0&&(s=t.child.length===0),n=this.parseTextData(n,t.tagname,e,!1,t[":@"]?Object.keys(t[":@"]).length!==0:!1,s),n!==void 0&&n!==""&&t.add(this.options.textNodeName,n),n=""),n}function Eo(n,t,e){const s="*."+e;for(const o in n){const i=n[o];if(s===i||t===i)return!0}return!1}function So(n,t,e=">"){let s,o="";for(let i=t;i<n.length;i++){let r=n[i];if(s)r===s&&(s="");else if(r==='"'||r==="'")s=r;else if(r===e[0])if(e[1]){if(n[i+1]===e[1])return{data:o,index:i}}else return{data:o,index:i};else r==="	"&&(r=" ");o+=r}}function W(n,t,e,s){const o=n.indexOf(t,e);if(o===-1)throw new Error(s);return o+t.length-1}function Oe(n,t,e,s=">"){const o=So(n,t+1,s);if(!o)return;let i=o.data;const r=o.index,l=i.search(/\s/);let a=i,h=!0;l!==-1&&(a=i.substring(0,l),i=i.substring(l+1).trimStart());const u=a;if(e){const f=a.indexOf(":");f!==-1&&(a=a.substr(f+1),h=a!==o.data.substr(f+1))}return{tagName:a,tagExp:i,closeIndex:r,attrExpPresent:h,rawTagName:u}}function Io(n,t,e){const s=e;let o=1;for(;e<n.length;e++)if(n[e]==="<")if(n[e+1]==="/"){const i=W(n,">",e,`${t} is not closed`);if(n.substring(e+2,i).trim()===t&&(o--,o===0))return{tagContent:n.substring(s,e),i};e=i}else if(n[e+1]==="?")e=W(n,"?>",e+1,"StopNode is not closed.");else if(n.substr(e+1,3)==="!--")e=W(n,"-->",e+3,"StopNode is not closed.");else if(n.substr(e+1,2)==="![")e=W(n,"]]>",e,"StopNode is not closed.")-2;else{const i=Oe(n,e,">");i&&((i&&i.tagName)===t&&i.tagExp[i.tagExp.length-1]!=="/"&&o++,e=i.closeIndex)}}function Le(n,t,e){if(t&&typeof n=="string"){const s=n.trim();return s==="true"?!0:s==="false"?!1:no(n,e)}else return Fs(n)?n:""}function Co(n,t){return Et(n,t)}function Et(n,t,e){let s;const o={};for(let i=0;i<n.length;i++){const r=n[i],l=mo(r);let a="";if(e===void 0?a=l:a=e+"."+l,l===t.textNodeName)s===void 0?s=r[l]:s+=""+r[l];else{if(l===void 0)continue;if(r[l]){let h=Et(r[l],t,a);const u=vo(h,t);r[":@"]?Ao(h,r[":@"],a,t):Object.keys(h).length===1&&h[t.textNodeName]!==void 0&&!t.alwaysCreateTextNode?h=h[t.textNodeName]:Object.keys(h).length===0&&(t.alwaysCreateTextNode?h[t.textNodeName]="":h=""),o[l]!==void 0&&o.hasOwnProperty(l)?(Array.isArray(o[l])||(o[l]=[o[l]]),o[l].push(h)):t.isArray(l,a,u)?o[l]=[h]:o[l]=h}}}return typeof s=="string"?s.length>0&&(o[t.textNodeName]=s):s!==void 0&&(o[t.textNodeName]=s),o}function mo(n){const t=Object.keys(n);for(let e=0;e<t.length;e++){const s=t[e];if(s!==":@")return s}}function Ao(n,t,e,s){if(t){const o=Object.keys(t),i=o.length;for(let r=0;r<i;r++){const l=o[r];s.isArray(l,e+"."+l,!0,!0)?n[l]=[t[l]]:n[l]=t[l]}}}function vo(n,t){const{textNodeName:e}=t,s=Object.keys(n).length;return!!(s===0||s===1&&(n[e]||typeof n[e]=="boolean"||n[e]===0))}class Oo{constructor(t){this.externalEntities={},this.options=Hs(t)}parse(t,e){if(typeof t!="string")if(t.toString)t=t.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(e){e===!0&&(e={});const i=ks(t,e);if(i!==!0)throw Error(`${i.err.msg}:${i.err.line}:${i.err.col}`)}const s=new ro(this.options);s.addExternalEntities(this.externalEntities);const o=s.parseXml(t);return this.options.preserveOrder||o===void 0?o:Co(o,this.options)}addEntity(t,e){if(e.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(t.indexOf("&")!==-1||t.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(e==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[t]=e}}const Lo=[{regex:/&(amp|#38|#x26);/g,val:"&"},{regex:/&(apos|#39|#x27);/g,val:"'"},{regex:/&#(xa|xA|10);/g,val:`
`},{regex:/&(gt|#62|#x3e|#x3E);/g,val:">"},{regex:/&(lt|#60|#x3c|#x3C);/g,val:"<"},{regex:/&(quot|#34|#x22);/g,val:'"'}],No=new Set(["BPMNShape.Bounds","BPMNShape.BPMNLabel.Bounds","BPMNEdge.BPMNLabel.Bounds","BPMNEdge.waypoint"].map(n=>`definitions.BPMNDiagram.BPMNPlane.${n}`)),_o=new Set(["x","y","width","height"]),yo=(n,t)=>No.has(t)&&_o.has(n);class wo{constructor(t){g(this,"x2jOptions",{attributeNamePrefix:"",removeNSPrefix:!0,ignoreAttributes:!1,parseAttributeValue:!0,processEntities:!1,attributeValueProcessor:(t,e,s)=>yo(t,s)?Number(e):this.processAttribute(e)});g(this,"xmlParser",new Oo(this.x2jOptions));this.options=t}parse(t){let e;try{e=this.xmlParser.parse(t)}catch{throw new Error("XML parsing failed. Invalid BPMN source.")}if(!e.definitions)throw new Error("XML parsing failed. Unable to retrieve 'definitions' from the BPMN source.");return e}processAttribute(t){var e;for(const s of Lo)t=t.replace(s.regex,s.val);return(e=this.options)!=null&&e.additionalXmlAttributeProcessor&&(t=this.options.additionalXmlAttributeProcessor(t)),t}}class Ro{constructor(t,e){this.jsonParser=t,this.xmlParser=e}parse(t){const e=this.xmlParser.parse(t);return this.jsonParser.parse(e)}}function bo(n){return new Ro(ys(new ns(n)),new wo(n))}function Fo(n){return new Po(n)}class Po{constructor(t){this.graph=t}updateAndRefreshCssClassesOfCell(t,e){this.updateAndRefreshCssClassesOfElement(t,e),this.updateAndRefreshCssClassesOfElement(we(t),e)}updateAndRefreshCssClassesOfElement(t,e){const s=this.graph.getModel(),o=s.getCell(t);if(!o)return;let i=o.getStyle();i=R(i,I.EXTRA_CSS_CLASSES,e.join(",")),s.setStyle(o,i)}}function ko(n){return new Bo(Fo(n),new Mo)}class Bo{constructor(t,e){this.cssClassesUpdater=t,this.cssClassesCache=e}clearCache(){this.cssClassesCache.clear()}addCssClasses(t,e){this.updateCssClasses(t,e,this.cssClassesCache.addClassNames)}removeCssClasses(t,e){this.updateCssClasses(t,e,this.cssClassesCache.removeClassNames)}removeAllCssClasses(t){if(t||t=="")for(const e of S(t)){const s=this.cssClassesCache.removeAllClassNames(e);this.updateCellIfChanged(s,e)}else{const e=this.cssClassesCache.getBpmnIds();this.cssClassesCache.clear();for(const s of e)this.updateCellIfChanged(!0,s)}}toggleCssClasses(t,e){this.updateCssClasses(t,e,this.cssClassesCache.toggleClassNames)}updateCssClasses(t,e,s){const o=S(e);for(const i of S(t))this.updateCellIfChanged(s(i,o),i)}updateCellIfChanged(t,e){if(t){const s=this.cssClassesCache.getClassNames(e);this.cssClassesUpdater.updateAndRefreshCssClassesOfCell(e,s)}}}class Mo{constructor(){g(this,"classNamesByBpmnId",new Map);g(this,"clear",()=>{this.classNamesByBpmnId.clear()});g(this,"addClassNames",(t,e)=>this.updateClassNames(t,e,(s,o)=>s.add(o)));g(this,"removeClassNames",(t,e)=>this.updateClassNames(t,e,(s,o)=>s.delete(o)));g(this,"toggleClassNames",(t,e)=>(this.updateClassNames(t,e,(s,o)=>s.has(o)?s.delete(o):s.add(o)),e&&e.length>0))}getClassNames(t){return this.classNamesByBpmnId.has(t)?[...this.classNamesByBpmnId.get(t)]:[]}getBpmnIds(){return[...this.classNamesByBpmnId.keys()]}removeAllClassNames(t){const e=this.getOrInitializeClassNames(t),s=e.size;return e.clear(),e.size<s}updateClassNames(t,e,s){const o=this.getOrInitializeClassNames(t),i=o.size;for(const r of S(e))s(o,r);return o.size!=i}getOrInitializeClassNames(t){let e=this.classNamesByBpmnId.get(t);return e==null&&(e=new Set,this.classNamesByBpmnId.set(t,e)),e}}const xo=new Map([["start",{horizontalAlign:"left",verticalAlign:"top"}],["middle",{horizontalAlign:"center",verticalAlign:"top"}],["end",{horizontalAlign:"right",verticalAlign:"top"}],["top-left",{horizontalAlign:"left",verticalAlign:"top"}],["top-right",{horizontalAlign:"right",verticalAlign:"top"}],["top-center",{horizontalAlign:"center",verticalAlign:"top"}],["bottom-left",{horizontalAlign:"left",verticalAlign:"bottom"}],["bottom-right",{horizontalAlign:"right",verticalAlign:"bottom"}],["bottom-center",{horizontalAlign:"center",verticalAlign:"bottom"}],["middle-left",{horizontalAlign:"left",verticalAlign:"middle"}],["middle-right",{horizontalAlign:"right",verticalAlign:"middle"}]]),Yo=n=>xo.get(n.position),Go=(n,t)=>{t&&(n.fill.color=t.color??n.fill.color,n.fill.opacity=t.opacity??n.fill.opacity)},Vo=(n,t)=>{t&&(n.stroke.color=t.color??n.stroke.color,n.stroke.width=t.width??n.stroke.width)},Do=(n,t)=>{t&&(n.font.color=t.color??n.font.color,n.font.size=t.size??n.font.size)},Uo=n=>{const t={fill:{color:T.DEFAULT_OVERLAY_FILL_COLOR.valueOf(),opacity:T.DEFAULT_OVERLAY_FILL_OPACITY.valueOf()},stroke:{color:T.DEFAULT_OVERLAY_STROKE_COLOR.valueOf(),width:T.DEFAULT_OVERLAY_STROKE_WIDTH.valueOf()},font:{color:T.DEFAULT_OVERLAY_FONT_COLOR.valueOf(),size:T.DEFAULT_OVERLAY_FONT_SIZE.valueOf()}},e=n.style,s={...t};return e&&(Go(s,e.fill),Vo(s,e.stroke),Do(s,e.font)),s};class Wo{convert(t){const e=Yo(t),s=Uo(t);return{position:e,style:s}}}function Ho(n){return new Ko(n,new Wo)}class Ko{constructor(t,e){this.graph=t,this.overlayConverter=e}addOverlays(t,e){const s=this.graph.getModel().getCell(t);if(s)for(const o of S(e)){const i=new ct(o.label,this.overlayConverter.convert(o));this.graph.addCellOverlay(s,i)}}removeAllOverlays(t){const e=this.graph.getModel().getCell(t);e&&this.graph.removeCellOverlays(e)}}function zo(n){return new Xo(Ho(n))}class Xo{constructor(t){this.overlaysUpdater=t}addOverlays(t,e){this.overlaysUpdater.addOverlays(t,e)}removeAllOverlays(t){this.overlaysUpdater.removeAllOverlays(t)}}class Zo{element(t){return`svg > g > g > g[data-bpmn-id="${t}"]`}elementsOfKind(t){return`svg > g > g > g.${t}:not(.bpmn-label)`}}function jo(n){return new $o(n,new qo(n.getModel()))}const qe=n=>{const t=S(n);return t.push(...t.map(e=>we(e))),t};class $o{constructor(t,e){this.graph=t,this.styleManager=e}clear(){this.styleManager.clear()}updateStyle(t,e){if(!e)return;const s=this.graph.getModel(),o=qe(t).map(i=>s.getCell(i)).filter(Boolean);o.length!==0&&this.graph.batchUpdate(()=>{for(const i of o){this.styleManager.ensureStyleIsStored(i);let r=i.getStyle();r=R(r,c.STYLE_OPACITY,e.opacity,he),r=zt(r,e.stroke),r=Xt(r,e.font),qt(e)&&(r=$t(r,e.fill)),s.setStyle(i,r)}})}resetStyle(t){this.graph.batchUpdate(()=>{if(t||t=="")for(const e of qe(t))this.styleManager.resetStyleIfIsStored(e);else this.styleManager.resetAllStyles()})}}const Qe=I.EXTRA_CSS_CLASSES;class qo{constructor(t){g(this,"stylesCache",new Map);this.model=t}clear(){this.stylesCache.clear()}resetAllStyles(){for(const t of this.stylesCache.keys())this.resetStyle(t,this.stylesCache.get(t))}resetStyleIfIsStored(t){const e=this.stylesCache.get(t);e&&this.resetStyle(t,e)}resetStyle(t,e){const s=this.model.getCell(t),o=Zt(s.getStyle(),Qe,""),i=R(e,Qe,o);this.model.setStyle(s,i),this.stylesCache.delete(t)}ensureStyleIsStored(t){const e=t.getId();this.stylesCache.has(e)||this.stylesCache.set(e,t.getStyle())}}function Qo(n){return new Jo(jo(n))}class Jo{constructor(t){this.styleUpdater=t}clearCache(){this.styleUpdater.clear()}updateStyle(t,e){this.styleUpdater.updateStyle(t,e)}resetStyle(t){this.styleUpdater.resetStyle(t)}}function ei(n,t){return new ti(n,new ni(t.container,new Zo),ko(t),zo(t),Qo(t))}class ti{constructor(t,e,s,o,i){this.bpmnModelRegistry=t,this.htmlElementRegistry=e,this.cssClassesRegistry=s,this.overlaysRegistry=o,this.styleRegistry=i,this.bpmnModelRegistry.registerOnLoadCallback(()=>{this.cssClassesRegistry.clearCache(),this.styleRegistry.clearCache()})}getModelElementsByIds(t){return ge(t).map(e=>this.bpmnModelRegistry.getBpmnSemantic(e)).filter(Boolean)}getElementsByIds(t){return this.getModelElementsByIds(t).map(e=>({bpmnSemantic:e,htmlElement:this.htmlElementRegistry.getBpmnHtmlElement(e.id)}))}getModelElementsByKinds(t){return ge(t).flatMap(e=>this.htmlElementRegistry.getBpmnHtmlElements(e)).map(e=>this.getRelatedBpmnSemantic(e))}getElementsByKinds(t){return ge(t).flatMap(e=>this.htmlElementRegistry.getBpmnHtmlElements(e)).map(e=>({htmlElement:e,bpmnSemantic:this.getRelatedBpmnSemantic(e)}))}getRelatedBpmnSemantic(t){return this.bpmnModelRegistry.getBpmnSemantic(t.dataset.bpmnId)}addCssClasses(t,e){this.cssClassesRegistry.addCssClasses(t,e)}removeCssClasses(t,e){this.cssClassesRegistry.removeCssClasses(t,e)}removeAllCssClasses(t){this.cssClassesRegistry.removeAllCssClasses(t)}toggleCssClasses(t,e){this.cssClassesRegistry.toggleCssClasses(t,e)}addOverlays(t,e){this.overlaysRegistry.addOverlays(t,e)}removeAllOverlays(t){this.overlaysRegistry.removeAllOverlays(t)}updateStyle(t,e){this.styleRegistry.updateStyle(t,e)}resetStyle(t){this.styleRegistry.resetStyle(t)}}class ni{constructor(t,e){this.container=t,this.querySelectors=e}getBpmnHtmlElement(t){return this.container.querySelector(this.querySelectors.element(t))}getBpmnHtmlElements(t){const e=this.querySelectors.elementsOfKind(Ce(t));return[...this.container.querySelectorAll(e)]}}const ge=n=>[...new Set(S(n))];class si{filter(t,e){const s=[],o=[];for(const m of S(e==null?void 0:e.pools).filter(C=>C&&Object.keys(C).length>0))m.id?s.push(m.id):m.name&&o.push(m.name);if(s.length===0&&o.length===0)return t;const{filteredPools:i,filteredPoolIds:r}=oi(t,s,o),l=[...s,...r],{filteredLanes:a,filteredLaneIds:h,filteredFlowNodes:u,filteredFlowNodeIds:f}=St(t.lanes,t.flowNodes,l),p=ri(t.edges,[...l,...h,...f]);if(i.length===0&&a.length===0&&u.length===0&&p.length===0){let m=s.length>0?` for ids [${s}]`:"";const C=m?" and":"";throw m+=o.length>0?`${C} for names [${o}]`:"",new Error("No matching pools"+m)}return{lanes:a,flowNodes:u,pools:i,edges:p}}}function oi(n,t,e){const s=n.pools.filter(i=>t.includes(i.bpmnElement.id)||e.includes(i.bpmnElement.name)),o=s.map(i=>i.bpmnElement.id);return{filteredPools:s,filteredPoolIds:o}}function St(n,t,e){const{filteredLanes:s,filteredLaneIds:o}=It(n,e),{filteredLanes:i,filteredLaneIds:r,filteredFlowNodes:l,filteredFlowNodeIds:a}=ii(t,[...e,...o],n);return s.push(...i),o.push(...r),{filteredLanes:s,filteredLaneIds:o,filteredFlowNodes:l,filteredFlowNodeIds:a}}function It(n,t){const e=n.filter(o=>t.includes(o.bpmnElement.parentId)),s=e.map(o=>o.bpmnElement.id);if(e.length>0){const{filteredLanes:o,filteredLaneIds:i}=It(n,s);e.push(...o),s.push(...i)}return{filteredLanes:e,filteredLaneIds:s}}function ii(n,t,e){const s=n.filter(h=>t.includes(h.bpmnElement.parentId));if(s.length===0)return{filteredLanes:[],filteredLaneIds:[],filteredFlowNodes:[],filteredFlowNodeIds:[]};const o=s.map(h=>h.bpmnElement.id),{filteredLanes:i,filteredLaneIds:r,filteredFlowNodes:l,filteredFlowNodeIds:a}=St(e,n,o);return s.push(...l),o.push(...a),{filteredLanes:i,filteredLaneIds:r,filteredFlowNodes:s,filteredFlowNodeIds:o}}function ri(n,t){return n.filter(e=>t.includes(e.bpmnElement.sourceReferenceId)&&t.includes(e.bpmnElement.targetReferenceId))}class li{constructor(){g(this,"searchableModel");g(this,"onLoadCallback")}load(t,e){var o;const s=new si().filter(t,e);return this.searchableModel=new ci(s),(o=this.onLoadCallback)==null||o.call(this),ai(s)}registerOnLoadCallback(t){this.onLoadCallback=t}getBpmnSemantic(t){var i;const e=(i=this.searchableModel)==null?void 0:i.elementById(t);if(!e)return;const s=e.bpmnElement,o=s instanceof M;return{id:t,isShape:o,kind:s.kind,name:s.name,...s instanceof ue?{sourceRefId:s.sourceReferenceId,targetRefId:s.targetReferenceId}:{callActivityGlobalTaskKind:s instanceof H?s.globalTaskKind:void 0,callActivityKind:s instanceof H?s.callActivityKind:void 0,eventDefinitionKind:s instanceof D?s.eventDefinitionKind:void 0,linkEventSourceIds:s instanceof Se&&s.eventDefinitionKind==y.LINK?s.sourceIds:void 0,linkEventTargetId:s instanceof Ie?s.targetId:void 0,incomingIds:s.incomingIds,outgoingIds:s.outgoingIds,parentId:s.parentId,subProcessKind:s instanceof ne?s.subProcessKind:void 0}}}}function ai(n){const t=new Set(n.flowNodes.filter(i=>{const r=i.bpmnElement;return E.isSubProcess(r.kind)&&r.markers.includes(_.EXPAND)}).map(i=>i.bpmnElement.id)),e=[],s=[],o=[];for(const i of n.flowNodes){const r=i.bpmnElement.kind;E.isSubProcess(r)?e.push(i):E.isBoundaryEvent(r)?s.push(i):t.has(i.bpmnElement.parentId)||o.push(i)}return{boundaryEvents:s,edges:n.edges,lanes:n.lanes,otherFlowNodes:o,pools:n.pools,subprocesses:e}}class ci{constructor(t){g(this,"elements",new Map);for(const e of[...t.pools,...t.lanes,...t.flowNodes,...t.edges])this.elements.set(e.bpmnElement.id,e)}elementById(t){return this.elements.get(t)}}class ui{constructor(t){g(this,"graph");g(this,"navigation");g(this,"bpmnElementsRegistry");g(this,"bpmnModelRegistry");g(this,"parserOptions");g(this,"rendererOptions");this.rendererOptions=t==null?void 0:t.renderer;const e=new Jn(Pt(t==null?void 0:t.container));this.graph=e.configure(t),this.navigation=new es(this.graph),this.bpmnModelRegistry=new li,this.bpmnElementsRegistry=ei(this.bpmnModelRegistry,this.graph),this.parserOptions=t==null?void 0:t.parser}load(t,e){const s=bo(this.parserOptions).parse(t),o=this.bpmnModelRegistry.load(s,e==null?void 0:e.modelFilter);ln(this.graph,this.rendererOptions).render(o,e==null?void 0:e.fit)}}function bi(n){document.readyState==="complete"||document.readyState==="interactive"?setTimeout(n,1):document.addEventListener("DOMContentLoaded",n)}function A(n,...t){ke("[DEMO]",n,...t)}function ke(n,t,...e){console.info(`${n} ${t}`,...e)}function F(n,...t){ke("[DEMO STARTUP]",n,...t)}function Ct(n,t){mt(n),window.alert(n)}function mt(n){console.error("[DEMO]",n)}function z(n,...t){ke("[DEMO DOWNLOAD]",n,...t)}async function di(n){A(`Fetching BPMN content from url ${n}`);const t=await fetch(n);if(!t.ok)throw new Error(`HTTP status ${t.status}`);return await t.text()}function At(n,t,e){const s=document.createElement("a");t.startsWith("data:image/svg+xml")&&(e=encodeURIComponent(e),t+=","),s.setAttribute("href",t+e),s.setAttribute("download",n),s.style.display="none",document.body.append(s),s.click(),s.remove()}function hi(n){z("Start SVG download"),At("diagram.svg","data:image/svg+xml",n),z("Download completed")}function fi(n){z("Start PNG download");const t=new Blob([n],{type:"image/svg+xml;charset=utf-8"}),e=URL.createObjectURL(t),s=document.createElement("img");s.setAttribute("style","position: absolute; top: -9999px"),s.crossOrigin="anonymous",document.body.append(s);const o=document.createElement("canvas"),i=o.getContext("2d");s.addEventListener("load",function(){const r=new Image;o.width=s.naturalWidth,o.height=s.naturalHeight,r.crossOrigin="Anonymous",r.addEventListener("load",function(){i.drawImage(r,0,0),URL.revokeObjectURL(e);const l=o.toDataURL("image/png");s.remove(),At("diagram.png","",l),z("Download completed")}),r.src=s.src}),s.src=e}class gi{constructor(t,e,s,o){g(this,"document");g(this,"head");this.window=t,this.outerContainerId=e,this.containerToFade=s,this.dropCallback=o,this.document=t.document,this.head=document.head,this.initializeDragAndDrop()}initializeDragAndDrop(){this.containerToFade.classList.add("faded-container"),this.addDomElements(this.containerToFade),this.addStyle();const t=document.querySelector(`#${this.outerContainerId}`);this.preventDefaultsOnEvents(["dragover","drop"],this.window),this.preventDefaultsOnEvents(["dragover","dragleave","drop"],t),this.addEventsOnDropContainer(t,this.containerToFade),this.addEventsOnDocument(this.outerContainerId,this.containerToFade)}preventDefaults(t){t.preventDefault(),t.stopPropagation()}preventDefaultsOnEvents(t,e){for(const s of t)e.addEventListener(s,this.preventDefaults.bind(this),!1)}addDomElements(t){const e=this.document.createElement("p");e.textContent="open BPMN diagram";const s=this.document.createElement("div");s.classList.add("drop-here-text"),s.append(e);const o=this.document.createElement("div");o.id=this.outerContainerId,o.append(s),t.parentNode.prepend(o)}addStyle(){const t=`
.faded-container {
    opacity: 1;
}
.faded-container.faded {
    opacity: 0.1;
}
#${this.outerContainerId} {
    display: none;
    overflow: hidden;
    position: absolute;
    top: 10px;
    right: 10px;
    bottom: 10px;
    left: 10px;
    font-weight: bold;
    text-align: center;
    color: #555;
    padding: 10px;
}
#${this.outerContainerId}.dragging {
    display: block;
}
#${this.outerContainerId} .drop-here-text {
    border: 2px solid transparent;
    width: 100%;
    height: 100%;
    overflow: hidden;
}
#${this.outerContainerId} .drop-here-text p {
    font-style: normal;
    font-family: monospace;
    font-size: 40px;
    color: rgba(1,1,1,.2);
}
#${this.outerContainerId}.dragging .drop-here-text {
    cursor: default;
    display: flex;
    justify-content: center;
    align-items: center;
    border: 2px dashed rgba(0,0,0,.2);
    border-radius: 7px;
}`,e=document.createElement("style");e.append(document.createTextNode(t)),this.head.append(e)}addEventsOnDropContainer(t,e){t.addEventListener("dragover",this.getAddClassCallback(e,!1),!1),t.addEventListener("mousedown",this.getRemoveClassCallback(e,!1),!1),t.addEventListener("drop",this.getDropCallbackForElement(e,!1,this.dropCallback),!1)}addEventsOnDocument(t,e){this.document.addEventListener("dragover",this.getAddClassCallback(e,!0,t),!1),this.document.addEventListener("dragleave",this.getRemoveClassCallback(e,!0,t),!1),this.document.addEventListener("drop",this.getDropCallbackForElement(e,!0,this.dropCallback,t),!1)}getAddClassCallback(t,e,s){return function(){e?this.querySelector("#"+s).classList.add("dragging"):this.classList.add("dragging"),t.classList.add("faded")}}getRemoveClassCallback(t,e,s){return function(){e?this.querySelector("#"+s).classList.remove("dragging"):this.classList.remove("dragging"),t.classList.remove("faded")}}getDropCallbackForElement(t,e,s,o){return function(i){try{const l=i.dataTransfer.files;s(l[0])}catch(r){const l=r instanceof Error?r.message:String(r);Ct(l)}finally{e?this.querySelector("#"+o).classList.remove("dragging"):this.classList.remove("dragging"),t.classList.remove("faded")}}}}class vt{constructor(t){this.graph=t}exportSvg(){return this.doSvgExport(!0)}exportSvgForPng(){const t=Vt.IS_FF;return this.doSvgExport(t)}doSvgExport(t){const e=this.computeSvg({scale:1,border:25,enableForeignObjectForLabel:t});return`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
${v.getXml(e)}
`}computeSvg(t){const e=t.scale??1,s=t.border??0,o=t.crisp??!0,i=t.enableForeignObjectForLabel??!0,r=this.graph.getGraphBounds(),l=this.graph.view.scale,a=v.createXmlDocument(),h=a.createElementNS(c.NS_SVG,"svg"),u=e/l,f=Math.max(1,Math.ceil(r.width*u)+2*s),p=Math.max(1,Math.ceil(r.height*u)+2*s);h.setAttribute("version","1.1"),h.setAttribute("width",f+"px"),h.setAttribute("height",p+"px"),h.setAttribute("viewBox",(o?"-0.5 -0.5":"0 0")+" "+f+" "+p),a.append(h);const m=a.createElementNS(c.NS_SVG,"g");h.append(m);const C=this.createSvgCanvas(m);C.foEnabled=i,C.foOffset=o?-.5:0,C.textOffset=o?-.5:0,C.imageOffset=o?-.5:0,C.translate(Math.floor((s/e-r.x)/l),Math.floor((s/e-r.y)/l)),C.scale(u);const b=new L.mxImageExport;return b.includeOverlays=!0,b.drawState(this.graph.getView().getState(this.graph.model.root),C),a}createSvgCanvas(t){const e=new Ti(t);return e.pointerEvents=!0,e}}class Ti extends ye{constructor(e){super(e);g(this,"htmlConverter",document.createElement("div"))}getAlternateText(e,s,o,i,r,l,a,h,u,f,p,m,C){return this.computeTruncatedText(l,i)}plainText(e,s,o,i,r,l,a,h,u,f,p,m){r=this.computeTruncatedText(r,o),super.plainText(e,s,o,i,r,l,a,h,u,f,p,m)}computeTruncatedText(e,s){if(e==null||this.state.fontSize<=0)return"";try{this.htmlConverter.innerHTML=e,e=v.extractTextWithWhitespace(this.htmlConverter.childNodes);const o=Math.ceil(2*s/this.state.fontSize),i=[];let r=0,l=0;for(;(o==0||r<o)&&l<e.length;){const a=e.codePointAt(l);if(a==10||a==13){if(r>0)break}else i.push(e.charAt(l)),a<255&&r++;l++}i.length<e.length&&e.length-i.length>1&&(e=v.trim(i.join(""))+"...")}catch(o){console.warn("Error while computing txt label",o)}return e}}const pi=new Map([["dark",{defaultFillColor:"#334352",defaultFontColor:"white",defaultStrokeColor:"#c0ddeb",endEventFillColor:"pink",endEventStrokeColor:"FireBrick",startEventFillColor:"DarkSeaGreen",startEventStrokeColor:"DarkGreen",taskAndCallActivityFillColor:"#5c8599",laneFillColor:"#2b3742",poolFillColor:"#232b33"}],["brown",{defaultFillColor:"#ede7e1",defaultFontColor:"#414666",defaultStrokeColor:"#414666",flowColor:"#666666",catchAndThrowEventStrokeColor:"#377f87",endEventFillColor:"pink",endEventStrokeColor:"FireBrick",startEventFillColor:"DarkSeaGreen",startEventStrokeColor:"DarkGreen",taskAndCallActivityFillColor:"#dadce8",laneFillColor:"#d4c3b2",poolFillColor:"#d1b9a1"}],["light-blue",{defaultFillColor:"#ffffff",defaultFontColor:"#002395",defaultStrokeColor:"#002395",endEventFillColor:"#f9dadc",endEventStrokeColor:"#e20613",startEventFillColor:"#ffffff",startEventStrokeColor:"#05d99e",taskAndCallActivityFillColor:"rgba(132,158,253,0.1)",textAnnotationFillColor:"rgba(237,237,245,0.5)",laneFillColor:"#edeef5",poolFillColor:"#dbefff"}]]);class Ei extends ui{configureTheme(t){if(t=="default")return new ht(this.graph).configureStyles(),!0;const e=pi.get(t);if(!e)return!1;const s=this.graph.getStylesheet();for(const u of E.eventKinds()){let f,p;switch(u){case"endEvent":{f=e.endEventFillColor,p=e.endEventStrokeColor;break}case"startEvent":{f=e.startEventFillColor,p=e.startEventStrokeColor;break}case"intermediateCatchEvent":case"intermediateThrowEvent":case"boundaryEvent":{f=e.defaultFillColor,p=e.catchAndThrowEventStrokeColor??e.defaultStrokeColor;break}default:{f=e.defaultFillColor,p=e.defaultStrokeColor;break}}const m=s.styles[u];m.fillColor=f,m.strokeColor=p}for(const u of E.taskKinds()){const f=s.styles[u];f.fillColor=e.taskAndCallActivityFillColor}const o=s.styles[d.CALL_ACTIVITY];o.fillColor=e.taskAndCallActivityFillColor;const i=s.styles[d.TEXT_ANNOTATION];i.fillColor=e.textAnnotationFillColor??T.TEXT_ANNOTATION_FILL_COLOR;const r=s.styles[d.POOL];r.fillColor=e.poolFillColor,r.swimlaneFillColor=e.defaultFillColor;const l=s.styles[d.LANE];l.fillColor=e.laneFillColor;const a=s.getDefaultVertexStyle();a.fontColor=e.defaultFontColor,a.fillColor=e.defaultFillColor,a.strokeColor=e.defaultStrokeColor;const h=s.getDefaultEdgeStyle();return h.fontColor=e.defaultFontColor,h.fillColor=e.defaultFillColor,h.strokeColor=e.flowColor??e.defaultStrokeColor,!0}configureSequenceFlowColor(t){F(`Use dedicated ${t} color for sequence flows`);const s=this.graph.getStylesheet().styles[k.SEQUENCE_FLOW];s[c.STYLE_STROKECOLOR]=t,s[c.STYLE_FILLCOLOR]=t,F("Sequence flows style updated")}}let O,V={},Be,Me,ce,B;function Fi(n){A("Updating load options"),V.fit=n,A("Load options updated",V)}function Pi(){return{...V}}function ki(){return ce}function Bi(n){A("Switching theme from %s to %s",ce,n),O.configureTheme(n)?(O.graph.refresh(),A("Theme switch done"),ce=n):A("Unknown theme, do nothing")}function Ot(n,t=!0){A("Loading bpmn...");try{O.load(n,V),A("BPMN loaded with configuration",V),Ii(Me),document.dispatchEvent(new CustomEvent("diagramLoaded"))}catch(e){if(t)Be(`Cannot load the BPMN diagram: ${e instanceof Error?e.message:String(e)}`);else throw e}}function Mi(n){A("Fitting..."),O.navigation.fit(n),A("Fit done with configuration",n)}function xi(n){A(`Zooming '${n}'...`),O.navigation.zoom(n),A("Zoom done")}function Yi(n){return O.bpmnElementsRegistry.getModelElementsByKinds(n)}function Si(n){return O.bpmnElementsRegistry.getModelElementsByIds(n)}function Lt(n){const t=O.graph.model,e=t.getCell(n);return t.getParent(e)}function Gi(n){return n.map(t=>Lt(t).getId()).filter((t,e,s)=>s.indexOf(t)===e)}function Vi(n){var s;const t=Lt(n),e=Si(t.getId());return e&&((s=e[0])==null?void 0:s.kind)===d.SUB_PROCESS}function Di(n,t){return O.bpmnElementsRegistry.addCssClasses(n,t)}function Ui(n,t){return O.bpmnElementsRegistry.removeCssClasses(n,t)}function Wi(n,t){return O.bpmnElementsRegistry.addOverlays(n,[t])}function Hi(n){return O.bpmnElementsRegistry.removeAllOverlays(n)}function Ii(n){if(!Me)return;A("Updating model, bpmnElement to collapse:",n);const t=O.graph.getModel(),e=t.getCell(n);if(e){t.beginUpdate();try{t.setCollapsed(e,!0)}finally{t.endUpdate()}A("Model updated")}else A("Element not found in the model, do nothing")}function Nt(n){n.text().then(t=>{Ot(t)}).catch(t=>{throw t})}function Ki(n){const t=n.target.files;if(t&&t.length>0){const e=t[0];Nt(e)}}function Ci(n){di(n).catch(t=>{throw new Error(`Unable to fetch ${n}. ${t}`)}).then(t=>(A("BPMN content fetched"),t)).then(t=>{Ot(t,!1),A(`BPMN content loaded from url ${n}`)}).then(()=>{_i()}).catch(t=>{Be(t.message)})}function zi(n){Ct(n)}function mi(n){mt(n)}function Ai(n,t){var i;const e=((i=n.loadOptions)==null?void 0:i.fit)??{},s=t.get("fitTypeOnLoad");s&&(e.type=s);const o=t.get("fitMargin");return o&&(e.margin=Number(o)),e}function vi(n){if(n.get("style.container.alternative.background.color")=="true"){const i="yellow";F("Use alternative color for the bpmn container background, color",i);const r=O.graph.container;r.style.backgroundColor=i,F("Bpmn container style updated")}const e=n.get("style.theme");F(`Configuring the '${e}' BPMN theme`),O.configureTheme(e)?(ce=e,F(`'${e}' BPMN theme configured`)):F(`Unknown '${e}' BPMN theme, skipping configuration`),n.get("style.seqFlow.light.colors")=="true"&&O.configureSequenceFlowColor("#E9E9E9"),F('Configuring the "Update Style" API from query parameters'),[...n.keys()].some(i=>i.startsWith("style.api."))?(B={stroke:{},font:{},fill:{}},n.get("style.api.stroke.color")&&(B.stroke.color=n.get("style.api.stroke.color")),n.get("style.api.font.color")&&(B.font.color=n.get("style.api.font.color")),n.get("style.api.font.opacity")&&(B.font.opacity=Number(n.get("style.api.font.opacity"))),n.get("style.api.fill.color")?B.fill.color=n.get("style.api.fill.color"):n.get("style.api.fill.color.startColor")&&n.get("style.api.fill.color.endColor")&&n.get("style.api.fill.color.direction")&&(B.fill.color={startColor:n.get("style.api.fill.color.startColor"),endColor:n.get("style.api.fill.color.endColor"),direction:n.get("style.api.fill.color.direction")}),n.get("style.api.fill.opacity")&&(B.fill.opacity=Number(n.get("style.api.fill.opacity"))),F('Prepared "Update Style" API object',B)):F('No query parameters, do not set the "Update Style" API object')}function Oi(n){Me=n.get("bpmn.element.id.collapsed")}function Li(n){const t=n.get("bpmn.filter.pool.ids");if(!t)return;const e=t.split(",");return A("Configuring load options to only include pool id: ",e),{pools:e.map(s=>({id:s}))}}function Xi(n){const t=F;t("Initializing BpmnVisualization with container:",n.globalOptions.container);const e=new URLSearchParams(window.location.search),s=e.get("renderer.ignore.bpmn.colors");if(s){const i=s==="true";t('Ignore support for "BPMN in Color"?',i),!n.globalOptions.renderer&&(n.globalOptions.renderer={}),n.globalOptions.renderer.ignoreBpmnColors=i}O=new Ei(n.globalOptions),t("Initialization completed"),new gi(window,"drop-container",O.graph.container,Nt),t("Drag&Drop support initialized"),Be=n.statusKoNotifier??mi,t("Configuring Load Options"),V=n.loadOptions??{},V.fit=Ai(n,e),V.modelFilter=Li(e),vi(e),Oi(e),t("Checking if an 'url to fetch BPMN content' is provided as query parameter");const o=e.get("url");if(o){const i=decodeURIComponent(o);Ci(i);return}t("No 'url to fetch BPMN content' provided")}function Zi(){z("Trigger SVG Download"),hi(new vt(O.graph).exportSvg())}function ji(){z("Trigger PNG Download"),fi(new vt(O.graph).exportSvgForPng())}function Ni(n,t){A("Applying style using the style API: %O",t),O.bpmnElementsRegistry.updateStyle(n,t),A("New style applied on: %O",n)}function $i(n){A("Resetting styles using the style API!"),O.bpmnElementsRegistry.resetStyle(n),A("Styles reset")}function _i(){if(B){const n=yi();A("Number of elements whose style is to be updated",n.length),Ni(n,B)}}function yi(){A("Retrieving ids of all BPMN elements");const n=[...Object.values(d),...Object.values(k)],t=O.bpmnElementsRegistry.getModelElementsByKinds(n).map(e=>e.id);return A("All BPMN elements ids retrieved:",t.length),t}export{Q as F,E as S,Ft as Z,Bi as a,ki as b,Hi as c,bi as d,Di as e,Mi as f,Pi as g,Ki as h,Zi as i,ji as j,Yi as k,A as l,Vt as m,$i as n,Vi as o,Ni as p,Gi as q,Ui as r,Xi as s,Wi as t,Fi as u,cn as v,zi as w,d as x,xi as z};
